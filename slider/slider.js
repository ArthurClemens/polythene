'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),require('polythene/common/object.assign');var _polythene=require('polythene/polythene/polythene'),_polythene2=_interopRequireDefault(_polythene),_mithril=require('mithril'),_mithril2=_interopRequireDefault(_mithril);require('polythene/slider/theme/theme');var _config=require('polythene/slider/theme/config'),_config2=_interopRequireDefault(_config),_isomorphic=require('polythene/common/isomorphic'),_isomorphic2=_interopRequireDefault(_isomorphic);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var CSS_CLASSES={block:'pe-slider',thumb:'pe-slider__thumb',label:'pe-slider__label',track:'pe-slider__track',trackPart:'pe-slider__track-part',trackPartValue:'pe-slider__track-value',trackPartRest:'pe-slider__track-rest',trackBar:'pe-slider__track-bar',trackBarValue:'pe-slider__track-bar-value',control:'pe-slider__control',ticks:'pe-slider__ticks',tick:'pe-slider__ticks-tick',pin:'pe-slider__pin',isDisabled:'pe-slider--disabled',isActive:'pe-slider--active',hasTrack:'pe-slider--track',hasPin:'pe-slider--pin',hasFocus:'pe-slider--focus',isAtMin:'pe-slider--min',hasTicks:'pe-slider--ticks'},focusElement,eventMoveType='mousemove',eventEndType='mouseup';_isomorphic2.default.isClient()&&(eventMoveType=window.PointerEvent?'pointermove':'ontouchmove'in window||window.DocumentTouch&&document instanceof DocumentTouch?'touchmove':'mousemove',eventEndType=window.PointerEvent?'pointerup':'ontouchend'in window||window.DocumentTouch&&document instanceof DocumentTouch?'touchend':'mouseup');var deFocus=function(a){focusElement&&focusElement.blur(),focusElement=void 0,a.hasFocus=!1},focus=function(a,b){deFocus(a),focusElement=b,a.hasFocus=!0},positionFromEvent=function(a,b){return _polythene2.default.isTouch?b?a.touches[0].pageY:a.touches[0].pageX:b?a.pageY:a.pageX},updatePinPosition=function(a){if(a.controlEl&&a.pinEl){var b=a.fraction()*a.rangeWidth;a.pinEl.style.left=b+'px'}},updateValue=function(a,b){a.setValue(b),updatePinPosition(a)},generateTickMarks=function(a,b,c){for(var d=Math.round((b-a)/c),f=[],g=d+1;0<g;)f.push({tag:'div',attrs:{'class':CSS_CLASSES.tick},children:[]}),g--;return f},readRangeData=function(a){if(a.controlEl){a.controlWidth=_config2.default.thumb_size,a.rangeWidth=a.trackEl.getBoundingClientRect().width-a.controlWidth;var b=window.getComputedStyle(a.trackEl);a.rangeOffset=parseFloat(b.marginLeft)}},calculateClickOffset=function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;a.clickOffset=a.trackEl.getBoundingClientRect().left-(a.rangeOffset-a.controlWidth/2)+b},initControlEvent=function(a,b){var c=a.controlEl.getBoundingClientRect().left,d=positionFromEvent(b),f=d-c-a.controlWidth/2;calculateClickOffset(a,f)},initTrackEvent=function(a){calculateClickOffset(a,0)},handlePosEvent=function(a,b){var c=positionFromEvent(b)-a.clickOffset,d=a.min+(c-a.rangeOffset)/a.rangeWidth*(a.max-a.min);updateValue(a,d),_mithril2.default.redraw()},startDrag=function(a,b,c){if(!_isomorphic2.default.isServer()&&!a.isDragging){c.preventDefault(),a.isDragging=!0,a.isActive=!0,deFocus(a);var d=function drag(g){a.isDragging&&handlePosEvent(a,g)},f=function endDrag(){a.isDragging&&(a.isDragging=!1,a.isActive=!1,deFocus(a),window.removeEventListener(eventMoveType,d),window.removeEventListener(eventEndType,f),_mithril2.default.redraw())};window.addEventListener(eventMoveType,d),window.addEventListener(eventEndType,f),readRangeData(a),b.pin&&updatePinPosition(a)}},startTrack=function(a,b,c){c.preventDefault();a.isDragging||(readRangeData(a),initTrackEvent(a),handlePosEvent(a,c),startDrag(a,b,c))},createSlider=function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},c=arguments[2],d=arguments[3],f=a.fraction(),g=Math.max(10,parseInt(b.step,10)||1),h=function onStartTrack(m){startTrack(a,b,m)},i=function onInitDrag(m){readRangeData(a),initControlEvent(a,m),startDrag(a,b,m)},j=f+' 1 0%',k=1-f,l=k+' 1 0%';return[(0,_mithril2.default)('div',Object.assign({},{class:CSS_CLASSES.track,config:function config(m,n){n||(a.trackEl=m,b.pin&&setTimeout(function(){updatePinPosition(a)},0))}},!d||b.disabled||_polythene2.default.isTouch?null:{onmousedown:h},d&&!b.disabled&&_polythene2.default.isTouch?{ontouchstart:h}:null),[{tag:'div',attrs:{'class':CSS_CLASSES.trackPart+' '+CSS_CLASSES.trackPartValue,style:{flex:j,'-ms-flex':j,webkitFlex:j}},children:[{tag:'div',attrs:{'class':CSS_CLASSES.trackBar},children:[{tag:'div',attrs:{'class':CSS_CLASSES.trackBarValue},children:[]}]}]},(0,_mithril2.default)('div',Object.assign({},{class:CSS_CLASSES.control,config:function config(m,n){n||(a.controlEl=m)}},b.disabled?{disabled:!0}:{tabindex:b.tabindex||0,onfocus:function onfocus(){focus(a,a.controlEl)},onblur:function onblur(){deFocus(a)},onkeydown:function onkeydown(m){27===m.which?a.controlEl.blur(m):37===m.which?a.decrease(m.shiftKey):38===m.which?a.increase(m.shiftKey):39===m.which?a.increase(m.shiftKey):40===m.which&&a.decrease(m.shiftKey),readRangeData(a),updatePinPosition(a)}},b.disabled||_polythene2.default.isTouch?null:{onmousedown:i},!b.disabled&&_polythene2.default.isTouch?{ontouchstart:i}:null,b.events?b.events:null,c?{step:g}:null),b.icon?{tag:'div',attrs:{'class':CSS_CLASSES.thumb},children:[b.icon]}:null),{tag:'div',attrs:{'class':CSS_CLASSES.trackPart+' '+CSS_CLASSES.trackPartRest,style:{flex:l,'-ms-flex':l,webkitFlex:l,'max-width':100*k+'%'}},children:[{tag:'div',attrs:{'class':CSS_CLASSES.trackBar},children:[{tag:'div',attrs:{'class':CSS_CLASSES.trackBarValue},children:[]}]}]},c&&!b.disabled?{tag:'div',attrs:{'class':CSS_CLASSES.ticks},children:[generateTickMarks(a.min,a.max,g)]}:null,c&&b.pin&&!b.disabled?{tag:'div',attrs:{'class':CSS_CLASSES.pin,value:Math.round(a.value()),config:function config(m,n){n||(a.pinEl=m)}},children:[]}:null])]},createView=function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};'function'==typeof b.value&&a.setValue(b.value());var c=b.tag||'div',d=b.ticks!==void 0&&!1!==b.ticks,f=!(b.interactiveTrack!==void 0)||b.interactiveTrack,g={class:[CSS_CLASSES.block,b.disabled?CSS_CLASSES.isDisabled:null,b.pin?CSS_CLASSES.hasPin:null,f?CSS_CLASSES.hasTrack:null,a.isActive?CSS_CLASSES.isActive:null,a.hasFocus?CSS_CLASSES.hasFocus:null,0===a.fraction()?CSS_CLASSES.isAtMin:null,d?CSS_CLASSES.hasTicks:null,b.class].join(' '),id:b.id||'',config:b.config},h=createSlider(a,b,d,f);return(0,_mithril2.default)(c,g,[b.before,h,b.after])},component={controller:function controller(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=void 0===a.min?0:a.min,c=void 0===a.max?100:a.max,d=void 0===a.step?1:a.step,f=0,g=b,h=f;if('function'==typeof a.value){var j=a.value();h=void 0===j?f:j}else h=void 0===a.value?f:a.value;var i=function setValue(j){j<b&&(j=b),j>c&&(j=c),h=d?Math.round(j/d)*d:j,g=(h-b)/(c-b),a.getValue&&a.getValue(h)};return i(h),{min:b,max:c,trackEl:null,controlEl:null,pinEl:null,setValue:i,value:function value(){return h},fraction:function fraction(){return g},increase:function increase(j){return i(h+(j?10:1)*(d||1))},decrease:function decrease(j){return i(h-(j?10:1)*(d||1))},isActive:!1,hasFocus:!1,isDragging:!1,controlWidth:0,rangeWidth:0,rangeOffset:0,clickOffset:0}},view:function view(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};return createView(a,b)}};exports.default=component,module.exports=exports['default'];
//# sourceMappingURL=slider.js.map