{"version":3,"sources":["spinner.es6"],"names":["CSS_CLASSES","block","placeholder","animation","visible","small","regular","medium","large","fab","raised","permanent","singleColor","animated","typeClasses","classForType","mode","show","ctrl","isTransitioning","Object","assign","opts","el","showClass","then","hide","afterHide","style","display","redraw","notifyState","percentage","getPercentage","createView","tag","class","type","join","id","config","inited","context","vdom","setTimeout","events","content","component","z","props","before","after","delay","isNaN","value","controller","view","showDelay","hideDelay"],"mappings":"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","file":"spinner.js","sourcesContent":["import 'polythene/common/object.assign';\nimport m from 'mithril';\nimport transition from 'polythene/common/transition';\nimport shadow from 'polythene/shadow/shadow';\nimport 'polythene/spinner/theme/common/theme';\n\nconst CSS_CLASSES = {\n    block: 'pe-spinner',\n    placeholder: 'pe-spinner--placeholder',\n    animation: 'pe-spinner__animation',\n    visible: 'pe-spinner--visible',\n    small: 'pe-spinner--small',\n    regular: 'pe-spinner--regular',\n    medium: 'pe-spinner--medium',\n    large: 'pe-spinner--large',\n    fab: 'pe-spinner--fab',\n    raised: 'pe-spinner--raised',\n    permanent: 'pe-spinner--permanent',\n    singleColor: 'pe-spinner--single-color',\n    animated: 'pe-spinner--animated'\n};\n\nconst typeClasses = {\n    small: CSS_CLASSES.small,\n    regular: CSS_CLASSES.regular,\n    medium: CSS_CLASSES.medium,\n    large: CSS_CLASSES.large,\n    fab: CSS_CLASSES.fab\n};\n\nconst classForType = (mode = 'regular') => {\n    return typeClasses[mode];\n};\n\nconst show = (ctrl, opts) => {\n    if (ctrl.isTransitioning) {\n        return;\n    }\n    ctrl.isTransitioning = true;\n    return transition.show(Object.assign(\n        {},\n        opts, {\n            el: ctrl.el,\n            showClass: CSS_CLASSES.visible\n        }\n    )).then(() => {\n        ctrl.isTransitioning = false;\n        ctrl.visible = true;\n    });\n};\n\nconst hide = (ctrl, opts) => {\n    if (ctrl.isTransitioning) {\n        return;\n    }\n    ctrl.isTransitioning = true;\n    return transition.hide(Object.assign(\n        {},\n        opts, {\n            el: ctrl.el,\n            afterHide: () => (ctrl.el.style.display = 'none'),\n            showClass: CSS_CLASSES.visible\n        }\n    )).then(() => {\n        ctrl.isTransitioning = false;\n        ctrl.visible = false;\n        ctrl.hide = false;\n        m.redraw(); // removes remainder of drawn component\n    });\n};\n\nconst notifyState = (ctrl, opts) => {\n    if (opts.percentage && opts.getPercentage) {\n        let percentage;\n        if (typeof opts.percentage === 'function') {\n            percentage = opts.percentage();\n        } else {\n            percentage = opts.percentage;\n        }\n        opts.getPercentage(percentage, ctrl, opts);\n    }\n};\n\nconst createView = (ctrl, opts = {}) => {\n    const tag = opts.tag || 'div';\n    const props = Object.assign({},\n        {\n            class: [\n                CSS_CLASSES.block,\n                classForType(opts.type),\n                (opts.singleColor ? CSS_CLASSES.singleColor: null),\n                (opts.raised ? CSS_CLASSES.raised : null),\n                (opts.animated ? CSS_CLASSES.animated : null),\n                (opts.permanent ? CSS_CLASSES.permanent : null),\n                opts.class\n            ].join(' '),\n            id: opts.id || '',\n            config: (el, inited, context, vdom) => {\n                if (inited) return;\n                if (opts.config) {\n                    opts.config(el, inited, context, vdom);\n                }\n                ctrl.el = el;\n\n                notifyState(ctrl, opts);\n\n                if (!opts.permanent) {\n                    setTimeout(() => {\n                        show(ctrl, opts);\n                    }, 0);\n                }\n\n            },\n        },\n        opts.events ? opts.events : null\n    );\n\n    notifyState(ctrl, opts);\n\n    if (ctrl.hide) {\n        setTimeout(() => {\n            hide(ctrl, opts);\n        }, 0);\n    }\n\n    const content = [\n        opts.raised && opts.content ? m.component(shadow, {\n            z: opts.z\n        }) : null,\n        opts.content || m('div', {class: CSS_CLASSES.animation}, 'Specific spinner missing')\n    ];\n\n    return m(tag, props, [opts.before, content, opts.after]);\n};\n\nconst delay = (opts, mode) => {\n    const value = opts[mode];\n    return ((value !== true) && !isNaN(value))\n        ? parseFloat(value, 10) * 1000\n        : false;\n};\n\nconst component = {\n    controller: (opts = {}) => {\n        return {\n            el: null,\n            isTransitioning: false,\n            visible: opts.permanent || false,\n            hide: false,\n            percentage: 0\n        };\n    },\n    view: (ctrl, opts = {}) => {\n        if (!ctrl.visible) {\n            if ((opts.hide !== undefined && !opts.hide) || opts.show) {\n                const showDelay = delay(opts, 'show');\n                if (showDelay) {\n                    setTimeout(() => (ctrl.visible = true, m.redraw()), showDelay);\n                } else {\n                    ctrl.visible = true;\n                }\n            }\n        } else {\n            if ((opts.show !== undefined && !opts.show) || opts.hide) {\n                const hideDelay = delay(opts, 'hide');\n                if (hideDelay) {\n                    setTimeout(() => (ctrl.hide = true, m.redraw()), hideDelay);\n                } else {\n                    ctrl.hide = true;\n                }\n            }\n        }\n        if (ctrl.visible) {\n            return createView(ctrl, opts);\n        } else {\n            return m('span', {class: CSS_CLASSES.placeholder});\n        }\n    }\n};\n\nexport default component;\n"]}