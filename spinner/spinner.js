"use strict";Object.defineProperty(exports,"__esModule",{value:true});require("polythene/common/object.assign");var _mithril=require("mithril");var _mithril2=_interopRequireDefault(_mithril);var _transition=require("polythene/common/transition");var _transition2=_interopRequireDefault(_transition);var _shadow=require("polythene/shadow/shadow");var _shadow2=_interopRequireDefault(_shadow);require("polythene/spinner/theme/common/theme");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var CSS_CLASSES={block:"pe-spinner",placeholder:"pe-spinner--placeholder",animation:"pe-spinner__animation",visible:"pe-spinner--visible",small:"pe-spinner--small",regular:"pe-spinner--regular",medium:"pe-spinner--medium",large:"pe-spinner--large",fab:"pe-spinner--fab",raised:"pe-spinner--raised",permanent:"pe-spinner--permanent",singleColor:"pe-spinner--single-color",animated:"pe-spinner--animated"};var typeClasses={small:CSS_CLASSES.small,regular:CSS_CLASSES.regular,medium:CSS_CLASSES.medium,large:CSS_CLASSES.large,fab:CSS_CLASSES.fab};var classForType=function classForType(){var mode=arguments.length<=0||arguments[0]===undefined?"regular":arguments[0];return typeClasses[mode]};var show=function show(ctrl,opts){if(ctrl.isTransitioning){return}ctrl.isTransitioning=true;return _transition2.default.show(Object.assign({},opts,{el:ctrl.el,showClass:CSS_CLASSES.visible})).then(function(){ctrl.isTransitioning=false;ctrl.visible=true})};var hide=function hide(ctrl,opts){if(ctrl.isTransitioning){return}ctrl.isTransitioning=true;return _transition2.default.hide(Object.assign({},opts,{el:ctrl.el,afterHide:function afterHide(){return ctrl.el.style.display="none"},showClass:CSS_CLASSES.visible})).then(function(){ctrl.isTransitioning=false;ctrl.visible=false;ctrl.hide=false;_mithril2.default.redraw()})};var notifyState=function notifyState(ctrl,opts){if(opts.percentage&&opts.getPercentage){var percentage=undefined;if(typeof opts.percentage==="function"){percentage=opts.percentage()}else{percentage=opts.percentage}opts.getPercentage(percentage,ctrl,opts)}};var createView=function createView(ctrl){var opts=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var tag=opts.tag||"div";var props=Object.assign({},{"class":[CSS_CLASSES.block,classForType(opts.type),opts.singleColor?CSS_CLASSES.singleColor:null,opts.raised?CSS_CLASSES.raised:null,opts.animated?CSS_CLASSES.animated:null,opts.permanent?CSS_CLASSES.permanent:null,opts.class].join(" "),id:opts.id||"",config:function config(el,inited,context,vdom){if(inited)return;if(opts.config){opts.config(el,inited,context,vdom)}ctrl.el=el;notifyState(ctrl,opts);if(!opts.permanent){setTimeout(function(){show(ctrl,opts)},0)}}},opts.events?opts.events:null);notifyState(ctrl,opts);if(ctrl.hide){setTimeout(function(){hide(ctrl,opts)},0)}var content=[opts.raised&&opts.content?_mithril2.default.component(_shadow2.default,{z:opts.z}):null,opts.content||(0,_mithril2.default)("div",{"class":CSS_CLASSES.animation},"Specific spinner missing")];return(0,_mithril2.default)(tag,props,[opts.before,content,opts.after])};var delay=function delay(opts,mode){var value=opts[mode];return value!==true&&!isNaN(value)?parseFloat(value,10)*1e3:false};var component={controller:function controller(){var opts=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];return{el:null,isTransitioning:false,visible:opts.permanent||false,hide:false,percentage:0}},view:function view(ctrl){var opts=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];if(!ctrl.visible){if(opts.hide!==undefined&&!opts.hide||opts.show){var showDelay=delay(opts,"show");if(showDelay){setTimeout(function(){return ctrl.visible=true,_mithril2.default.redraw()},showDelay)}else{ctrl.visible=true}}}else{if(opts.show!==undefined&&!opts.show||opts.hide){var hideDelay=delay(opts,"hide");if(hideDelay){setTimeout(function(){return ctrl.hide=true,_mithril2.default.redraw()},hideDelay)}else{ctrl.hide=true}}}if(ctrl.visible){return createView(ctrl,opts)}else{return(0,_mithril2.default)("span",{"class":CSS_CLASSES.placeholder})}}};exports.default=component;module.exports=exports["default"];