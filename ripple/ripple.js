"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _mithril=require("mithril"),_mithril2=_interopRequireDefault(_mithril),_polythene=require("polythene/polythene/polythene"),_polythene2=_interopRequireDefault(_polythene),_transitionEvent=require("polythene/common/transition-event"),_transitionEvent2=_interopRequireDefault(_transitionEvent),_isomorphic=require("polythene/common/isomorphic"),_isomorphic2=_interopRequireDefault(_isomorphic);require("polythene/ripple/theme/theme");var transitionEvent=(0,_transitionEvent2.default)(),DEFAULT_START_OPACITY=.2,OPACITY_DECAY_VELOCITY=.35,CSS_CLASSES={ripple:"pe-ripple",waves:"pe-ripple__waves",mask:"pe-ripple__mask",constrained:"pe-ripple--constrained",animated:"pe-ripple__waves--animated"},makeRipple=function(e,ctrl){var opts=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!_isomorphic2.default.isServer()){var el=ctrl.ripple(),wavesEl=ctrl.waves(),w=el.offsetWidth,h=el.offsetHeight,waveRadius=Math.sqrt(w*w+h*h),rect=el.getBoundingClientRect(),x=_polythene2.default.isTouch&&e.touches?e.touches[0].pageX:e.clientX,y=_polythene2.default.isTouch&&e.touches?e.touches[0].pageY:e.clientY,mx=opts.center?rect.left+rect.width/2:x,my=opts.center?rect.top+rect.height/2:y,rx=mx-rect.left-waveRadius/2,ry=my-rect.top-waveRadius/2,initialOpacity=void 0!==opts.initialOpacity?opts.initialOpacity:DEFAULT_START_OPACITY,opacityDecayVelocity=void 0!==opts.opacityDecayVelocity?opts.opacityDecayVelocity:OPACITY_DECAY_VELOCITY,duration=1/opacityDecayVelocity*initialOpacity,color=window.getComputedStyle(el).color,onEnd=function onEnd(evt){wavesEl.classList.remove(CSS_CLASSES.animated),wavesEl.removeEventListener(transitionEvent,onEnd,!1),opts.end&&opts.end(evt)};wavesEl.classList.remove(CSS_CLASSES.animated);var style=wavesEl.style;style.width=style.height=waveRadius+"px",style.top=ry+"px",style.left=rx+"px",style["animation-duration"]=style["-webkit-animation-duration"]=style["-moz-animation-duration"]=style["-o-animation-duration"]=duration+"s",style.backgroundColor=color,style.opacity=initialOpacity,wavesEl.addEventListener(transitionEvent,onEnd,!1),opts.start&&opts.start(e),wavesEl.classList.add(CSS_CLASSES.animated)}},createView=function(ctrl){var opts=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(opts.disabled)return(0,_mithril2.default)("");var initRipple=function(el,inited,context){if(!inited){ctrl.ripple(el);var parent=el.parentElement;opts.inactive||!function(){var onClick=function(e){makeRipple(e,ctrl,opts)},endType=_polythene2.default.isTouch?"click":"mouseup";parent.addEventListener(endType,onClick,!1),context.onunload=function(){parent.removeEventListener(endType,onClick,!1)}}()}},initWaves=function(waves,inited){inited||ctrl.waves(waves)},tag=opts.tag||"div",props={class:[CSS_CLASSES.ripple,opts.constrained!==!1?CSS_CLASSES.constrained:null,opts.class].join(" "),id:opts.id||"",config:initRipple},content=(0,_mithril2.default)("div",{class:CSS_CLASSES.mask},(0,_mithril2.default)("div",{class:CSS_CLASSES.waves,config:initWaves}));return(0,_mithril2.default)(tag,props,content)},component={controller:function(){return{ripple:_mithril2.default.prop(),waves:_mithril2.default.prop(),delegate:_mithril2.default.prop()}},view:function(ctrl){var opts=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return createView(ctrl,opts)}};exports.default=component,module.exports=exports.default;
//# sourceMappingURL=ripple.js.map