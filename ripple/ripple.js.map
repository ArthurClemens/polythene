{"version":3,"sources":["ripple.es6"],"names":["transitionEvent","DEFAULT_START_OPACITY","OPACITY_DECAY_VELOCITY","CSS_CLASSES","ripple","waves","mask","constrained","animated","makeRipple","isServer","ctrl","el","offsetWidth","offsetHeight","Math","sqrt","w","h","getBoundingClientRect","isTouch","e","touches","pageX","clientX","pageY","clientY","opts","center","rect","left","width","x","top","height","y","mx","waveRadius","my","initialOpacity","opacityDecayVelocity","window","getComputedStyle","color","onEnd","wavesEl","classList","remove","removeEventListener","end","evt","style","ry","rx","backgroundColor","opacity","addEventListener","start","add","createView","disabled","tag","class","join","id","config","initRipple","inited","parentElement","inactive","onClick","parent","endType","context","onunload","initWaves","props","content","component","controller","prop","delegate","view"],"mappings":"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","file":"ripple.js","sourcesContent":["import m from 'mithril';\nimport p from 'polythene/polythene/polythene';\nimport whichTransitionEvent from 'polythene/common/transition-event';\nimport isomorphic from 'polythene/common/isomorphic';\nimport 'polythene/ripple/theme/theme';\n\nconst transitionEvent = whichTransitionEvent();\nconst DEFAULT_START_OPACITY = 0.2;\nconst OPACITY_DECAY_VELOCITY = 0.35;\n\nconst CSS_CLASSES = {\n    ripple: 'pe-ripple',\n    waves: 'pe-ripple__waves',\n    mask: 'pe-ripple__mask',\n    constrained: 'pe-ripple--constrained',\n    animated: 'pe-ripple__waves--animated'\n};\n\nconst makeRipple = (e, ctrl, opts = {}) => {\n\tif(isomorphic.isServer()){\n\t\treturn;\n\t}\n    const el = ctrl.ripple();\n    const wavesEl = ctrl.waves();\n    const w = el.offsetWidth;\n    const h = el.offsetHeight;\n    const waveRadius = Math.sqrt(w * w + h * h);\n    const rect = el.getBoundingClientRect();\n    const x = (p.isTouch && e.touches) ? e.touches[0].pageX : e.clientX;\n    const y = (p.isTouch && e.touches) ? e.touches[0].pageY : e.clientY;\n    const mx = (opts.center) ? (rect.left + rect.width / 2) : x;\n    const my = (opts.center) ? (rect.top + rect.height / 2) : y;\n    const rx = mx - rect.left - waveRadius / 2;\n    const ry = my - rect.top - waveRadius / 2;\n    const initialOpacity = (opts.initialOpacity !== undefined) ? opts.initialOpacity : DEFAULT_START_OPACITY;\n    const opacityDecayVelocity = (opts.opacityDecayVelocity !== undefined) ? opts.opacityDecayVelocity : OPACITY_DECAY_VELOCITY;\n    const duration = 1 / opacityDecayVelocity * initialOpacity;\n    const color = window.getComputedStyle(el).color;\n    const onEnd = function(evt) {\n        wavesEl.classList.remove(CSS_CLASSES.animated);\n        wavesEl.removeEventListener(transitionEvent, onEnd, false);\n        if (opts.end) {\n            opts.end(evt);\n        }\n    };\n\n    wavesEl.classList.remove(CSS_CLASSES.animated);\n    const style = wavesEl.style;\n    style.width = style.height = waveRadius + 'px';\n    style.top = ry + 'px';\n    style.left = rx + 'px';\n    style['animation-duration'] =\n        style['-webkit-animation-duration'] =\n        style['-moz-animation-duration'] =\n        style['-o-animation-duration'] = duration + 's';\n    style.backgroundColor = color;\n    style.opacity = initialOpacity;\n    wavesEl.addEventListener(transitionEvent, onEnd, false);\n\n    if (opts.start) {\n        opts.start(e);\n    }\n    wavesEl.classList.add(CSS_CLASSES.animated);\n};\n\nconst createView = (ctrl, opts = {}) => {\n    if (opts.disabled) {\n        return m('');\n    }\n    const initRipple = (el, inited, context) => {\n        if (inited) {\n            return;\n        }\n        ctrl.ripple(el);\n        const parent = el.parentElement;\n        if (!opts.inactive) {\n            const onClick = (e) => {\n                makeRipple(e, ctrl, opts);\n            };\n            const endType = p.isTouch ? 'click' : 'mouseup';\n            parent.addEventListener(endType, onClick, false);\n            context.onunload = () => {\n                parent.removeEventListener(endType, onClick, false);\n            };\n        }\n    };\n    const initWaves = (waves, inited) => {\n        if (inited) {\n            return;\n        }\n        ctrl.waves(waves);\n\n    };\n    const tag = opts.tag || 'div';\n    const props = {\n        class: [\n            CSS_CLASSES.ripple,\n            (opts.constrained !== false ? CSS_CLASSES.constrained : null),\n            opts.class\n        ].join(' '),\n        id: opts.id || '',\n        config: initRipple\n    };\n    const content = m('div', {\n        class: CSS_CLASSES.mask\n    }, m('div',\n        {\n            class: CSS_CLASSES.waves,\n            config: initWaves\n        })\n    );\n    return m(tag, props, content);\n};\n\nconst component = {\n    controller: () => {\n        return {\n            ripple: m.prop(),\n            waves: m.prop(),\n            delegate: m.prop()\n        };\n    },\n    view: (ctrl, opts = {}) => {\n        return createView(ctrl, opts);\n    }\n};\n\nexport default component;\n"]}