{"version":3,"sources":["ripple.es6"],"names":["_mithril","require","_polythene","_transitionEvent","transitionEvent","_transitionEvent2","default","DEFAULT_START_OPACITY","OPACITY_DECAY_VELOCITY","CSS_CLASSES","ripple","waves","mask","constrained","animated","makeRipple","e","ctrl","opts","arguments","length","undefined","el","wavesEl","w","offsetWidth","h","offsetHeight","waveRadius","Math","sqrt","rect","getBoundingClientRect","x","_polythene2","isTouch","touches","pageX","clientX","y","pageY","clientY","mx","center","left","width","my","top","height","rx","ry","initialOpacity","opacityDecayVelocity","duration","color","window","getComputedStyle","onEnd","evt","classList","remove","removeEventListener","end","style","backgroundColor","opacity","addEventListener","start","add","createView","disabled","_mithril2","initRipple","inited","context","parent","parentElement","inactive","onClick","endType","onunload","initWaves","tag","props","class","join","id","config","content","component","controller","prop","delegate","view"],"mappings":"qJAAA,IAAAA,UAAAC,QAAA,sDACAC,WAAAD,QAAA,gFACAE,iBAAAF,QAAA,+FACAA,SAAA,+BAEA,IAAMG,kBAAkB,EAAAC,kBAAAC,WAClBC,sBAAwB,GACxBC,uBAAyB,IAEzBC,aACFC,OAAQ,YACRC,MAAO,mBACPC,KAAM,kBACNC,YAAa,yBACbC,SAAU,8BAGRC,WAAa,SAACC,EAAGC,MAAoB,GAAdC,MAAcC,UAAAC,OAAA,GAAAC,SAAAF,UAAA,GAAAA,UAAA,MACjCG,GAAKL,KAAKP,SACVa,QAAUN,KAAKN,QACfa,EAAIF,GAAGG,YACPC,EAAIJ,GAAGK,aACPC,WAAaC,KAAKC,KAAKN,EAAIA,EAAIE,EAAIA,GACnCK,KAAOT,GAAGU,wBACVC,EAAKC,YAAA5B,QAAE6B,SAAWnB,EAAEoB,QAAWpB,EAAEoB,QAAQ,GAAGC,MAAQrB,EAAEsB,QACtDC,EAAKL,YAAA5B,QAAE6B,SAAWnB,EAAEoB,QAAWpB,EAAEoB,QAAQ,GAAGI,MAAQxB,EAAEyB,QACtDC,GAAMxB,KAAKyB,OAAWZ,KAAKa,KAAOb,KAAKc,MAAQ,EAAKZ,EACpDa,GAAM5B,KAAKyB,OAAWZ,KAAKgB,IAAMhB,KAAKiB,OAAS,EAAKT,EACpDU,GAAKP,GAAKX,KAAKa,KAAOhB,WAAa,EACnCsB,GAAKJ,GAAKf,KAAKgB,IAAMnB,WAAa,EAClCuB,eAA0C9B,SAAxBH,KAAKiC,eAAgCjC,KAAKiC,eAAiB5C,sBAC7E6C,qBAAsD/B,SAA9BH,KAAKkC,qBAAsClC,KAAKkC,qBAAuB5C,uBAC/F6C,SAAW,EAAID,qBAAuBD,eACtCG,MAAQC,OAAOC,iBAAiBlC,IAAIgC,MACpCG,MAAQ,QAARA,OAAiBC,KACnBnC,QAAQoC,UAAUC,OAAOnD,YAAYK,UACrCS,QAAQsC,oBAAoBzD,gBAAiBqD,OAAO,GAChDvC,KAAK4C,KACL5C,KAAK4C,IAAIJ,KAIjBnC,SAAQoC,UAAUC,OAAOnD,YAAYK,SACrC,IAAMiD,OAAQxC,QAAQwC,KACtBA,OAAMlB,MAAQkB,MAAMf,OAASpB,WAAa,KAC1CmC,MAAMhB,IAAMG,GAAK,KACjBa,MAAMnB,KAAOK,GAAK,KAClBc,MAAM,sBACFA,MAAM,8BACNA,MAAM,2BACNA,MAAM,yBAA2BV,SAAW,IAChDU,MAAMC,gBAAkBV,MACxBS,MAAME,QAAUd,eAChB5B,QAAQ2C,iBAAiB9D,gBAAiBqD,OAAO,GAE7CvC,KAAKiD,OACLjD,KAAKiD,MAAMnD,GAEfO,QAAQoC,UAAUS,IAAI3D,YAAYK,WAGhCuD,WAAa,SAACpD,MAAoB,GAAdC,MAAcC,UAAAC,OAAA,GAAAC,SAAAF,UAAA,GAAAA,UAAA,KACpC,IAAID,KAAKoD,SACL,OAAO,EAAAC,UAAAjE,SAAE,GAEb,IAAMkE,YAAa,SAAClD,GAAImD,OAAQC,SAC5B,IAAID,OAAJ,CAGAxD,KAAKP,OAAOY,GACZ,IAAMqD,QAASrD,GAAGsD,aACb1D,MAAK2D,WAAU,WAChB,GAAMC,SAAU,SAAC9D,GACbD,WAAWC,EAAGC,KAAMC,OAElB6D,QAAU7C,YAAA5B,QAAE6B,QAAU,QAAU,SACtCwC,QAAOT,iBAAiBa,QAASD,SAAS,GAC1CJ,QAAQM,SAAW,WACfL,OAAOd,oBAAoBkB,QAASD,SAAS,SAInDG,UAAY,SAACtE,MAAO8D,QAClBA,QAGJxD,KAAKN,MAAMA,QAGTuE,IAAMhE,KAAKgE,KAAO,MAClBC,OACFC,OACI3E,YAAYC,OACXQ,KAAKL,eAAgB,EAAQJ,YAAYI,YAAc,KACxDK,KAAKkE,OACPC,KAAK,KACPC,GAAIpE,KAAKoE,IAAM,GACfC,OAAQf,YAENgB,SAAU,EAAAjB,UAAAjE,SAAE,OACd8E,MAAO3E,YAAYG,OACpB,EAAA2D,UAAAjE,SAAE,OAEG8E,MAAO3E,YAAYE,MACnB4E,OAAQN,YAGhB,QAAO,EAAAV,UAAAjE,SAAE4E,IAAKC,MAAOK,UAGnBC,WACFC,WAAY,WACR,OACIhF,OAAQ6D,UAAAjE,QAAEqF,OACVhF,MAAO4D,UAAAjE,QAAEqF,OACTC,SAAUrB,UAAAjE,QAAEqF,SAGpBE,KAAM,SAAC5E,MAAoB,GAAdC,MAAcC,UAAAC,OAAA,GAAAC,SAAAF,UAAA,GAAAA,UAAA,KACvB,OAAOkD,YAAWpD,KAAMC,wBAIjBuE","file":"ripple.js","sourcesContent":["import m from 'mithril';\nimport p from 'polythene/polythene/polythene';\nimport whichTransitionEvent from 'polythene/common/transition-event';\nimport 'polythene/ripple/theme/theme';\n\nconst transitionEvent = whichTransitionEvent();\nconst DEFAULT_START_OPACITY = 0.2;\nconst OPACITY_DECAY_VELOCITY = 0.35;\n\nconst CSS_CLASSES = {\n    ripple: 'pe-ripple',\n    waves: 'pe-ripple__waves',\n    mask: 'pe-ripple__mask',\n    constrained: 'pe-ripple--constrained',\n    animated: 'pe-ripple__waves--animated'\n};\n\nconst makeRipple = (e, ctrl, opts = {}) => {\n    const el = ctrl.ripple();\n    const wavesEl = ctrl.waves();\n    const w = el.offsetWidth;\n    const h = el.offsetHeight;\n    const waveRadius = Math.sqrt(w * w + h * h);\n    const rect = el.getBoundingClientRect();\n    const x = (p.isTouch && e.touches) ? e.touches[0].pageX : e.clientX;\n    const y = (p.isTouch && e.touches) ? e.touches[0].pageY : e.clientY;\n    const mx = (opts.center) ? (rect.left + rect.width / 2) : x;\n    const my = (opts.center) ? (rect.top + rect.height / 2) : y;\n    const rx = mx - rect.left - waveRadius / 2;\n    const ry = my - rect.top - waveRadius / 2;\n    const initialOpacity = (opts.initialOpacity !== undefined) ? opts.initialOpacity : DEFAULT_START_OPACITY;\n    const opacityDecayVelocity = (opts.opacityDecayVelocity !== undefined) ? opts.opacityDecayVelocity : OPACITY_DECAY_VELOCITY;\n    const duration = 1 / opacityDecayVelocity * initialOpacity;\n    const color = window.getComputedStyle(el).color;\n    const onEnd = function(evt) {\n        wavesEl.classList.remove(CSS_CLASSES.animated);\n        wavesEl.removeEventListener(transitionEvent, onEnd, false);\n        if (opts.end) {\n            opts.end(evt);\n        }\n    };\n\n    wavesEl.classList.remove(CSS_CLASSES.animated);\n    const style = wavesEl.style;\n    style.width = style.height = waveRadius + 'px';\n    style.top = ry + 'px';\n    style.left = rx + 'px';\n    style['animation-duration'] =\n        style['-webkit-animation-duration'] =\n        style['-moz-animation-duration'] =\n        style['-o-animation-duration'] = duration + 's';\n    style.backgroundColor = color;\n    style.opacity = initialOpacity;\n    wavesEl.addEventListener(transitionEvent, onEnd, false);\n\n    if (opts.start) {\n        opts.start(e);\n    }\n    wavesEl.classList.add(CSS_CLASSES.animated);\n};\n\nconst createView = (ctrl, opts = {}) => {\n    if (opts.disabled) {\n        return m('');\n    }\n    const initRipple = (el, inited, context) => {\n        if (inited) {\n            return;\n        }\n        ctrl.ripple(el);\n        const parent = el.parentElement;\n        if (!opts.inactive) {\n            const onClick = (e) => {\n                makeRipple(e, ctrl, opts);\n            };\n            const endType = p.isTouch ? 'click' : 'mouseup';\n            parent.addEventListener(endType, onClick, false);\n            context.onunload = () => {\n                parent.removeEventListener(endType, onClick, false);\n            };\n        }\n    };\n    const initWaves = (waves, inited) => {\n        if (inited) {\n            return;\n        }\n        ctrl.waves(waves);\n\n    };\n    const tag = opts.tag || 'div';\n    const props = {\n        class: [\n            CSS_CLASSES.ripple,\n            (opts.constrained !== false ? CSS_CLASSES.constrained : null),\n            opts.class\n        ].join(' '),\n        id: opts.id || '',\n        config: initRipple\n    };\n    const content = m('div', {\n        class: CSS_CLASSES.mask\n    }, m('div',\n        {\n            class: CSS_CLASSES.waves,\n            config: initWaves\n        })\n    );\n    return m(tag, props, content);\n};\n\nconst component = {\n    controller: () => {\n        return {\n            ripple: m.prop(),\n            waves: m.prop(),\n            delegate: m.prop()\n        };\n    },\n    view: (ctrl, opts = {}) => {\n        return createView(ctrl, opts);\n    }\n};\n\nexport default component;\n"]}