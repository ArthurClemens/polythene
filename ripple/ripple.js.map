{"version":3,"sources":["ripple.es6"],"names":["_mithril","require","_polythene","_transitionEvent","_isomorphic","transitionEvent","_transitionEvent2","default","DEFAULT_START_OPACITY","OPACITY_DECAY_VELOCITY","CSS_CLASSES","ripple","waves","mask","constrained","animated","makeRipple","e","ctrl","opts","arguments","length","undefined","_isomorphic2","isServer","el","wavesEl","w","offsetWidth","h","offsetHeight","waveRadius","Math","sqrt","rect","getBoundingClientRect","x","_polythene2","isTouch","touches","pageX","clientX","y","pageY","clientY","mx","center","left","width","my","top","height","rx","ry","initialOpacity","opacityDecayVelocity","duration","color","window","getComputedStyle","onEnd","evt","classList","remove","removeEventListener","end","style","backgroundColor","opacity","addEventListener","start","add","createView","disabled","_mithril2","initRipple","inited","context","parent","parentElement","inactive","onClick","endType","onunload","initWaves","tag","props","class","join","id","config","content","component","controller","prop","delegate","view"],"mappings":"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","file":"ripple.js","sourcesContent":["import m from 'mithril';\nimport p from 'polythene/polythene/polythene';\nimport whichTransitionEvent from 'polythene/common/transition-event';\nimport isomorphic from 'polythene/common/isomorphic';\nimport 'polythene/ripple/theme/theme';\n\nconst transitionEvent = whichTransitionEvent();\nconst DEFAULT_START_OPACITY = 0.2;\nconst OPACITY_DECAY_VELOCITY = 0.35;\n\nconst CSS_CLASSES = {\n    ripple: 'pe-ripple',\n    waves: 'pe-ripple__waves',\n    mask: 'pe-ripple__mask',\n    constrained: 'pe-ripple--constrained',\n    animated: 'pe-ripple__waves--animated'\n};\n\nconst makeRipple = (e, ctrl, opts = {}) => {\n\tif(isomorphic.isServer()){\n\t\treturn;\n\t}\n    const el = ctrl.ripple();\n    const wavesEl = ctrl.waves();\n    const w = el.offsetWidth;\n    const h = el.offsetHeight;\n    const waveRadius = Math.sqrt(w * w + h * h);\n    const rect = el.getBoundingClientRect();\n    const x = (p.isTouch && e.touches) ? e.touches[0].pageX : e.clientX;\n    const y = (p.isTouch && e.touches) ? e.touches[0].pageY : e.clientY;\n    const mx = (opts.center) ? (rect.left + rect.width / 2) : x;\n    const my = (opts.center) ? (rect.top + rect.height / 2) : y;\n    const rx = mx - rect.left - waveRadius / 2;\n    const ry = my - rect.top - waveRadius / 2;\n    const initialOpacity = (opts.initialOpacity !== undefined) ? opts.initialOpacity : DEFAULT_START_OPACITY;\n    const opacityDecayVelocity = (opts.opacityDecayVelocity !== undefined) ? opts.opacityDecayVelocity : OPACITY_DECAY_VELOCITY;\n    const duration = 1 / opacityDecayVelocity * initialOpacity;\n    const color = window.getComputedStyle(el).color;\n    const onEnd = function(evt) {\n        wavesEl.classList.remove(CSS_CLASSES.animated);\n        wavesEl.removeEventListener(transitionEvent, onEnd, false);\n        if (opts.end) {\n            opts.end(evt);\n        }\n    };\n\n    wavesEl.classList.remove(CSS_CLASSES.animated);\n    const style = wavesEl.style;\n    style.width = style.height = waveRadius + 'px';\n    style.top = ry + 'px';\n    style.left = rx + 'px';\n    style['animation-duration'] =\n        style['-webkit-animation-duration'] =\n        style['-moz-animation-duration'] =\n        style['-o-animation-duration'] = duration + 's';\n    style.backgroundColor = color;\n    style.opacity = initialOpacity;\n    wavesEl.addEventListener(transitionEvent, onEnd, false);\n\n    if (opts.start) {\n        opts.start(e);\n    }\n    wavesEl.classList.add(CSS_CLASSES.animated);\n};\n\nconst createView = (ctrl, opts = {}) => {\n    if (opts.disabled) {\n        return m('');\n    }\n    const initRipple = (el, inited, context) => {\n        if (inited) {\n            return;\n        }\n        ctrl.ripple(el);\n        const parent = el.parentElement;\n        if (!opts.inactive) {\n            const onClick = (e) => {\n                makeRipple(e, ctrl, opts);\n            };\n            const endType = p.isTouch ? 'click' : 'mouseup';\n            parent.addEventListener(endType, onClick, false);\n            context.onunload = () => {\n                parent.removeEventListener(endType, onClick, false);\n            };\n        }\n    };\n    const initWaves = (waves, inited) => {\n        if (inited) {\n            return;\n        }\n        ctrl.waves(waves);\n\n    };\n    const tag = opts.tag || 'div';\n    const props = {\n        class: [\n            CSS_CLASSES.ripple,\n            (opts.constrained !== false ? CSS_CLASSES.constrained : null),\n            opts.class\n        ].join(' '),\n        id: opts.id || '',\n        config: initRipple\n    };\n    const content = m('div', {\n        class: CSS_CLASSES.mask\n    }, m('div',\n        {\n            class: CSS_CLASSES.waves,\n            config: initWaves\n        })\n    );\n    return m(tag, props, content);\n};\n\nconst component = {\n    controller: () => {\n        return {\n            ripple: m.prop(),\n            waves: m.prop(),\n            delegate: m.prop()\n        };\n    },\n    view: (ctrl, opts = {}) => {\n        return createView(ctrl, opts);\n    }\n};\n\nexport default component;\n"]}