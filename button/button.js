"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj};require("polythene/common/object.assign");var _polythene=require("polythene/polythene/polythene"),_polythene2=_interopRequireDefault(_polythene),_mithril=require("mithril"),_mithril2=_interopRequireDefault(_mithril),_ripple=require("polythene/ripple/ripple"),_ripple2=_interopRequireDefault(_ripple),_shadow=require("polythene/shadow/shadow"),_shadow2=_interopRequireDefault(_shadow);require("polythene/base-button/base-button"),require("polythene/button/theme/theme");var CSS_CLASSES={block:"pe-button pe-button--text",content:"pe-button__content",label:"pe-button__label",raised:"pe-button--raised",wash:"pe-button__wash",focus:"pe-button__focus",selected:"pe-button--selected",disabled:"pe-button--disabled",borders:"pe-button--borders",inactive:"pe-button--inactive",focusState:"pe-button--focus"},MAX_Z=5,startType=window.PointerEvent?"pointerdown":"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch?"touchstart":"mousedown",endType=window.PointerEvent?"pointerup":"ontouchend"in window||window.DocumentTouch&&document instanceof DocumentTouch?"touchend":"mouseup",tapStart=void 0,tapEnd=void 0,tapEndAll=void 0,downButtons=[],animateZ=function(ctrl,opts,name){var baseZ=ctrl.baseZ(),increase=opts.increase||1,z=ctrl.z();"down"===name&&5!==baseZ?(z+=increase,z=Math.min(z,MAX_Z)):"up"===name&&(z-=increase,z=Math.max(z,baseZ)),z!==ctrl.z()&&(ctrl.z(z),_mithril2["default"].redraw())},inactivate=function(ctrl,opts){ctrl.inactive=!0,_mithril2["default"].redraw(),setTimeout(function(){ctrl.inactive=!1,_mithril2["default"].redraw()},1e3*opts.inactivate)},initTapEvents=function(el,ctrl,opts){var tapHandler=function(ctrl,opts,name){"down"===name?downButtons.push({ctrl:ctrl,opts:opts}):"up"===name&&opts.inactivate&&!ctrl.inactive&&inactivate(ctrl,opts),opts.animateOnTap&&!_polythene2["default"].isTouch&&animateZ(ctrl,opts,name)};tapStart=function(){return tapHandler(ctrl,opts,"down")},tapEnd=function(){return tapHandler(ctrl,opts,"up")},tapEndAll=function(){downButtons.map(function(btn){tapHandler(btn.ctrl,btn.opts,"up")}),downButtons=[]},el.addEventListener(startType,tapStart),el.addEventListener(endType,tapEnd),window.addEventListener(endType,tapEndAll)},clearTapEvents=function(el){el.removeEventListener(startType,tapStart),el.removeEventListener(endType,tapEnd),window.removeEventListener(endType,tapEndAll)},createView=function(ctrl){var opts=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],noink=void 0!==opts.ink&&opts.ink===!1,disabled=opts.disabled,tag=opts.tag||"a";ctrl.inactive=void 0!==opts.inactive?opts.inactive!==!1:ctrl.inactive;var tabIndex=disabled||ctrl.inactive?-1:opts.tabindex||0,buttonConfig=function(el,isInited,context){isInited||(ctrl.el=el,disabled||ctrl.inactive||(initTapEvents(el,ctrl,Object.assign({},opts,{animateOnTap:opts.animateOnTap!==!1})),context.onunload=function(){clearTapEvents(el)}))},optsConfig=opts.config||function(){},urlConfig=opts.url&&opts.url.config?opts.url.config:function(){},props=Object.assign({},{"class":[opts.parentClass||CSS_CLASSES.block,opts.selected?CSS_CLASSES.selected:null,disabled?CSS_CLASSES.disabled:null,ctrl.inactive?CSS_CLASSES.inactive:null,opts.borders?CSS_CLASSES.borders:null,opts.raised?CSS_CLASSES.raised:null,ctrl.focus?CSS_CLASSES.focusState:null,opts["class"]].join(" "),id:opts.id||"",tabindex:tabIndex,onfocus:function(){return ctrl.focus=!ctrl.mouseover},onblur:function(){return ctrl.focus=!1},onmouseover:function(){return ctrl.mouseover=!0},onmouseout:function(){return ctrl.mouseover=!1},onkeydown:function(e){if(13===e.which&&ctrl.focus&&ctrl.el){var event=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});ctrl.el.dispatchEvent(event)}}},opts.url?opts.url:null,opts.formaction?{formaction:opts.formaction}:null,opts.type?{type:opts.type}:null,opts.events?opts.events:null,{config:function(){return[buttonConfig.apply(void 0,arguments),optsConfig.apply(void 0,arguments),urlConfig.apply(void 0,arguments)]}},disabled?{disabled:!0}:null),label=opts.content?opts.content:opts.label?"object"===_typeof(opts.label)?opts.label:(0,_mithril2["default"])("div",{"class":CSS_CLASSES.label},opts.label):null,noWash=disabled||void 0!==opts.wash&&!opts.wash,wash=!noWash,rippleOpts=Object.assign({},opts.ripple,{inactive:noink}),content=(0,_mithril2["default"])("div",{"class":CSS_CLASSES.content},[opts.raised&&!disabled?_mithril2["default"].component(_shadow2["default"],{z:ctrl.z(),animated:!0}):null,disabled?null:_mithril2["default"].component(_ripple2["default"],rippleOpts),wash?(0,_mithril2["default"])("div",{"class":CSS_CLASSES.wash}):null,disabled?null:(0,_mithril2["default"])("div",{"class":CSS_CLASSES.focus}),label]);return(0,_mithril2["default"])(tag,props,[opts.before,content,opts.after])},component={controller:function(){var opts=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],z=void 0!==opts.z?opts.z:1;return{el:void 0,baseZ:_mithril2["default"].prop(z),z:_mithril2["default"].prop(z),inactive:void 0,focus:!1,mouseover:!1}},view:function(ctrl){var opts=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return createView(ctrl,opts)}};exports["default"]=component,module.exports=exports["default"];
//# sourceMappingURL=button.js.map