'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a};Object.defineProperty(exports,'__esModule',{value:!0});require('polythene/common/object.assign');var _polythene=require('polythene/polythene/polythene'),_polythene2=_interopRequireDefault(_polythene),_mithril=require('mithril'),_mithril2=_interopRequireDefault(_mithril),_ripple=require('polythene/ripple/ripple'),_ripple2=_interopRequireDefault(_ripple),_shadow=require('polythene/shadow/shadow'),_shadow2=_interopRequireDefault(_shadow),_isomorphic=require('polythene/common/isomorphic'),_isomorphic2=_interopRequireDefault(_isomorphic);require('polythene/base-button/base-button'),require('polythene/button/theme/theme');function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var CSS_CLASSES={block:'pe-button pe-button--text',content:'pe-button__content',label:'pe-button__label',raised:'pe-button--raised',wash:'pe-button__wash',focus:'pe-button__focus',selected:'pe-button--selected',disabled:'pe-button--disabled',borders:'pe-button--borders',inactive:'pe-button--inactive',focusState:'pe-button--focus'},MAX_Z=5,startType='mousedown',endType='mouseup';_isomorphic2.default.isClient()&&(startType=window.PointerEvent?'pointerdown':'ontouchstart'in window||window.DocumentTouch&&document instanceof DocumentTouch?'touchstart':'mousedown',endType=window.PointerEvent?'pointerup':'ontouchend'in window||window.DocumentTouch&&document instanceof DocumentTouch?'touchend':'mouseup');var tapStart,tapEnd,tapEndAll,downButtons=[],animateZ=function(a,b,c){var d=a.baseZ(),f=b.increase||1,g=a.z();'down'===c&&5!==d?(g+=f,g=Math.min(g,MAX_Z)):'up'===c&&(g-=f,g=Math.max(g,d)),g!==a.z()&&(a.z(g),_mithril2.default.redraw())},inactivate=function(a,b){a.inactive=!0,_mithril2.default.redraw(),setTimeout(function(){a.inactive=!1,_mithril2.default.redraw()},1e3*b.inactivate)},initTapEvents=function(a,b,c){if(!_isomorphic2.default.isServer()){var d=function tapHandler(f,g,h){'down'===h?downButtons.push({ctrl:f,opts:g}):'up'===h&&g.inactivate&&!f.inactive&&inactivate(f,g),g.animateOnTap&&!_polythene2.default.isTouch&&animateZ(f,g,h)};tapStart=function(){return d(b,c,'down')},tapEnd=function(){return d(b,c,'up')},tapEndAll=function(){downButtons.map(function(f){d(f.ctrl,f.opts,'up')}),downButtons=[]},a.addEventListener(startType,tapStart),a.addEventListener(endType,tapEnd),window.addEventListener(endType,tapEndAll)}},clearTapEvents=function(a){_isomorphic2.default.isServer()||(a.removeEventListener(startType,tapStart),a.removeEventListener(endType,tapEnd),window.removeEventListener(endType,tapEndAll))},createView=function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},c=b.ink!==void 0&&!1===b.ink,d=b.disabled,f=b.tag||'a';a.inactive=b.inactive===void 0?a.inactive:!1!==b.inactive;var g=d||a.inactive?-1:b.tabindex||0,h=function buttonConfig(q,r,s){r||(a.el=q,!d&&!a.inactive&&(initTapEvents(q,a,Object.assign({},b,{animateOnTap:!1!==b.animateOnTap})),s.onunload=function(){clearTapEvents(q)}))},i=b.config||function(){},j=b.url&&b.url.config?b.url.config:function(){},k=Object.assign({},{class:[b.parentClass||CSS_CLASSES.block,b.selected?CSS_CLASSES.selected:null,d?CSS_CLASSES.disabled:null,a.inactive?CSS_CLASSES.inactive:null,b.borders?CSS_CLASSES.borders:null,b.raised?CSS_CLASSES.raised:null,a.focus?CSS_CLASSES.focusState:null,b.class].join(' '),id:b.id||'',tabindex:g,onfocus:function onfocus(){return a.focus=!a.mouseover},onblur:function onblur(){return a.focus=!1},onmouseover:function onmouseover(){return a.mouseover=!0},onmouseout:function onmouseout(){return a.mouseover=!1},onkeydown:function onkeydown(q){if(13===q.which&&a.focus&&a.el){var r=new MouseEvent('click',{view:_isomorphic2.default.isClient()?window:{},bubbles:!0,cancelable:!0});a.el.dispatchEvent(r)}}},b.url?b.url:null,b.formaction?{formaction:b.formaction}:null,b.type?{type:b.type}:null,b.events?b.events:null,{config:function config(){return[h.apply(void 0,arguments),i.apply(void 0,arguments),j.apply(void 0,arguments)]}},d?{disabled:!0}:null),l=b.content?b.content:b.label?'object'===_typeof(b.label)?b.label:{tag:'div',attrs:{'class':CSS_CLASSES.label},children:[b.label]}:null,m=d||b.wash!==void 0&&!b.wash,o=Object.assign({},b.ripple,{inactive:c}),p={tag:'div',attrs:{'class':CSS_CLASSES.content},children:[b.raised&&!d?_mithril2.default.component(_shadow2.default,{z:a.z(),animated:!0}):null,d?null:_mithril2.default.component(_ripple2.default,o),!m?{tag:'div',attrs:{'class':CSS_CLASSES.wash},children:[]}:null,d?null:{tag:'div',attrs:{'class':CSS_CLASSES.focus},children:[]},l]};return(0,_mithril2.default)(f,k,[b.before,p,b.after])},component={controller:function controller(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},b=a.z===void 0?1:a.z;return{el:void 0,baseZ:_mithril2.default.prop(b),z:_mithril2.default.prop(b),inactive:void 0,focus:!1,mouseover:!1}},view:function view(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};return createView(a,b)}};exports.default=component,module.exports=exports['default'];
//# sourceMappingURL=button.js.map