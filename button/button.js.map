{"version":3,"sources":["button.es6"],"names":["CSS_CLASSES","block","content","label","raised","wash","focus","selected","disabled","borders","inactive","focusState","MAX_Z","startType","endType","isClient","window","PointerEvent","DocumentTouch","document","tapStart","tapEnd","tapEndAll","downButtons","animateZ","ctrl","baseZ","opts","increase","z","Math","min","max","redraw","inactivate","setTimeout","initTapEvents","isServer","tapHandler","push","animateOnTap","isTouch","name","map","btn","el","addEventListener","clearTapEvents","removeEventListener","createView","ink","tag","tabindex","buttonConfig","isInited","Object","assign","context","onunload","config","url","class","parentClass","join","id","tabIndex","onfocus","mouseover","onblur","onmouseover","onmouseout","onkeydown","which","MouseEvent","view","bubbles","cancelable","dispatchEvent","event","formaction","type","events","optsConfig","urlConfig","ripple","noink","component","animated","rippleOpts","noWash","props","before","after","controller","prop"],"mappings":"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","file":"button.js","sourcesContent":["import 'polythene/common/object.assign';\nimport p from 'polythene/polythene/polythene';\nimport m from 'mithril';\nimport ripple from 'polythene/ripple/ripple';\nimport shadow from 'polythene/shadow/shadow';\nimport isomorphic from 'polythene/common/isomorphic';\nimport 'polythene/base-button/base-button';\nimport 'polythene/button/theme/theme';\n\nconst CSS_CLASSES = {\n    block: 'pe-button pe-button--text',\n    content: 'pe-button__content',\n    label: 'pe-button__label',\n    raised: 'pe-button--raised',\n    wash: 'pe-button__wash',\n    focus: 'pe-button__focus',\n    selected: 'pe-button--selected',\n    disabled: 'pe-button--disabled',\n    borders: 'pe-button--borders',\n    inactive: 'pe-button--inactive',\n    focusState: 'pe-button--focus',\n};\n\nconst MAX_Z = 5;\n\nlet startType = 'mousedown';\nlet endType = 'mouseup';\n\nif(isomorphic.isClient()) {\n\tstartType = window.PointerEvent ? 'pointerdown' : (('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch) ? 'touchstart' : 'mousedown';\n\tendType = window.PointerEvent ? 'pointerup' : (('ontouchend' in window) || window.DocumentTouch && document instanceof DocumentTouch) ? 'touchend' : 'mouseup';\n}\n\nlet tapStart,\n    tapEnd,\n    tapEndAll,\n    downButtons = [];\n\nconst animateZ = (ctrl, opts, name) => {\n    const baseZ = ctrl.baseZ();\n    const increase = opts.increase || 1;\n    let z = ctrl.z();\n    if (name === 'down' && baseZ !== 5) {\n        z = z + increase;\n        z = Math.min(z, MAX_Z);\n    } else if (name === 'up') {\n        z = z - increase;\n        z = Math.max(z, baseZ);\n    }\n    if (z !== ctrl.z()) {\n        ctrl.z(z);\n        m.redraw(); // make animation visible\n    }\n};\n\nconst inactivate = (ctrl, opts) => {\n    ctrl.inactive = true;\n    m.redraw();\n    setTimeout(() => {\n        ctrl.inactive = false;\n        m.redraw();\n    }, opts.inactivate * 1000);\n};\n\nconst initTapEvents = (el, ctrl, opts) => {\n\tif(isomorphic.isServer()) {\n\t\treturn;\n\t}\n    const tapHandler = (ctrl, opts, name) => {\n        if (name === 'down') {\n            downButtons.push({ctrl, opts});\n        } else if (name === 'up') {\n            if (opts.inactivate && !ctrl.inactive) {\n                inactivate(ctrl, opts);\n            }\n        }\n        // no z animation on touch\n        if (opts.animateOnTap && !p.isTouch) {\n            animateZ(ctrl, opts, name);\n        }\n    };\n    tapStart = () => (tapHandler(ctrl, opts, 'down'));\n    tapEnd = () => (tapHandler(ctrl, opts, 'up'));\n    tapEndAll = () => {\n        downButtons.map((btn) => {\n            tapHandler(btn.ctrl, btn.opts, 'up');\n        });\n        downButtons = [];\n    };\n    el.addEventListener(startType, tapStart);\n    el.addEventListener(endType, tapEnd);\n    window.addEventListener(endType, tapEndAll);\n};\n\nconst clearTapEvents = function(el) {\n\tif(isomorphic.isServer()) {\n\t\treturn;\n\t}\n    el.removeEventListener(startType, tapStart);\n    el.removeEventListener(endType, tapEnd);\n    window.removeEventListener(endType, tapEndAll);\n};\n\nconst createView = (ctrl, opts = {}) => {\n    const noink = (opts.ink !== undefined && opts.ink === false);\n    const disabled = opts.disabled;\n    const tag = opts.tag || 'a';\n    ctrl.inactive = (opts.inactive !== undefined)\n        ? (opts.inactive === false)\n            ? false\n            : true\n        : ctrl.inactive;\n    const tabIndex = (disabled || ctrl.inactive)\n        ? -1\n        : opts.tabindex || 0;\n\n    // handle multiple configs:\n    // - passed as param in the url Object\n    // - passed as opts.config\n    // - the default button config\n    const buttonConfig = (el, isInited, context) => {\n        if (isInited) {\n            return;\n        }\n        ctrl.el = el;\n        if (!disabled && !ctrl.inactive) {\n            initTapEvents(el, ctrl, Object.assign(\n                {},\n                opts,\n                {animateOnTap: (opts.animateOnTap !== false) ? true : false}\n            ));\n            context.onunload = () => {\n                clearTapEvents(el);\n            };\n        }\n    };\n    const optsConfig = opts.config || (() => {});\n    const urlConfig = (opts.url && opts.url.config) ? opts.url.config : (() => {});\n\n    const props = Object.assign(\n        {},\n        {\n            class: [\n                (opts.parentClass || CSS_CLASSES.block),\n                (opts.selected ? CSS_CLASSES.selected : null),\n                (disabled ? CSS_CLASSES.disabled : null),\n                (ctrl.inactive ? CSS_CLASSES.inactive : null),\n                (opts.borders ? CSS_CLASSES.borders : null),\n                (opts.raised ? CSS_CLASSES.raised : null),\n                (ctrl.focus ? CSS_CLASSES.focusState : null),\n                opts.class\n            ].join(' '),\n            id: opts.id || '',\n            tabindex: tabIndex,\n            // handle focus events\n            onfocus: () => ctrl.focus = !ctrl.mouseover,\n            onblur: () => ctrl.focus = false,\n            // don't show focus on click (detected by not being in mouse over state)\n            onmouseover: () => ctrl.mouseover = true,\n            onmouseout: () => ctrl.mouseover = false,\n            // if focus, dispatch click event on ENTER\n            onkeydown: (e) => {\n                if (e.which === 13 && ctrl.focus && ctrl.el) {\n                    // ENTER\n                    const event = new MouseEvent('click', {\n                        view: isomorphic.isClient()? window: {},\n                        bubbles: true,\n                        cancelable: true\n                    });\n                    ctrl.el.dispatchEvent(event);\n                }\n            }\n        },\n        opts.url ? opts.url : null,\n        opts.formaction ? {formaction: opts.formaction} : null,\n        opts.type ? {type: opts.type} : null,\n        opts.events ? opts.events : null,\n        {\n            config: (...args) => [\n                buttonConfig(...args),\n                optsConfig(...args),\n                urlConfig(...args)\n            ]\n        },\n        disabled\n            ? {\n                disabled: true\n            }\n            : null\n    );\n\n    const label = opts.content\n        ? opts.content\n        : (opts.label)\n            ? (typeof opts.label === 'object')\n                ? opts.label\n                : m('div', {class: CSS_CLASSES.label}, opts.label)\n            : null;\n\n    const noWash = disabled || (opts.wash !== undefined && !opts.wash);\n    const wash = !noWash;\n    const rippleOpts = Object.assign(\n        {},\n        opts.ripple,\n        {inactive: noink}\n    );\n    const content = m('div', {\n        'class': CSS_CLASSES.content\n    }, [\n        (opts.raised && !disabled)\n            ? m.component(shadow, {\n                z: ctrl.z(),\n                animated: true\n            })\n            : null,\n        // ripple\n        disabled ? null : m.component(ripple, rippleOpts),\n        // hover\n        wash ? m('div', {class: CSS_CLASSES.wash}) : null,\n        // focus\n        disabled ? null : m('div', {class: CSS_CLASSES.focus}),\n        label\n    ]);\n    return m(tag, props, [opts.before, content, opts.after]);\n};\n\nconst component = {\n    controller: (opts = {}) => {\n        let z = (opts.z !== undefined) ? opts.z : 1;\n\n        return {\n            el: undefined,\n            baseZ: m.prop(z),\n            z: m.prop(z),\n            inactive: undefined,\n            focus: false,\n            mouseover: false\n        };\n    },\n    view: (ctrl, opts = {}) => {\n        return createView(ctrl, opts);\n    }\n};\n\nexport default component;\n"]}