{"version":3,"sources":["button.es6"],"names":["require","_polythene","_mithril","_ripple","_shadow","CSS_CLASSES","block","content","label","raised","wash","focus","selected","disabled","borders","inactive","focusState","MAX_Z","startType","endType","window","PointerEvent","DocumentTouch","document","tapStart","tapEnd","tapEndAll","downButtons","animateZ","ctrl","opts","name","baseZ","increase","z","Math","min","max","_mithril2","default","redraw","inactivate","setTimeout","initTapEvents","el","tapHandler","push","animateOnTap","_polythene2","isTouch","map","btn","addEventListener","clearTapEvents","removeEventListener","createView","arguments","length","undefined","noink","ink","tag","tabIndex","tabindex","buttonConfig","isInited","context","Object","assign","onunload","optsConfig","config","urlConfig","url","props","class","parentClass","join","id","onfocus","mouseover","onblur","onmouseover","onmouseout","onkeydown","e","which","event","MouseEvent","view","bubbles","cancelable","dispatchEvent","formaction","type","events","apply","_typeof","noWash","rippleOpts","ripple","component","_shadow2","animated","_ripple2","before","after","controller","prop"],"mappings":"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","file":"button.js","sourcesContent":["import 'polythene/common/object.assign';\nimport p from 'polythene/polythene/polythene';\nimport m from 'mithril';\nimport ripple from 'polythene/ripple/ripple';\nimport shadow from 'polythene/shadow/shadow';\nimport 'polythene/base-button/base-button';\nimport 'polythene/button/theme/theme';\n\nconst CSS_CLASSES = {\n    block: 'pe-button pe-button--text',\n    content: 'pe-button__content',\n    label: 'pe-button__label',\n    raised: 'pe-button--raised',\n    wash: 'pe-button__wash',\n    focus: 'pe-button__focus',\n    selected: 'pe-button--selected',\n    disabled: 'pe-button--disabled',\n    borders: 'pe-button--borders',\n    inactive: 'pe-button--inactive',\n    focusState: 'pe-button--focus',\n};\n\nconst MAX_Z = 5;\n\nlet startType = 'mousedown';\nlet endType = 'mouseup';\n\nif(typeof window !== \"undefined\") {\n\tstartType = window.PointerEvent ? 'pointerdown' : (('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch) ? 'touchstart' : 'mousedown';\n\tendType = window.PointerEvent ? 'pointerup' : (('ontouchend' in window) || window.DocumentTouch && document instanceof DocumentTouch) ? 'touchend' : 'mouseup';\n}\n\nlet tapStart,\n    tapEnd,\n    tapEndAll,\n    downButtons = [];\n\nconst animateZ = (ctrl, opts, name) => {\n    const baseZ = ctrl.baseZ();\n    const increase = opts.increase || 1;\n    let z = ctrl.z();\n    if (name === 'down' && baseZ !== 5) {\n        z = z + increase;\n        z = Math.min(z, MAX_Z);\n    } else if (name === 'up') {\n        z = z - increase;\n        z = Math.max(z, baseZ);\n    }\n    if (z !== ctrl.z()) {\n        ctrl.z(z);\n        m.redraw(); // make animation visible\n    }\n};\n\nconst inactivate = (ctrl, opts) => {\n    ctrl.inactive = true;\n    m.redraw();\n    setTimeout(() => {\n        ctrl.inactive = false;\n        m.redraw();\n    }, opts.inactivate * 1000);\n};\n\nconst initTapEvents = (el, ctrl, opts) => {\n\tif(typeof window === \"undefined\") {\n\t\treturn;\n\t}\n    const tapHandler = (ctrl, opts, name) => {\n        if (name === 'down') {\n            downButtons.push({ctrl, opts});\n        } else if (name === 'up') {\n            if (opts.inactivate && !ctrl.inactive) {\n                inactivate(ctrl, opts);\n            }\n        }\n        // no z animation on touch\n        if (opts.animateOnTap && !p.isTouch) {\n            animateZ(ctrl, opts, name);\n        }\n    };\n    tapStart = () => (tapHandler(ctrl, opts, 'down'));\n    tapEnd = () => (tapHandler(ctrl, opts, 'up'));\n    tapEndAll = () => {\n        downButtons.map((btn) => {\n            tapHandler(btn.ctrl, btn.opts, 'up');\n        });\n        downButtons = [];\n    };\n    el.addEventListener(startType, tapStart);\n    el.addEventListener(endType, tapEnd);\n    window.addEventListener(endType, tapEndAll);\n};\n\nconst clearTapEvents = function(el) {\n\tif(typeof window === \"undefined\") {\n\t\treturn;\n\t}\n    el.removeEventListener(startType, tapStart);\n    el.removeEventListener(endType, tapEnd);\n    window.removeEventListener(endType, tapEndAll);\n};\n\nconst createView = (ctrl, opts = {}) => {\n    const noink = (opts.ink !== undefined && opts.ink === false);\n    const disabled = opts.disabled;\n    const tag = opts.tag || 'a';\n    ctrl.inactive = (opts.inactive !== undefined)\n        ? (opts.inactive === false)\n            ? false\n            : true\n        : ctrl.inactive;\n    const tabIndex = (disabled || ctrl.inactive)\n        ? -1\n        : opts.tabindex || 0;\n\n    // handle multiple configs:\n    // - passed as param in the url Object\n    // - passed as opts.config\n    // - the default button config\n    const buttonConfig = (el, isInited, context) => {\n        if (isInited) {\n            return;\n        }\n        ctrl.el = el;\n        if (!disabled && !ctrl.inactive) {\n            initTapEvents(el, ctrl, Object.assign(\n                {},\n                opts,\n                {animateOnTap: (opts.animateOnTap !== false) ? true : false}\n            ));\n            context.onunload = () => {\n                clearTapEvents(el);\n            };\n        }\n    };\n    const optsConfig = opts.config || (() => {});\n    const urlConfig = (opts.url && opts.url.config) ? opts.url.config : (() => {});\n\n    const props = Object.assign(\n        {},\n        {\n            class: [\n                (opts.parentClass || CSS_CLASSES.block),\n                (opts.selected ? CSS_CLASSES.selected : null),\n                (disabled ? CSS_CLASSES.disabled : null),\n                (ctrl.inactive ? CSS_CLASSES.inactive : null),\n                (opts.borders ? CSS_CLASSES.borders : null),\n                (opts.raised ? CSS_CLASSES.raised : null),\n                (ctrl.focus ? CSS_CLASSES.focusState : null),\n                opts.class\n            ].join(' '),\n            id: opts.id || '',\n            tabindex: tabIndex,\n            // handle focus events\n            onfocus: () => ctrl.focus = !ctrl.mouseover,\n            onblur: () => ctrl.focus = false,\n            // don't show focus on click (detected by not being in mouse over state)\n            onmouseover: () => ctrl.mouseover = true,\n            onmouseout: () => ctrl.mouseover = false,\n            // if focus, dispatch click event on ENTER\n            onkeydown: (e) => {\n                if (e.which === 13 && ctrl.focus && ctrl.el) {\n                    // ENTER\n                    const event = new MouseEvent('click', {\n                        view: typeof window !== \"undefined\"? window: {},\n                        bubbles: true,\n                        cancelable: true\n                    });\n                    ctrl.el.dispatchEvent(event);\n                }\n            }\n        },\n        opts.url ? opts.url : null,\n        opts.formaction ? {formaction: opts.formaction} : null,\n        opts.type ? {type: opts.type} : null,\n        opts.events ? opts.events : null,\n        {\n            config: (...args) => [\n                buttonConfig(...args),\n                optsConfig(...args),\n                urlConfig(...args)\n            ]\n        },\n        disabled\n            ? {\n                disabled: true\n            }\n            : null\n    );\n\n    const label = opts.content\n        ? opts.content\n        : (opts.label)\n            ? (typeof opts.label === 'object')\n                ? opts.label\n                : m('div', {class: CSS_CLASSES.label}, opts.label)\n            : null;\n\n    const noWash = disabled || (opts.wash !== undefined && !opts.wash);\n    const wash = !noWash;\n    const rippleOpts = Object.assign(\n        {},\n        opts.ripple,\n        {inactive: noink}\n    );\n    const content = m('div', {\n        'class': CSS_CLASSES.content\n    }, [\n        (opts.raised && !disabled)\n            ? m.component(shadow, {\n                z: ctrl.z(),\n                animated: true\n            })\n            : null,\n        // ripple\n        disabled ? null : m.component(ripple, rippleOpts),\n        // hover\n        wash ? m('div', {class: CSS_CLASSES.wash}) : null,\n        // focus\n        disabled ? null : m('div', {class: CSS_CLASSES.focus}),\n        label\n    ]);\n    return m(tag, props, [opts.before, content, opts.after]);\n};\n\nconst component = {\n    controller: (opts = {}) => {\n        let z = (opts.z !== undefined) ? opts.z : 1;\n\n        return {\n            el: undefined,\n            baseZ: m.prop(z),\n            z: m.prop(z),\n            inactive: undefined,\n            focus: false,\n            mouseover: false\n        };\n    },\n    view: (ctrl, opts = {}) => {\n        return createView(ctrl, opts);\n    }\n};\n\nexport default component;\n"]}