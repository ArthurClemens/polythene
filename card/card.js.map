{"version":3,"sources":["card.es6"],"names":["require","_mithril","_shadow","_icon","_listTile","CSS_CLASSES","block","overlay","overlaySheet","overlayContent","mediaDimmer","mediaCropX","mediaCropY","media","header","headerTitle","title","subtitle","text","primary","primaryMedia","actions","actionsHorizontal","actionsVertical","actionsJustified","actionsBordered","mediaRatioSquare","mediaRatioLandscape","primaryHasMedia","mediaSmall","mediaRegular","mediaMedium","mediaLarge","imageRatios","landscape","square","createOverlay","opts","arguments","length","undefined","tag","content","map","o","key","Object","keys","contentMap","_mithril2","default","class","sheet","join","createText","mediaTypeClasses","small","regular","medium","large","mediaClassForType","mode","createMedia","ratio","origin","initImage","el","inited","img","querySelector","onload","w","this","naturalWidth","h","naturalHeight","naturalRatio","cropClass","className","clientWidth","clientHeight","imageHeight","diff","offset","Math","ceil","style","marginTop","imageWidth","_diff","_offset","marginLeft","type","config","createHeader","component","_listTile2","assign","icon","front","_icon2","actionLayoutClasses","horizontal","vertical","justified","actionClassForLayout","layout","createActions","createPrimary","partOpts","lookup","pops","attrs","Array","isArray","part","createView","ctrl","url","props","id","events","unshift","_shadow2","z","animated","before","after","controller","prop","view"],"mappings":"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","file":"card.js","sourcesContent":["import 'polythene/common/object.assign';\nimport m from 'mithril';\nimport shadow from 'polythene/shadow/shadow';\nimport icon from 'polythene/icon/icon';\nimport listTile from 'polythene/list-tile/list-tile';\nimport 'polythene/card/theme/theme';\n\nconst CSS_CLASSES = {\n    block: 'pe-card',\n    overlay: 'pe-card__overlay',\n    overlaySheet: 'pe-card__overlay--sheet',\n    overlayContent: 'pe-card__overlay__content',\n    mediaDimmer: 'pe-card__media__dimmer',\n    mediaCropX: 'pe-card__media--crop-x',\n    mediaCropY: 'pe-card__media--crop-y',\n    media: 'pe-card__media',\n    header: 'pe-card__header',\n    headerTitle: 'pe-card__header-title',\n    title: 'pe-card__title',\n    subtitle: 'pe-card__subtitle',\n    text: 'pe-card__text',\n    primary: 'pe-card__primary',\n    primaryMedia: 'pe-card__primary__media',\n    actions: 'pe-card__actions',\n    actionsHorizontal: 'pe-card__actions--horizontal',\n    actionsVertical: 'pe-card__actions--vertical',\n    actionsJustified: 'pe-card__actions--justified',\n    actionsBordered: 'pe-card__actions--borders',\n    mediaRatioSquare: 'pe-card__media--square',\n    mediaRatioLandscape: 'pe-card__media--landscape',\n    primaryHasMedia: 'pe-card__primary--media',\n    mediaSmall: 'pe-card__media--small',\n    mediaRegular: 'pe-card__media--regular',\n    mediaMedium: 'pe-card__media--medium',\n    mediaLarge: 'pe-card__media--large'\n};\n\nconst imageRatios = {\n    landscape: 16 / 9,\n    square: 1\n};\n\nconst createOverlay = (opts = {}) => {\n    const tag = opts.tag || 'div';\n    const content = opts.content.map(function(o) {\n        const key = Object.keys(o)[0];\n        return contentMap[key](o);\n    });\n    return m('div', {\n        class: [\n            CSS_CLASSES.overlay,\n            opts.sheet ? CSS_CLASSES.overlaySheet : null,\n        ].join(' ')\n    }, [\n        m(tag, {\n            class: [CSS_CLASSES.overlayContent, opts.class].join(' ')\n        }, content),\n        m('div', {\n            class: CSS_CLASSES.mediaDimmer\n        })\n    ]);\n};\n\nconst createText = o => {\n    const opts = o.text || {};\n    const tag = opts.tag || 'div';\n    return m(tag, {\n        class: [CSS_CLASSES.text, opts.class].join(' ')\n    }, opts.content);\n};\n\n// media type to class\n\nconst mediaTypeClasses = {\n    small: CSS_CLASSES.mediaSmall,\n    regular: CSS_CLASSES.mediaRegular,\n    medium: CSS_CLASSES.mediaMedium,\n    large: CSS_CLASSES.mediaLarge\n};\n\nconst mediaClassForType = (mode = 'regular') => {\n    return mediaTypeClasses[mode];\n};\n\nconst createMedia = o => {\n    const opts = o.media || {};\n    const ratio = opts.ratio || 'landscape';\n    const origin = opts.origin || 'center';\n    const tag = opts.tag || 'div';\n\n    let initImage = function(el, inited) {\n        if (inited) {\n            return;\n        }\n        let img = el.querySelector('img');\n        if (img) {\n            img.onload = function() {\n                const w = this.naturalWidth;\n                const h = this.naturalHeight;\n                const naturalRatio = w / h;\n                // crop-x: crop over x axis\n                // crop-y: crop over y axis\n                const cropClass = (naturalRatio < imageRatios[ratio]) ? CSS_CLASSES.mediaCropX : CSS_CLASSES.mediaCropY;\n                img.className = cropClass;\n\n                if (origin !== 'start') {\n                    const clientWidth = el.clientWidth;\n                    const clientHeight = el.clientHeight;\n                    if (naturalRatio < imageRatios[ratio]) {\n                        // orient on y axis\n                        const imageHeight = clientWidth / naturalRatio;\n                        const diff = clientHeight - imageHeight;\n                        const offset = Math.ceil((origin === 'center') ? diff / 2 : diff);\n                        this.style.marginTop = offset + 'px';\n                    } else {\n                        // orient on x axis\n                        const imageWidth = clientHeight * naturalRatio;\n                        const diff = clientWidth - imageWidth;\n                        const offset = Math.ceil((origin === 'center') ? diff / 2 : diff);\n                        this.style.marginLeft = offset + 'px';\n                    }\n                }\n            };\n        }\n    };\n\n    return m(tag, {\n        class: [\n            CSS_CLASSES.media,\n            mediaClassForType(opts.type),\n            (ratio === 'landscape' ? CSS_CLASSES.mediaRatioLandscape : CSS_CLASSES.mediaRatioSquare),\n            opts.class\n        ].join(' '),\n        config: initImage\n    }, [\n        opts.content,\n        opts.overlay ? createOverlay(opts.overlay) : m('div', {class: CSS_CLASSES.mediaDimmer})\n    ]);\n};\n\nconst createHeader = o => {\n    const opts = o.header || {};\n    return m.component(listTile, Object.assign({}, opts, {\n        class: [CSS_CLASSES.header, opts.class].join(' ')\n    }, opts.icon ? {\n        front: m.component(icon, opts.icon),\n    } : null));\n};\n\nconst actionLayoutClasses = {\n    horizontal: CSS_CLASSES.actionsHorizontal,\n    vertical: CSS_CLASSES.actionsVertical,\n    justified: CSS_CLASSES.actionsJustified\n};\nconst actionClassForLayout = (layout = 'horizontal') => (actionLayoutClasses[layout]);\n\nconst createActions = o => {\n    const opts = o.actions || {};\n    const tag = opts.tag || 'div';\n    return m(tag, {\n        class: [CSS_CLASSES.actions, actionClassForLayout(opts.layout), opts.class].join(' ')\n    }, opts.content);\n};\n\nconst createPrimary = o => {\n    let content, key, partOpts;\n    const opts = o.primary || {};\n    const tag = opts.tag || 'div';\n    let primaryHasMedia = false;\n\n    const lookup = {\n        title: function(pops) {\n            return pops.attrs ? pops : m('div', {class: CSS_CLASSES.title}, [\n                pops.title ? pops.title : null,\n                pops.subtitle ? m('div', {class: CSS_CLASSES.subtitle}, pops.subtitle) : null\n            ]);\n        },\n        media: function(pops) {\n            primaryHasMedia = true;\n            return m('div', {\n                class: CSS_CLASSES.primaryMedia\n            }, createMedia({\n                media: pops\n            }));\n        },\n        actions: function(pops) {\n            return createActions({\n                actions: pops\n            });\n        }\n    };\n\n    if (Array.isArray(opts.content)) {\n        content = opts.content.map(function(part) {\n            key = Object.keys(part)[0];\n            partOpts = part[key];\n            if (lookup[key]) {\n                return lookup[key](partOpts);\n            } else {\n                return part;\n            }\n        });\n    } else {\n        // shorthand for simple primary titles\n        content = [\n            opts.title ? lookup.title({\n                title: opts.title,\n                subtitle: opts.subtitle\n            }) : null,\n            opts.media ? lookup.media(opts.media) : null,\n            opts.actions ? lookup.actions(opts.actions) : null,\n            opts.content ? opts.content : null\n        ];\n    }\n    return m(tag, {\n        class: [\n            CSS_CLASSES.primary,\n            (primaryHasMedia ? CSS_CLASSES.primaryHasMedia : null)\n        ].join(' ')\n    }, content);\n};\n\nconst contentMap = {\n    text: createText,\n    media: createMedia,\n    header: createHeader,\n    primary: createPrimary,\n    actions: createActions\n};\n\nconst createView = (ctrl, opts = {}) => {\n    const tag = opts.tag || opts.url ? 'a' : 'div';\n    const props = Object.assign({}, {\n        class: [CSS_CLASSES.block, opts.class].join(' '),\n        id: opts.id || '',\n        config: opts.config\n    }, (opts.url ? opts.url : null), (opts.events ? opts.events : null));\n\n    let content;\n    if (Array.isArray(opts.content)) {\n        content = opts.content.map(function(o) {\n            const key = Object.keys(o)[0];\n            return contentMap[key](o);\n        });\n        content.unshift(m.component(shadow, {\n            z: ctrl.z(),\n            animated: true\n        }));\n    } else {\n        content = [\n            m.component(shadow, {\n                z: ctrl.z(),\n                animated: true\n            }),\n            opts.content\n        ];\n    }\n    return m(tag, props, [opts.before, content, opts.after]);\n};\n\nconst component = {\n    controller: (opts = {}) => {\n        let z = (opts.z !== undefined) ? opts.z : 1;\n        return {\n            z: m.prop(z)\n        };\n    },\n    view: (ctrl, opts = {}) => {\n        return createView(ctrl, opts);\n    }\n};\n\nexport default component;\n"]}