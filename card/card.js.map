{"version":3,"sources":["card.es6"],"names":["CSS_CLASSES","block","overlay","overlaySheet","overlayContent","mediaDimmer","mediaCropX","mediaCropY","media","header","headerTitle","title","subtitle","text","primary","primaryMedia","actions","actionsHorizontal","actionsVertical","actionsJustified","actionsBordered","mediaRatioSquare","mediaRatioLandscape","primaryHasMedia","mediaSmall","mediaRegular","mediaMedium","mediaLarge","imageRatios","landscape","square","createOverlay","opts","tag","content","map","Object","keys","o","contentMap","key","sheet","join","class","createText","mediaTypeClasses","small","regular","medium","large","mediaClassForType","mode","createMedia","ratio","origin","type","config","initImage","inited","el","querySelector","img","onload","naturalWidth","naturalHeight","w","h","naturalRatio","className","cropClass","clientWidth","clientHeight","Math","ceil","diff","style","marginTop","offset","marginLeft","createHeader","component","assign","icon","front","actionLayoutClasses","horizontal","vertical","justified","actionClassForLayout","layout","createActions","createPrimary","pops","attrs","Array","isArray","part","lookup","partOpts","createView","url","id","events","unshift","z","ctrl","animated","props","before","after","controller","prop","view"],"mappings":"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","file":"card.js","sourcesContent":["import 'polythene/common/object.assign';\nimport m from 'mithril';\nimport shadow from 'polythene/shadow/shadow';\nimport icon from 'polythene/icon/icon';\nimport listTile from 'polythene/list-tile/list-tile';\nimport 'polythene/card/theme/theme';\n\nconst CSS_CLASSES = {\n    block: 'pe-card',\n    overlay: 'pe-card__overlay',\n    overlaySheet: 'pe-card__overlay--sheet',\n    overlayContent: 'pe-card__overlay__content',\n    mediaDimmer: 'pe-card__media__dimmer',\n    mediaCropX: 'pe-card__media--crop-x',\n    mediaCropY: 'pe-card__media--crop-y',\n    media: 'pe-card__media',\n    header: 'pe-card__header',\n    headerTitle: 'pe-card__header-title',\n    title: 'pe-card__title',\n    subtitle: 'pe-card__subtitle',\n    text: 'pe-card__text',\n    primary: 'pe-card__primary',\n    primaryMedia: 'pe-card__primary__media',\n    actions: 'pe-card__actions',\n    actionsHorizontal: 'pe-card__actions--horizontal',\n    actionsVertical: 'pe-card__actions--vertical',\n    actionsJustified: 'pe-card__actions--justified',\n    actionsBordered: 'pe-card__actions--borders',\n    mediaRatioSquare: 'pe-card__media--square',\n    mediaRatioLandscape: 'pe-card__media--landscape',\n    primaryHasMedia: 'pe-card__primary--media',\n    mediaSmall: 'pe-card__media--small',\n    mediaRegular: 'pe-card__media--regular',\n    mediaMedium: 'pe-card__media--medium',\n    mediaLarge: 'pe-card__media--large'\n};\n\nconst imageRatios = {\n    landscape: 16 / 9,\n    square: 1\n};\n\nconst createOverlay = (opts = {}) => {\n    const tag = opts.tag || 'div';\n    const content = opts.content.map(function(o) {\n        const key = Object.keys(o)[0];\n        return contentMap[key](o);\n    });\n    return m('div', {\n        class: [\n            CSS_CLASSES.overlay,\n            opts.sheet ? CSS_CLASSES.overlaySheet : null,\n        ].join(' ')\n    }, [\n        m(tag, {\n            class: [CSS_CLASSES.overlayContent, opts.class].join(' ')\n        }, content),\n        m('div', {\n            class: CSS_CLASSES.mediaDimmer\n        })\n    ]);\n};\n\nconst createText = o => {\n    const opts = o.text || {};\n    const tag = opts.tag || 'div';\n    return m(tag, {\n        class: [CSS_CLASSES.text, opts.class].join(' ')\n    }, opts.content);\n};\n\n// media type to class\n\nconst mediaTypeClasses = {\n    small: CSS_CLASSES.mediaSmall,\n    regular: CSS_CLASSES.mediaRegular,\n    medium: CSS_CLASSES.mediaMedium,\n    large: CSS_CLASSES.mediaLarge\n};\n\nconst mediaClassForType = (mode = 'regular') => {\n    return mediaTypeClasses[mode];\n};\n\nconst createMedia = o => {\n    const opts = o.media || {};\n    const ratio = opts.ratio || 'landscape';\n    const origin = opts.origin || 'center';\n    const tag = opts.tag || 'div';\n\n    let initImage = function(el, inited) {\n        if (inited) {\n            return;\n        }\n        let img = el.querySelector('img');\n        if (img) {\n            img.onload = function() {\n                const w = this.naturalWidth;\n                const h = this.naturalHeight;\n                const naturalRatio = w / h;\n                // crop-x: crop over x axis\n                // crop-y: crop over y axis\n                const cropClass = (naturalRatio < imageRatios[ratio]) ? CSS_CLASSES.mediaCropX : CSS_CLASSES.mediaCropY;\n                img.className = cropClass;\n\n                if (origin !== 'start') {\n                    const clientWidth = el.clientWidth;\n                    const clientHeight = el.clientHeight;\n                    if (naturalRatio < imageRatios[ratio]) {\n                        // orient on y axis\n                        const imageHeight = clientWidth / naturalRatio;\n                        const diff = clientHeight - imageHeight;\n                        const offset = Math.ceil((origin === 'center') ? diff / 2 : diff);\n                        this.style.marginTop = offset + 'px';\n                    } else {\n                        // orient on x axis\n                        const imageWidth = clientHeight * naturalRatio;\n                        const diff = clientWidth - imageWidth;\n                        const offset = Math.ceil((origin === 'center') ? diff / 2 : diff);\n                        this.style.marginLeft = offset + 'px';\n                    }\n                }\n            };\n        }\n    };\n\n    return m(tag, {\n        class: [\n            CSS_CLASSES.media,\n            mediaClassForType(opts.type),\n            (ratio === 'landscape' ? CSS_CLASSES.mediaRatioLandscape : CSS_CLASSES.mediaRatioSquare),\n            opts.class\n        ].join(' '),\n        config: initImage\n    }, [\n        opts.content,\n        opts.overlay ? createOverlay(opts.overlay) : m('div', {class: CSS_CLASSES.mediaDimmer})\n    ]);\n};\n\nconst createHeader = o => {\n    const opts = o.header || {};\n    return m.component(listTile, Object.assign({}, opts, {\n        class: [CSS_CLASSES.header, opts.class].join(' ')\n    }, opts.icon ? {\n        front: m.component(icon, opts.icon),\n    } : null));\n};\n\nconst actionLayoutClasses = {\n    horizontal: CSS_CLASSES.actionsHorizontal,\n    vertical: CSS_CLASSES.actionsVertical,\n    justified: CSS_CLASSES.actionsJustified\n};\nconst actionClassForLayout = (layout = 'horizontal') => (actionLayoutClasses[layout]);\n\nconst createActions = o => {\n    const opts = o.actions || {};\n    const tag = opts.tag || 'div';\n    return m(tag, {\n        class: [CSS_CLASSES.actions, actionClassForLayout(opts.layout), opts.class].join(' ')\n    }, opts.content);\n};\n\nconst createPrimary = o => {\n    let content, key, partOpts;\n    const opts = o.primary || {};\n    const tag = opts.tag || 'div';\n    let primaryHasMedia = false;\n\n    const lookup = {\n        title: function(pops) {\n            return pops.attrs ? pops : m('div', {class: CSS_CLASSES.title}, [\n                pops.title ? pops.title : null,\n                pops.subtitle ? m('div', {class: CSS_CLASSES.subtitle}, pops.subtitle) : null\n            ]);\n        },\n        media: function(pops) {\n            primaryHasMedia = true;\n            return m('div', {\n                class: CSS_CLASSES.primaryMedia\n            }, createMedia({\n                media: pops\n            }));\n        },\n        actions: function(pops) {\n            return createActions({\n                actions: pops\n            });\n        }\n    };\n\n    if (Array.isArray(opts.content)) {\n        content = opts.content.map(function(part) {\n            key = Object.keys(part)[0];\n            partOpts = part[key];\n            if (lookup[key]) {\n                return lookup[key](partOpts);\n            } else {\n                return part;\n            }\n        });\n    } else {\n        // shorthand for simple primary titles\n        content = [\n            opts.title ? lookup.title({\n                title: opts.title,\n                subtitle: opts.subtitle\n            }) : null,\n            opts.media ? lookup.media(opts.media) : null,\n            opts.actions ? lookup.actions(opts.actions) : null,\n            opts.content ? opts.content : null\n        ];\n    }\n    return m(tag, {\n        class: [\n            CSS_CLASSES.primary,\n            (primaryHasMedia ? CSS_CLASSES.primaryHasMedia : null)\n        ].join(' ')\n    }, content);\n};\n\nconst contentMap = {\n    text: createText,\n    media: createMedia,\n    header: createHeader,\n    primary: createPrimary,\n    actions: createActions\n};\n\nconst createView = (ctrl, opts = {}) => {\n    const tag = opts.tag || opts.url ? 'a' : 'div';\n    const props = Object.assign({}, {\n        class: [CSS_CLASSES.block, opts.class].join(' '),\n        id: opts.id || '',\n        config: opts.config\n    }, (opts.url ? opts.url : null), (opts.events ? opts.events : null));\n\n    let content;\n    if (Array.isArray(opts.content)) {\n        content = opts.content.map(function(o) {\n            const key = Object.keys(o)[0];\n            return contentMap[key](o);\n        });\n        content.unshift(m.component(shadow, {\n            z: ctrl.z(),\n            animated: true\n        }));\n    } else {\n        content = [\n            m.component(shadow, {\n                z: ctrl.z(),\n                animated: true\n            }),\n            opts.content\n        ];\n    }\n    return m(tag, props, [opts.before, content, opts.after]);\n};\n\nconst component = {\n    controller: (opts = {}) => {\n        let z = (opts.z !== undefined) ? opts.z : 1;\n        return {\n            z: m.prop(z)\n        };\n    },\n    view: (ctrl, opts = {}) => {\n        return createView(ctrl, opts);\n    }\n};\n\nexport default component;\n"]}