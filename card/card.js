"use strict";Object.defineProperty(exports,"__esModule",{value:true});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}require("polythene/common/object.assign");var _mithril=require("mithril");var _mithril2=_interopRequireDefault(_mithril);var _polytheneShadowShadow=require("polythene/shadow/shadow");var _polytheneShadowShadow2=_interopRequireDefault(_polytheneShadowShadow);var _polytheneIconIcon=require("polythene/icon/icon");var _polytheneIconIcon2=_interopRequireDefault(_polytheneIconIcon);require("polythene/card/theme/theme");var CSS_CLASSES={block:"pe-card",overlay:"pe-card__overlay",overlaySheet:"pe-card__overlay--sheet",overlayContent:"pe-card__overlay__content",mediaDimmer:"pe-card__media__dimmer",mediaCropX:"pe-card__media--crop-x",mediaCropY:"pe-card__media--crop-y",media:"pe-card__media",header:"pe-card__header",headerTitle:"pe-card__header-title",headerSubtitle:"pe-card__header-subtitle",title:"pe-card__title",subtitle:"pe-card__subtitle",titleFront:"pe-card__header__front",text:"pe-card__text",primary:"pe-card__primary",primaryMedia:"pe-card__primary__media",actions:"pe-card__actions",actionsBordered:"pe-card__actions--borders",mediaRatioSquare:"pe-card__media--square",mediaRatioLandscape:"pe-card__media--landscape",primaryHasMedia:"pe-card__primary--media",mediaSmall:"pe-card__media--small",mediaRegular:"pe-card__media--regular",mediaMedium:"pe-card__media--medium",mediaLarge:"pe-card__media--large"};var imageRatios={landscape:16/9,square:1};var createOverlay=function createOverlay(){var opts=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];var tag=opts.tag||"div";var content=opts.content.map(function(o){var key=Object.keys(o)[0];return contentMap[key](o)});return(0,_mithril2["default"])("div",{"class":[CSS_CLASSES.overlay,opts.sheet?CSS_CLASSES.overlaySheet:null].join(" ")},[(0,_mithril2["default"])(tag,{"class":[CSS_CLASSES.overlayContent,opts["class"]].join(" ")},content),(0,_mithril2["default"])("div",{"class":CSS_CLASSES.mediaDimmer})])};var createText=function createText(o){var opts=o.text||{};var tag="div"||opts.tag;return(0,_mithril2["default"])(tag,{"class":[CSS_CLASSES.text,opts["class"]].join(" ")},opts.content)};var mediaTypeClasses={small:CSS_CLASSES.mediaSmall,regular:CSS_CLASSES.mediaRegular,medium:CSS_CLASSES.mediaMedium,large:CSS_CLASSES.mediaLarge};var mediaClassForType=function mediaClassForType(){var mode=arguments.length<=0||arguments[0]===undefined?"regular":arguments[0];return mediaTypeClasses[mode]};var createMedia=function createMedia(o){var opts=o.media||{};var ratio=opts.ratio||"landscape";var origin=opts.origin||"center";var tag="div"||opts.tag;var initImage=function initImage(el,inited){if(inited){return}var img=el.querySelector("img");if(img){img.onload=function(){var w=this.naturalWidth;var h=this.naturalHeight;var naturalRatio=w/h;var cropClass=naturalRatio<imageRatios[ratio]?CSS_CLASSES.mediaCropX:CSS_CLASSES.mediaCropY;img.className=cropClass;if(origin!=="start"){var clientWidth=el.clientWidth;var clientHeight=el.clientHeight;if(naturalRatio<imageRatios[ratio]){var imageHeight=clientWidth/naturalRatio;var diff=clientHeight-imageHeight;var offset=Math.ceil(origin==="center"?diff/2:diff);this.style.marginTop=offset+"px"}else{var imageWidth=clientHeight*naturalRatio;var diff=clientWidth-imageWidth;var offset=Math.ceil(origin==="center"?diff/2:diff);this.style.marginLeft=offset+"px"}}}}};return(0,_mithril2["default"])(tag,{"class":[CSS_CLASSES.media,mediaClassForType(opts.type),ratio==="landscape"?CSS_CLASSES.mediaRatioLandscape:CSS_CLASSES.mediaRatioSquare].join(" "),config:initImage},[opts.content,opts.overlay?createOverlay(opts.overlay):(0,_mithril2["default"])("div",{"class":CSS_CLASSES.mediaDimmer})])};var createHeader=function createHeader(o){var opts=o.header||{};var tag=opts.tag||"a.layout.horizontal.center";var props=Object.assign({"class":[CSS_CLASSES.header,opts["class"]].join(" "),config:opts.config},opts.url?opts.url:null,opts.events?opts.events:null);return(0,_mithril2["default"])(tag,props,[opts.icon?(0,_mithril2["default"])("div",{"class":CSS_CLASSES.titleFront},_mithril2["default"].component(_polytheneIconIcon2["default"],opts.icon)):null,(0,_mithril2["default"])("div",{"class":CSS_CLASSES.headerTitle},[opts.title?opts.title:null,opts.subtitle?(0,_mithril2["default"])("div",{"class":CSS_CLASSES.headerSubtitle},opts.subtitle):null])])};var createActions=function createActions(o){var opts=o.actions||{};var tag=opts.tag||".layout.horizontal.center";return(0,_mithril2["default"])(tag,{"class":[CSS_CLASSES.actions,opts["class"]].join(" ")},opts.content)};var createPrimary=function createPrimary(o){var content=undefined,key=undefined,partOpts=undefined;var opts=o.primary||{};var tag=".layout.horizontal"||opts.tag;var primaryHasMedia=false;var lookup={title:function title(pops){return pops.attrs?pops:(0,_mithril2["default"])("div",{"class":CSS_CLASSES.title},[pops.title?pops.title:null,pops.subtitle?(0,_mithril2["default"])("div",{"class":CSS_CLASSES.subtitle},pops.subtitle):null])},media:function media(pops){primaryHasMedia=true;return(0,_mithril2["default"])("div",{"class":CSS_CLASSES.primaryMedia},createMedia({media:pops}))},actions:function actions(pops){return createActions({actions:pops})}};if(Array.isArray(opts.content)){content=opts.content.map(function(part){key=Object.keys(part)[0];partOpts=part[key];if(lookup[key]){return lookup[key](partOpts)}else{return part}})}else{content=[opts.title?lookup.title({title:opts.title,subtitle:opts.subtitle}):null,opts.media?lookup.media(opts.media):null,opts.actions?lookup.actions(opts.actions):null,opts.content?opts.content:null]}return(0,_mithril2["default"])(tag,{"class":[CSS_CLASSES.primary,primaryHasMedia?CSS_CLASSES.primaryHasMedia:null].join(" ")},content)};var contentMap={text:createText,media:createMedia,header:createHeader,primary:createPrimary,actions:createActions};var createView=function createView(ctrl){var opts=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var tag=opts.tag||opts.url?"a":"div";var props=Object.assign({"class":[CSS_CLASSES.block,opts["class"]].join(" "),id:opts.id||"",config:opts.config},opts.url?opts.url:null,opts.events?opts.events:null);var content=undefined;if(Array.isArray(opts.content)){content=opts.content.map(function(o){var key=Object.keys(o)[0];return contentMap[key](o)});content.unshift(_mithril2["default"].component(_polytheneShadowShadow2["default"],{z:ctrl.z(),animated:true}))}else{content=[_mithril2["default"].component(_polytheneShadowShadow2["default"],{z:ctrl.z(),animated:true}),opts.content]}return(0,_mithril2["default"])(tag,props,[opts.before,content,opts.after])};var component={controller:function controller(){var opts=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];var z=opts.z!==undefined?opts.z:1;return{z:_mithril2["default"].prop(z)}},view:function view(ctrl){var opts=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];return createView(ctrl,opts)}};exports["default"]=component;module.exports=exports["default"];