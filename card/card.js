"use strict";Object.defineProperty(exports,"__esModule",{value:true});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}require("polythene/common/object.assign");var _polythenePolythenePolythene=require("polythene/polythene/polythene");var _polythenePolythenePolythene2=_interopRequireDefault(_polythenePolythenePolythene);var _mithril=require("mithril");var _mithril2=_interopRequireDefault(_mithril);var _polytheneShadowShadow=require("polythene/shadow/shadow");var _polytheneShadowShadow2=_interopRequireDefault(_polytheneShadowShadow);var _polytheneIconIcon=require("polythene/icon/icon");var _polytheneIconIcon2=_interopRequireDefault(_polytheneIconIcon);require("polythene-theme/card/card");var imageRatios={landscape:16/9,square:1};var contentMap=undefined;var createOverlay=function createOverlay(){var opts=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];var tag=opts.tag||"div";var className=["overlay-content",opts["class"]].join(" ");var content=opts.content.map(function(o){var key=Object.keys(o)[0];return contentMap[key](o)});return(0,_mithril2["default"])(".overlay",[(0,_mithril2["default"])(tag,{"class":className},content),(0,_mithril2["default"])(".image-dimmer")])};var createText=function createText(o){var opts=o.text||{};var className=["text",opts["class"]].join(" ");var tag="div"||opts.tag;return(0,_mithril2["default"])(tag,{"class":className},_mithril2["default"].trust(opts.content))};var createMedia=function createMedia(o){var opts=o.media||{};var ratio=opts.ratio||"landscape";var origin=opts.origin||"center";var className=["media",opts.type||null,ratio,opts["class"]].join(" ");var tag="div"||opts.tag;var initImage=function initImage(el,inited){if(inited){return}var img=el.querySelector("img");if(img){img.onload=function(){var w=this.naturalWidth;var h=this.naturalHeight;var naturalRatio=w/h;var cropClass=naturalRatio<imageRatios[ratio]?"crop-x":"crop-y";img.className=cropClass;if(origin!=="start"){var clientWidth=el.clientWidth;var clientHeight=el.clientHeight;if(naturalRatio<imageRatios[ratio]){var imageHeight=clientWidth/naturalRatio;var diff=clientHeight-imageHeight;var offset=origin==="center"?diff/2:diff;this.style.marginTop=offset+"px"}else{var imageWidth=clientHeight*naturalRatio;var diff=clientWidth-imageWidth;var offset=origin==="center"?diff/2:diff;this.style.marginLeft=offset+"px"}}}}};return(0,_mithril2["default"])(tag,{"class":className,config:initImage},[opts.content,opts.overlay?createOverlay(opts.overlay):(0,_mithril2["default"])(".image-dimmer")])};var createHeader=function createHeader(o){var opts=o.header||{};var tag=opts.tag||"a.layout.horizontal.center";var props=Object.assign({"class":["header",opts["class"]].join(" "),config:opts.config},opts.url?opts.url:null,opts.events?opts.events:null);return(0,_mithril2["default"])(tag,props,[opts.icon?(0,_mithril2["default"])(".content-icon",_mithril2["default"].component(_polytheneIconIcon2["default"],opts.icon)):null,(0,_mithril2["default"])(".title.flex",[opts.title?_mithril2["default"].trust(opts.title):null,opts.subtitle?(0,_mithril2["default"])(".subtitle",_mithril2["default"].trust(opts.subtitle)):null])])};var createActions=function createActions(o){var opts=o.actions||{};var tag=opts.tag||".layout.horizontal.center";var className=["actions",opts["class"]].join(" ");return(0,_mithril2["default"])(tag,{"class":className},opts.content)};var createPrimary=function createPrimary(o){var className=undefined,content=undefined,key=undefined,partOpts=undefined,hasMedia=undefined;var opts=o.primary||{};var tag=".layout.horizontal"||opts.tag;className=["primary",opts.media?"has-media":null,opts["class"]].join(" ");hasMedia=false;var lookup={title:function title(pops){return pops.attrs?pops:(0,_mithril2["default"])(".title.flex",[pops.title?_mithril2["default"].trust(pops.title):null,pops.subtitle?(0,_mithril2["default"])(".subtitle",_mithril2["default"].trust(pops.subtitle)):null])},media:function media(pops){hasMedia=true;return(0,_mithril2["default"])("div",{"class":["primary-media",pops.type].join(" ")},createMedia({media:pops}))},actions:function actions(pops){return createActions({actions:pops})}};if(Array.isArray(opts.content)){content=opts.content.map(function(part){key=Object.keys(part)[0];partOpts=part[key];if(lookup[key]){return lookup[key](partOpts)}else{return part}})}else{content=[opts.title?lookup.title({title:opts.title,subtitle:opts.subtitle}):null,opts.media?lookup.media(opts.media):null,opts.actions?lookup.actions(opts.actions):null]}if(hasMedia){className+=" has-media"}return(0,_mithril2["default"])(tag,{"class":className},content)};var createView=function createView(ctrl){var opts=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var tag=opts.tag||opts.url?"a":"div";var props=Object.assign({"class":["card",opts["class"]].join(" "),id:opts.id||"",config:opts.config},opts.url?opts.url:null,opts.events?opts.events:null);var content=opts.content.map(function(o){var key=Object.keys(o)[0];return contentMap[key](o)});content.unshift(_mithril2["default"].component(_polytheneShadowShadow2["default"],{z:ctrl.z(),animated:true}));return(0,_mithril2["default"])(tag,props,_polythenePolythenePolythene2["default"].insertContent(content,opts))};contentMap={text:createText,media:createMedia,header:createHeader,primary:createPrimary,actions:createActions};var component={controller:function controller(){var opts=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];var z=opts.z!==undefined?opts.z:1;return{z:_mithril2["default"].prop(z)}},view:function view(ctrl){var opts=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];return createView(ctrl,opts)}};exports["default"]=component;module.exports=exports["default"];