{"version":3,"sources":["header-panel.es6"],"names":["require","_polythene","_events","_mithril","_toolbar","CSS_CLASSES","panel","header","dropShadow","outerContainer","headerContainer","backgroundContainer","condensedBackground","headerBackground","mediaDimmer","mainContainer","headerAnimated","fixed","cascaded","modeCover","modeScroll","modeSeamed","modeStandard","modeTall","modeWaterfallTall","modeWaterfall","toolbar","toolbarTopbar","headerTall","DEFAULT_SHADOW_HEIGTH","DEFAULT_HEADER_HEIGHT","DEFAULT_CONDENSED_HEADER_HEIGHT","SCROLL_WATCH_TIMER","scroller","scrollPositions","modeConfigs","shadowAfterScroll","waterfall","waterfall-tall","alwaysShadow","standard","tall","noShadow","seamed","cover","scroll","tallMode","outerScroll","modeClasses","classForMode","mode","arguments","length","undefined","setTransform","style","string","transform","document","documentElement","webkitTransform","translateY","y","t","createHeaderComponent","opts","tallClass","toolbarOpts","class","join","topBar","_mithril2","default","component","_toolbar2","content","animated","createViewHeader","ctrl","initHeaderContainer","inited","headerContainerElem","Object","assign","headerConfig","config","shadow","createViewContent","scrollConfig","initMainContainer","main","scrollerElem","onscroll","e","_events2","emit","storeScrollPosition","target","scrollTop","createView","configs","init","updateContentOnScroll","ignoreContent","isScrolling","scrollerType","handleScroll","bind","tag","initOuterContainer","headerElem","querySelector","topBarElem","headerBg","condensedHeaderBg","outerContainerElem","headerTopBarElem","setHeight","clientHeight","outer","restoreScrollPosition","props","id","el","headerPanelElem","subtree","before","after","controller","scrolled","prevScrollTop","headerMargin","headerHeight","condenses","scrollAwayTopbar","noReveal","keepCondensedHeader","noDissolve","backgroundScrollSpeed","shadowHeight","condensedHeaderHeight","handleScrollFns","isScrolled","showShadow","classList","dynamicHeader","sy","sTop","scrollInited","initialScrollPosition","initialPositionFixed","Math","min","max","transformHeader","_polythene2","isTouch","enlargeImage","handleScrollFn","scrollWatchId","h","paddingTop","clearTimeout","setTimeout","condenseHeader","hy","reset","hbg","opacity","chbg","height","condensedHeight","abs","restoreScrollPositionId","restore","view"],"mappings":"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","file":"header-panel.js","sourcesContent":["import 'polythene/common/object.assign';\nimport p from 'polythene/polythene/polythene';\nimport events from 'polythene/common/events';\nimport m from 'mithril';\nimport toolbar from 'polythene/toolbar/toolbar';\nimport 'polythene/header-panel/theme/theme';\n\nconst CSS_CLASSES = {\n    panel: 'pe-header-panel',\n    header: 'pe-header',\n    dropShadow: 'pe-header-panel__drop-shadow',\n    outerContainer: 'pe-header-panel__outer-container',\n    headerContainer: 'pe-header-panel__header-container',\n    backgroundContainer: 'pe-header-panel__background-container',\n    condensedBackground: 'pe-header-panel__condensed-background',\n    headerBackground: 'pe-header-panel__header-background',\n    mediaDimmer: 'pe-header-panel__media-dimmer',\n    mainContainer: 'pe-header-panel__main-container',\n\n    headerAnimated: 'pe-header--animated',\n    fixed: 'pe-header-panel--fixed',\n    cascaded: 'pe-header-panel--cascaded',\n    modeCover: 'pe-header-panel--cover',\n    modeScroll: 'pe-header-panel--scroll',\n    modeSeamed: 'pe-header-panel--seamed',\n    modeStandard: 'pe-header-panel--standard',\n    modeTall: 'pe-header-panel--tall',\n    modeWaterfallTall: 'pe-header-panel--waterfall-tall',\n    modeWaterfall: 'pe-header-panel--waterfall',\n\n    // lookups:\n    toolbar: 'pe-toolbar',\n    toolbarTopbar: 'pe-toolbar__bar--top',\n    headerTall: 'pe-header--tall'\n};\n\nconst DEFAULT_SHADOW_HEIGTH = 6;\nconst DEFAULT_HEADER_HEIGHT = 192;\nconst DEFAULT_CONDENSED_HEADER_HEIGHT = DEFAULT_HEADER_HEIGHT / 3;\nconst SCROLL_WATCH_TIMER = 150;\n\nlet scroller; // keep track of scrolling elements on the page\nconst scrollPositions = {};\n\nconst modeConfigs = {\n    shadowAfterScroll: {\n        'waterfall': 1,\n        'waterfall-tall': 1\n    },\n    alwaysShadow: {\n        'standard': 1,\n        'tall': 1\n    },\n    noShadow: {\n        'seamed': 1,\n        'cover': 1,\n        'scroll': 1\n    },\n    tallMode: {\n        'tall': true,\n        'waterfall-tall': true\n    },\n    outerScroll: {\n        'scroll': 1\n    }\n};\n\nconst modeClasses = {\n    'cover': CSS_CLASSES.modeCover,\n    'scroll': CSS_CLASSES.modeScroll,\n    'seamed': CSS_CLASSES.modeSeamed,\n    'standard': CSS_CLASSES.modeStandard,\n    'tall': CSS_CLASSES.modeTall,\n    'waterfall-tall': CSS_CLASSES.modeWaterfallTall,\n    'waterfall': CSS_CLASSES.modeWaterfall\n};\n\nconst classForMode = (mode = 'standard') => {\n    return modeClasses[mode];\n};\n\nlet setTransform = (style, string) => {\n    style.transform = string;\n};\n\nif(typeof document !== \"undefined\") {\n\tsetTransform = (document.documentElement.style.transform !== undefined) ? ((style, string) => {\n\t    style.transform = string;\n\t}) : ((style, string) => {\n\t    style.webkitTransform = string;\n\t});\n}\n\nconst translateY = (style, y) => {\n    const t = (y === null) ? '' : 'translate3d(0, ' + y + 'px, 0)';\n    setTransform(style, t);\n};\n\nconst createHeaderComponent = (opts = {}) => {\n    const tall = opts.tall || false;\n    const tallClass = opts.tallClass || '';\n    const toolbarOpts = opts.toolbar;\n    if (toolbarOpts) {\n        toolbarOpts.class = [\n            (toolbarOpts.class || null),\n            tall ? tallClass : null\n        ].join(' ');\n        if (!toolbarOpts.topBar) {\n            toolbarOpts.topBar = m('div');\n        }\n        return m.component(toolbar, toolbarOpts);\n    } else if (opts.content) {\n        return m('div', {\n            class: [\n                CSS_CLASSES.header,\n                (opts.class || null),\n                (tall ? tallClass : null),\n                (opts.animated ? CSS_CLASSES.headerAnimated : '')\n            ].join(' ')\n        }, opts.content);\n    } else {\n        return m('div', opts);\n    }\n};\n\nconst createViewHeader = (ctrl, opts = {}) => {\n    const initHeaderContainer = (headerContainer, inited) => {\n        if (inited) {\n            return;\n        }\n        ctrl.headerContainerElem = headerContainer;\n    };\n    const header = opts.header ? createHeaderComponent(Object.assign({}, opts.header, ctrl.headerConfig)) : null;\n    return m('div', {\n        class: CSS_CLASSES.headerContainer,\n        config: initHeaderContainer\n    }, [\n        m('div', {\n            class: CSS_CLASSES.backgroundContainer\n        }, [\n            m('div', {class: CSS_CLASSES.condensedBackground}),\n            m('div', {class: CSS_CLASSES.headerBackground}),\n            m('div', {class: CSS_CLASSES.mediaDimmer})\n        ]),\n        header,\n        (ctrl.mode === 'seamed' || ctrl.shadow === false) ? null : m('div', {class: CSS_CLASSES.dropShadow})\n    ]);\n};\n\nconst createViewContent = (ctrl, scrollConfig, opts = {}) => {\n    const initMainContainer = (mainContainer, inited) => {\n        if (inited) {\n            return;\n        }\n        if (scrollConfig.main) {\n            ctrl.scrollerElem = mainContainer;\n        }\n    };\n    return [\n        m('div', {\n            class: CSS_CLASSES.mainContainer,\n            config: initMainContainer,\n            onscroll: (e) => {\n                scrollConfig.main(e);\n                events.emit('scroll', e);\n                ctrl.storeScrollPosition(e.target.scrollTop);\n            }\n        },\n        opts.content ? opts.content : null)\n    ];\n};\n\nconst createView = (ctrl, opts = {}) => {\n    opts.header = opts.header || {};\n    opts.configs = opts.configs || [];\n    ctrl.init(ctrl);\n\n    const updateContentOnScroll = opts.updateContentOnScroll || false;\n    const ignoreContent = !updateContentOnScroll && ctrl.isScrolling;\n    const scrollerType = modeConfigs.outerScroll[ctrl.mode] ? 'outer' : 'main';\n    const handleScroll = ctrl.handleScroll.bind(ctrl);\n    const header = createViewHeader(ctrl, opts);\n    const tag = opts.tag || 'div';\n\n    const scrollConfig = {};\n    scrollConfig[scrollerType] = handleScroll;\n\n    const initOuterContainer = (outerContainer, inited) => {\n        const headerElem = outerContainer.querySelector('.' + CSS_CLASSES.header) || outerContainer.querySelector('.' + CSS_CLASSES.toolbar);\n        if (!headerElem) {\n            return;\n        }\n        if (inited && ctrl.headerElem) {\n            return;\n        }\n        const headerContainer = outerContainer.querySelector('.' + CSS_CLASSES.headerContainer);\n        const topBarElem = headerContainer.querySelector('.' + CSS_CLASSES.toolbarTopbar);\n        const headerBg = headerContainer.querySelector('.' + CSS_CLASSES.headerBackground);\n        const condensedHeaderBg = headerContainer.querySelector('.' + CSS_CLASSES.condensedBackground);\n\n        ctrl.outerContainerElem = outerContainer;\n        ctrl.headerElem = headerElem;\n        ctrl.headerTopBarElem = topBarElem;\n        ctrl.headerBg = headerBg;\n        ctrl.condensedHeaderBg = condensedHeaderBg;\n\n        if (!opts.animated) {\n            ctrl.setHeight(headerContainer.clientHeight);\n        }\n        if (scrollConfig.outer) {\n            ctrl.scrollerElem = outerContainer;\n        }\n\n        ctrl.restoreScrollPosition();\n    };\n\n    const props = Object.assign({}, {\n        class: [\n            CSS_CLASSES.panel,\n            ctrl.fixed ? CSS_CLASSES.fixed : null,\n            classForMode(ctrl.mode),\n            opts.class\n        ].join(' '),\n        id: opts.id || '',\n        config: (el, inited) => {\n            if (inited) {\n                return;\n            }\n            ctrl.headerPanelElem = el;\n        }\n    });\n\n    const content = m('div', {\n        class: CSS_CLASSES.outerContainer,\n        config: initOuterContainer,\n        onscroll: (e) => {\n            scrollConfig.outer(e);\n            events.emit('scroll', e);\n        }\n    }, [\n        header,\n        ignoreContent ? {\n            subtree: 'retain'\n        } : createViewContent(ctrl, scrollConfig, opts)\n    ]);\n    return m(tag, props, [opts.before, content, opts.after]);\n};\n\nconst component = {\n    controller: (opts = {}) => {\n        let ctrl,\n            mode,\n            y,\n            scrolled,\n            prevScrollTop,\n            headerMargin,\n            headerHeight;\n\n        if (opts.mode) {\n            mode = opts.mode;\n        } else if (opts.header && opts.header.toolbar) {\n            mode = opts.header.toolbar.mode;\n        } else if (opts.header && opts.header.content) {\n            mode = opts.header.mode;\n        }\n        mode = mode || 'standard';\n        const tall = modeConfigs.tallMode[mode] || false;\n        const tallClass = opts.tallClass || CSS_CLASSES.headerTall;\n        const animated = opts.animated || false;\n        const fixed = opts.fixed || false;\n        const condenses = opts.condenses || false;\n        const scrollAwayTopbar = opts.scrollAwayTopbar || false;\n        const noReveal = opts.noReveal || false;\n        const keepCondensedHeader = opts.keepCondensedHeader || false;\n        const noDissolve = opts.noDissolve || false;\n        const backgroundScrollSpeed = (opts.backgroundScrollSpeed !== undefined) ? opts.backgroundScrollSpeed : 0.5;\n        y = 0;\n        scrolled = false;\n        prevScrollTop = 0;\n        // defaults, finally set with setHeight\n        const shadowHeight = DEFAULT_SHADOW_HEIGTH;\n        headerHeight = (opts.headerHeight || DEFAULT_HEADER_HEIGHT) + shadowHeight;\n        const condensedHeaderHeight = (opts.condensedHeaderHeight || DEFAULT_CONDENSED_HEADER_HEIGHT) + shadowHeight;\n        headerMargin = headerHeight - condensedHeaderHeight;\n\n        const handleScrollFns = {\n            standard: () => {\n                //\n            },\n            fixed: () => {\n                const isScrolled = (ctrl.scrollerElem.scrollTop > 0);\n                ctrl.showShadow(isScrolled);\n                scrolled = isScrolled;\n            },\n            animated: () => {\n                const isScrolled = (ctrl.scrollerElem.scrollTop > 0);\n                if (isScrolled !== scrolled) {\n                    const headerElem = ctrl.headerElem;\n                    if (headerElem && tall) {\n                        headerElem.classList[isScrolled ? 'remove' : 'add'](tallClass);\n                    }\n                    ctrl.showShadow(isScrolled);\n                    scrolled = isScrolled;\n                }\n            },\n            dynamicHeader: () => {\n                let sy,\n                    cascaded = false,\n                    sTop;\n\n                if (!ctrl.scrollInited && opts.initialScrollPosition) {\n                    sTop = opts.initialScrollPosition;\n                } else {\n                    sTop = ctrl.scrollerElem.scrollTop;\n                }\n\n                if (!ctrl.scrollInited && opts.initialPositionFixed) {\n                    prevScrollTop = sTop;\n                    y = 0;\n                    return;\n                }\n\n                if (sTop < headerMargin) {\n                    sy = sTop;\n                } else {\n                    sy = Math.min(keepCondensedHeader\n                            ? headerMargin\n                            : headerHeight,\n                        Math.max(0, ((noReveal || keepCondensedHeader)\n                            ? sTop\n                            : y + sTop - prevScrollTop))\n                    );\n                    if (condenses && prevScrollTop >= sTop && sTop > headerMargin) {\n                        sy = Math.max(sy, headerMargin);\n                    }\n                }\n                if (sTop > 0) {\n                    ctrl.transformHeader(sy);\n                } else if (p.isTouch) {\n                    ctrl.enlargeImage(sy);\n                }\n                if (!modeConfigs.noShadow[opts.mode]) {\n                    if (sTop > sy) {\n                        cascaded = true;\n                    }\n                    ctrl.showShadow(cascaded);\n                }\n                y = sy;\n                prevScrollTop = Math.max(sTop, 0);\n            }\n        };\n\n        let handleScrollFn;\n        if (animated) {\n            handleScrollFn = handleScrollFns.animated;\n        } else if (mode === 'standard') {\n            handleScrollFn = handleScrollFns.standard;\n        } else if (fixed) {\n            handleScrollFn = handleScrollFns.fixed;\n        } else {\n            handleScrollFn = handleScrollFns.dynamicHeader;\n        }\n\n        return {\n            headerPanelElem: undefined,\n            scrollerElem: undefined,\n            outerContainerElem: undefined,\n            headerContainerElem: undefined,\n            headerTopBarElem: undefined,\n            headerElem: undefined,\n            headerBg: undefined,\n            condensedHeaderBg: undefined,\n            mode: mode,\n            fixed: fixed,\n            shadow: (opts.shadow !== undefined && !opts.shadow) ? false : true,\n            scrollWatchId: 0,\n            isScrolling: false,\n            scrollInited: false,\n            headerConfig: {\n                tall: tall,\n                tallClass: tallClass,\n                animated: animated,\n                fixed: fixed\n            },\n\n            init: (controller) => {\n                ctrl = controller;\n            },\n\n            setHeight: (h) => {\n                if (opts.headerHeight === undefined) {\n                    headerHeight = h + shadowHeight;\n                    headerMargin = headerHeight - condensedHeaderHeight;\n                }\n                if (!fixed) {\n                    const mainContainer = ctrl.outerContainerElem.querySelector('.' + CSS_CLASSES.mainContainer);\n                    mainContainer.style.paddingTop = h + 'px';\n                }\n                if (noReveal) {\n                    ctrl.showShadow(false);\n                }\n            },\n\n            handleScroll: (e) => {\n                if (e) {\n                    // this is a real scroll event\n                    // instead of a programmatic call\n                    ctrl.isScrolling = true;\n                    scroller = ctrl;\n                    clearTimeout(ctrl.scrollWatchId);\n                    ctrl.scrollWatchId = setTimeout(() => {\n                        ctrl.isScrolling = false;\n                        scroller = undefined;\n                    }, SCROLL_WATCH_TIMER);\n                }\n\n                if (mode === 'scroll') {\n                    return;\n                }\n                if (modeConfigs.alwaysShadow[mode]) {\n                    ctrl.showShadow(true);\n                }\n\n                handleScrollFn();\n                ctrl.scrollInited = true;\n\n                if (e && opts.scroll) {\n                    opts.scroll(e);\n                }\n            },\n\n            condenseHeader: (hy) => {\n                const reset = (hy === null);\n\n                // adjust top bar in core-header so the top bar stays at the top\n                if (!scrollAwayTopbar) {\n                    if (ctrl.headerTopBarElem) {\n                        translateY(ctrl.headerTopBarElem.style, Math.min(hy, headerMargin));\n                    }\n                }\n\n                // transition header bg\n                const hbg = ctrl.headerBg.style;\n                if (hbg) {\n                    if (!noDissolve) {\n                        hbg.opacity = reset ? '' : (headerMargin - hy) / headerMargin;\n                    }\n\n                    // adjust header bg so it stays at the center\n                    translateY(hbg, reset ? null : hy * backgroundScrollSpeed);\n\n                    // transition condensed header bg\n                    if (!noDissolve) {\n                        const chbg = ctrl.condensedHeaderBg.style;\n                        chbg.opacity = reset ? '' : hy / headerMargin;\n                        // adjust condensed header bg so it stays at the center\n                        translateY(chbg, reset ? null : hy * backgroundScrollSpeed);\n                    }\n                }\n            },\n\n            transformHeader: (hy) => {\n                if (hy < 0) {\n                    return;\n                }\n                translateY(ctrl.headerContainerElem.style, -hy);\n                if (condenses) {\n                    ctrl.condenseHeader(hy);\n                }\n                if (opts.transform) {\n                    opts.transform({\n                        y: hy,\n                        height: headerHeight,\n                        condensedHeight: condensedHeaderHeight\n                    });\n                }\n            },\n\n            enlargeImage: (hy) => {\n                ctrl.headerBg.style.height = 100 / headerHeight * (headerHeight + Math.abs(hy / 2)) + '%';\n            },\n\n            showShadow: (cascaded) => {\n                if (modeConfigs.alwaysShadow[mode]) {\n                    cascaded = true;\n                }\n                ctrl.outerContainerElem.classList[cascaded ? 'add' : 'remove'](CSS_CLASSES.cascaded);\n            },\n\n            storeScrollPosition: (scrollTop) => {\n                if (opts.restoreScrollPositionId) {\n                    scrollPositions[opts.restoreScrollPositionId] = scrollTop;\n                }\n            },\n\n            restoreScrollPosition: () => {\n                if (opts.restoreScrollPositionId) {\n                    const scrollTop = scrollPositions[opts.restoreScrollPositionId];\n                    if (scrollTop !== undefined) {\n                        const restore = () => (ctrl.scrollerElem.scrollTop = scrollTop);\n                        restore();\n                        setTimeout(restore, 0);\n                    }\n                }\n            }\n        };\n    },\n\n    view: (ctrl, opts) => {\n        if (scroller && scroller !== ctrl) {\n            // if we are scrolling,\n            // don't render other header-panels\n            return {\n                subtree: 'retain'\n            };\n        } else {\n            return createView(ctrl, opts);\n        }\n    }\n};\n\nexport default component;\n"]}