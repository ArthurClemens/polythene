'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),require('polythene/common/object.assign');var _polythene=require('polythene/polythene/polythene'),_polythene2=_interopRequireDefault(_polythene),_events=require('polythene/common/events'),_events2=_interopRequireDefault(_events),_mithril=require('mithril'),_mithril2=_interopRequireDefault(_mithril),_button=require('polythene/button/button'),_button2=_interopRequireDefault(_button),_icon=require('polythene/icon/icon'),_icon2=_interopRequireDefault(_icon),_iconButton=require('polythene/icon-button/icon-button'),_iconButton2=_interopRequireDefault(_iconButton),_scrollTo=require('polythene/common/scroll-to'),_scrollTo2=_interopRequireDefault(_scrollTo),_theme=require('polythene/tabs/theme/theme'),_theme2=_interopRequireDefault(_theme),_config=require('polythene/tabs/theme/config'),_config2=_interopRequireDefault(_config);function _interopRequireDefault(c){return c&&c.__esModule?c:{default:c}}var CSS_CLASSES={block:'pe-tabs',scrollButton:'pe-tabs__scroll-button',scrollButtonLeft:'pe-tabs__scroll-button--start',scrollButtonRight:'pe-tabs__scroll-button--end',scrollButtonOffset:'pe-tabs__scroll-button--offset',tabRow:'pe-tabs__row',tabRowCentered:'pe-tabs__row--centered',tabRowIndent:'pe-tabs__row--indent',tab:'pe-tabs__tab',tabContent:'pe-tabs__tab-content',tabHasIcon:'pe-tabs__tab---icon',indicator:'pe-tabs__indicator',scrollable:'pe-tabs--scrollable',isAutofit:'pe-tabs--autofit',isAtStart:'pe-tabs--start',isAtEnd:'pe-tabs--end',isMenu:'pe-tabs--menu',isSmall:'pe-tabs--small',activeSelected:'pe-tabs__active-selected',label:'pe-button__label'},POSITION_LEFT=2,POSITION_RIGHT=4,getNewIndex=function(c,d){var g=d.length-1;return{left:Math.max(c-1,0),right:Math.min(c+1,g)}},handleScrollButtonClick=function(c,d,f,g){f.stopPropagation(),f.preventDefault();var h=c.tabs,i=c.selectedTabIndex,j=getNewIndex(i,h)[g];scrollToTab(c,j),j!==i&&(setSelectedTab(c,d,j,!0),_mithril2.default.redraw())},createScrollButton=function(c,d,f){var g=f.scrollIconForward||_theme2.default.arrowForward,h=f.scrollIconBackward||_theme2.default.arrowBackward;return _mithril2.default.component(_iconButton2.default,{class:[CSS_CLASSES.scrollButton,d===POSITION_LEFT?CSS_CLASSES.scrollButtonLeft:CSS_CLASSES.scrollButtonRight].join(' '),icon:d===POSITION_LEFT?h:g,ripple:{center:!0},config:function config(i){c.scrollButtonLeftEl&&c.scrollButtonRightEl||(d===POSITION_LEFT?c.scrollButtonLeftEl=i:c.scrollButtonRightEl=i)},events:{onclick:d===POSITION_LEFT?function(i){handleScrollButtonClick(c,f,i,'left')}:function(i){handleScrollButtonClick(c,f,i,'right')}}})},alignToTitle=function(c){var d=c.tabs[0].el,f=d.querySelector('.'+CSS_CLASSES.label+' span'),g=d.getBoundingClientRect().width,h=f.getBoundingClientRect().width;d.style.marginLeft=-((g-h)/2)+'px'},createRightButtonOffset=function(c){var d=c.scrollButtonRightEl.getBoundingClientRect().width,f=c.tabsEl.querySelector('.'+CSS_CLASSES.scrollButtonOffset);f.style.width=d+'px'},scrollToTab=function(c,d){var f=c.tabs,g=c.scrollerEl,h=f.slice(0,d).reduce(function(n,o){return n+o.el.getBoundingClientRect().width},0),i=g.getBoundingClientRect().width,j=g.scrollWidth,l=Math.min(h,j-i),m=g.scrollLeft;m!==l&&function(){var n=Math.abs(m-l)/_config2.default.tabs_scroll_speed,o=_config2.default.tabs_scroll_delay||0;setTimeout(function(){(0,_scrollTo2.default)({element:g,to:l,duration:Math.max(_config2.default.tabs_scroll_min_duration,n),direction:'horizontal'})},1e3*o)}()},updateScrollButtons=function(c){var d=c.scrollerEl,f=d.scrollLeft,g=c.selectedTabIndex,h=c.tabs,i=c.tabsEl,k=h.length-1,l=0===d.scrollLeft&&g===0,m=f>=d.scrollWidth-i.getBoundingClientRect().width-1&&g===k;c.scrollButtonStates.left=!l,c.scrollButtonStates.right=!m},animateIndicator=function(c,d,f){var g=f.tabsEl.getBoundingClientRect(),h=c.getBoundingClientRect(),i=f.tabIndicatorEl.style,j=h.left-g.left+f.scrollerEl.scrollLeft,l=d?_config2.default.indicator_slide_min_duration:0;i.width=h.width+'px',i['transition-duration']=i['-webkit-transition-duration']=i['-moz-transition-duration']=i['-o-transition-duration']=l+'s',i.transform=i['-webkit-transform']=i['-moz-transform']=i['-ms-transform']=i['-o-transform']='translate('+j+'px, 0)'},setSelectedTab=function(c,d,f,g){if(c.selectedTabIndex=f,!!c.tabs.length){var h=c.tabs[f].el;h&&c.tabIndicatorEl&&c.tabsEl&&animateIndicator(h,g,c),c.managesScroll&&(updateScrollButtons(c),scrollToTab(c,f)),d.getState&&d.getState({index:f,data:c.tabs[f].data,el:h})}},createTab=function(c,d,f,g){g.events=g.events||{},g.events.onclick=g.events.onclick||function(){};var h=Object.assign({},g,{content:{tag:'div',attrs:{'class':CSS_CLASSES.tabContent},children:[g.icon?_mithril2.default.component(_icon2.default,g.icon):null,g.label?{tag:'div',attrs:{'class':CSS_CLASSES.label},children:[(0,_mithril2.default)('span',g.label)]}:null]},class:[CSS_CLASSES.tab,g.icon&&g.label?CSS_CLASSES.tabHasIcon:null,g.class].join(' '),wash:!1,ripple:!0,events:Object.assign({},g.events,{onclick:function onclick(i){setSelectedTab(c,d,f,!d.noIndicatorSlide),g.events.onclick(i)}}),config:function config(i,j){j||c.tabs.push({data:g,el:i})}});return _mithril2.default.component(_button2.default,h)},sortNumbers=function(c,d){return c<d?-1:c>d?1:0},createView=function(c){var d=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},f=d.tag||'div',g=d.scrollable||d.centered?!1:!!d.autofit;d.selectedTab!==void 0&&c.previousOptsSelectedTab!==d.selectedTab&&setSelectedTab(c,d,d.selectedTab,!0),c.previousOptsSelectedTab=d.selectedTab;var h={class:[CSS_CLASSES.block,d.scrollable?CSS_CLASSES.scrollable:null,0===c.selectedTabIndex?CSS_CLASSES.isAtStart:null,c.selectedTabIndex===c.tabs.length-1?CSS_CLASSES.isAtEnd:null,d.activeSelected?CSS_CLASSES.activeSelected:null,g?CSS_CLASSES.isAutofit:null,d.menu?CSS_CLASSES.isMenu:null,d.small?CSS_CLASSES.isSmall:null,d.class].join(' '),id:d.id||'',config:function config(n,o,p){if(!o){c.tabsEl=n,d.largestWidth&&function(){var r=c.tabs.map(function(t){return t.el.getBoundingClientRect().width}),s=r.sort(sortNumbers).reverse()[0];c.tabs.forEach(function(t){return t.el.style.width=s+'px'})}(),d.scrollable&&alignToTitle(c),d.scrollable&&!_polythene2.default.isTouch&&(c.managesScroll=!0,createRightButtonOffset(c));var q=function onResize(){setSelectedTab(c,d,c.selectedTabIndex,!1),_mithril2.default.redraw()};_events2.default.subscribe('resize',q),p.onunload=function(){_events2.default.unsubscribe('resize',q)},setSelectedTab(c,d,c.selectedTabIndex,!1)}}},i=d.buttons.map(function(n,o){var p=Object.assign({},n,{selected:o===c.selectedTabIndex,animateOnTap:!1!==d.animateOnTap},d.tabsOpts||{});return createTab(c,d,o,p)}).concat([d.scrollable?{tag:'div',attrs:{'class':CSS_CLASSES.scrollButtonOffset},children:[]}:null]),j,k;d.scrollable&&(j=createScrollButton(c,POSITION_LEFT,d),k=createScrollButton(c,POSITION_RIGHT,d));var l=d.hideIndicator?null:{tag:'div',attrs:{'class':CSS_CLASSES.indicator,config:function config(n,o){o||(c.tabIndicatorEl=n)}},children:[]},m=[d.scrollable?j:null,{tag:'div',attrs:{'class':[CSS_CLASSES.tabRow,d.centered?CSS_CLASSES.tabRowCentered:null,d.scrollable?CSS_CLASSES.tabRowIndent:null].join(' '),config:function config(n,o){o||(c.scrollerEl=n)},onscroll:function onscroll(){updateScrollButtons(c)}},children:[i,l]},d.scrollable?k:null];return(0,_mithril2.default)(f,h,[d.before,m,d.after])},component={controller:function controller(){return{tabsEl:null,scrollerEl:null,tabs:[],tabIndicatorEl:null,selectedTabIndex:0,previousOptsSelectedTab:void 0,managesScroll:!1,scrollButtonStates:{left:!1,right:!1}}},view:function view(c){var d=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};return createView(c,d)}};exports.default=component,module.exports=exports['default'];
//# sourceMappingURL=tabs.js.map