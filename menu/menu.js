'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _events=require('polythene/common/events'),_events2=_interopRequireDefault(_events),_mithril=require('mithril'),_mithril2=_interopRequireDefault(_mithril),_shadow=require('polythene/shadow/shadow'),_shadow2=_interopRequireDefault(_shadow),_transition=require('polythene/common/transition'),_transition2=_interopRequireDefault(_transition);require('polythene/menu/theme/theme');function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var CSS_CLASSES={block:'pe-menu',content:'pe-menu__content',placeholder:'pe-menu--placeholder',visible:'pe-menu--visible',permanent:'pe-menu--permanent',target:'pe-menu--target',width_n:'pe-menu--width-',width_auto:'pe-menu--width-auto',listTile:'pe-list-tile',selectedListTile:'pe-list-tile--selected'},OFFSET_V=-8,DEFAULT_OFFSET_H=16,MIN_SIZE=1.5,positionMenu=function(a,b){if(b.target){var c=document.querySelector('#'+b.target);if(c){var d=void 0===b.offset?DEFAULT_OFFSET_H:b.offset,f=a.el;if(f){var g=a.contentEl,h=b.origin||'top-left',i=!1!==b.reposition,j=0;if(i){var r=g.querySelectorAll('.'+CSS_CLASSES.listTile)[0],s=g.querySelector('.'+CSS_CLASSES.selectedListTile);if(r&&s){var x=r.getBoundingClientRect(),y=s.getBoundingClientRect();j=y.top-x.top}var u=(s||r).getBoundingClientRect(),v=c.getBoundingClientRect(),w=u.height-v.height;j+=w/2}var k=c.getBoundingClientRect(),l=f.parentNode.getBoundingClientRect(),m=function alignLeft(){return f.style.left=k.left-l.left+d+'px'},n=function alignRight(){return f.style.right=k.right-l.right+d+'px'},o=function alignTop(){return f.style.top=k.top-l.top-j+OFFSET_V+'px'},p=function alignBottom(){return f.style.bottom=k.bottom-l.bottom-j+'px'};({'top-left':function topLeft(){return o()&&m()},'top-right':function topRight(){return o()&&n()},'bottom-left':function bottomLeft(){return p()&&m()},'bottom-right':function bottomRight(){return p()&&n()}})[h].call()}}}},show=function(a,b){return a.isTransitioning=!0,_transition2.default.show(Object.assign({},b,{el:a.el,showClass:CSS_CLASSES.visible})).then(function(){a.isTransitioning=!1,a.visible=!0,b.didShow&&b.didShow(b.id)})},hide=function(a,b){return a.isTransitioning=!0,_transition2.default.hide(Object.assign({},b,{el:a.el,showClass:CSS_CLASSES.visible})).then(function(){a.isTransitioning=!1,a.visible=!1,b.didHide&&b.didHide(b.id),_mithril2.default.redraw()})},unifySize=function(a){return a<MIN_SIZE?MIN_SIZE:a},widthClass=function(a){var b=a.toString().replace('.','-');return CSS_CLASSES.width_n+b},createView=function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},c=document.body,d=function activateDismissTap(){c.addEventListener('click',g)},f=function deActivateDismissTap(){c.removeEventListener('click',g)},g=function handleDismissTap(k){k.target===a.el||(f(),k.defaultPrevented?hide(a,b):hide(a,Object.assign({},b,{hideDelay:0})))},h=b.tag||'div',i={class:[CSS_CLASSES.block,b.permanent?CSS_CLASSES.permanent:null,b.target?CSS_CLASSES.target:'layout center-center',b.size?widthClass(unifySize(b.size)):null,b.class].join(' '),id:b.id||'',config:function config(k,l,m,n){if(!l){b.config&&b.config(k,l,m,n),a.el=k;var o=function update(){positionMenu(a,b),_mithril2.default.redraw()},p=function handleEscape(q){27===q.which&&hide(a,Object.assign({},b,{hideDelay:0}))};b.permanent||(_events2.default.subscribe('resize',o),_events2.default.subscribe('keydown',p),setTimeout(function(){d(),show(a,b)},0)),m.onunload=function(){_events2.default.unsubscribe('resize',o),_events2.default.unsubscribe('keydown',p),b.permanent||f()},positionMenu(a,b)}}},j={tag:'div',attrs:{'class':CSS_CLASSES.content,config:function config(k,l){l||(a.contentEl=k)},onclick:function onclick(k){k.preventDefault()}},children:[_mithril2.default.component(_shadow2.default,{z:a.z,animated:!0}),b.content?b.content:null]};return(0,_mithril2.default)(h,i,[b.before,j,b.after])},component={controller:function controller(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},b=a.z===void 0?1:a.z;return{z:b,el:null,contentEl:null,isTransitioning:!1,visible:a.permanent||!1}},view:function view(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return b.show&&!a.visible&&(a.visible=!0),a.visible?createView(a,b):{tag:'span',attrs:{'class':CSS_CLASSES.placeholder},children:[]}}};exports.default=component,module.exports=exports['default'];
//# sourceMappingURL=menu.js.map