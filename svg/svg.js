"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0}),require("polythene/common/object.assign");var _mithril=require("mithril"),_mithril2=_interopRequireDefault(_mithril);require("polythene/svg/theme/theme");var CSS_CLASSES={block:"pe-svg"},globalCache={},createView=function(ctrl){var opts=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],content=void 0,svg=void 0,tag=opts.tag||"div",props=Object.assign({},{"class":[CSS_CLASSES.block,opts["class"]].join(" "),id:opts.id||"",config:opts.config},opts.events?opts.events:null);if(opts.content)content=opts.content;else{var path=opts.src;ctrl.path()!==path?(svg=globalCache[path],svg?(content=_mithril2["default"].trust(svg),preloadNext(ctrl,opts)):(ctrl.path(path),loadSvg(path,ctrl,opts).then(_mithril2["default"].redraw))):(svg=ctrl.svg(),svg=svg||"",content=_mithril2["default"].trust(svg),preloadNext(ctrl,opts))}return(0,_mithril2["default"])(tag,props,[opts.before,content,opts.after])},loadSvg=function(path,ctrl,opts){var preloading=arguments.length<=3||void 0===arguments[3]?!1:arguments[3];if(System&&System["import"]){var normalizedName=System.normalizeSync(path);return System["import"](normalizedName).then(function(data){preloading?(globalCache[path]=data,ctrl.preloadingIndex++,preloadNext(ctrl,opts)):ctrl.svg(data)})}console&&console.log("polythene/svg: System not found.")},preloadNext=function preloadNext(ctrl,opts){if(ctrl.preloadingItems&&!(ctrl.preloadingIndex>=ctrl.preloadingItems.length)){var next=ctrl.preloadingItems[ctrl.preloadingIndex];globalCache[next]?(ctrl.preloadingIndex++,preloadNext(ctrl,opts)):loadSvg(next,ctrl,opts,!0)}},component={controller:function(){var opts=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return{path:_mithril2["default"].prop(""),svg:_mithril2["default"].prop(""),preloadingItems:opts.preload,preloadingIndex:0}},view:function(ctrl){var opts=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return createView(ctrl,opts)}};exports["default"]=component,module.exports=exports["default"];
//# sourceMappingURL=svg.js.map