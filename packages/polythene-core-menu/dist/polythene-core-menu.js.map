{"version":3,"file":"polythene-core-menu.js","sources":["../../polythene-css-classes/menu.js","../../polythene-css-classes/list-tile.js","../src/index.js"],"sourcesContent":["import listTileClasses from \"./list-tile\";\n\nexport default {\n  component:   \"pe-menu\",\n\n  // elements\n  panel:       \"pe-menu__panel\",\n  content:     \"pe-menu__content\",\n  placeholder: \"pe-menu__placeholder\",\n  backdrop:    \"pe-menu__backdrop\",\n\n  // states\n  floating:     \"pe-menu--floating\",\n  origin:       \"pe-menu--origin\",\n  permanent:    \"pe-menu--permanent\",\n  showBackdrop: \"pe-menu--backdrop\",\n  visible:      \"pe-menu--visible\",\n  width_auto:   \"pe-menu--width-auto\",\n  width_n:      \"pe-menu--width-\",\n  isTopMenu:    \"pe-menu--top-menu\",\n\n  // lookup\n  listTile:         listTileClasses.component,\n  selectedListTile: listTileClasses.selected,\n};","\nexport default {\n  component:       \"pe-list-tile\",\n\n  // elements\n  content:           \"pe-list-tile__content\",\n  highSubtitle:      \"pe-list-tile__high-subtitle\",\n  primary:           \"pe-list-tile__primary\",\n  secondary:         \"pe-list-tile__secondary\",\n  subtitle:          \"pe-list-tile__subtitle\",\n  title:             \"pe-list-tile__title\",\n  contentFront:      \"pe-list-tile__content-front\",\n  \n  // states  \n  compact:           \"pe-list-tile--compact\",\n  compactFront:      \"pe-list-tile--compact-front\",\n  disabled:          \"pe-list-tile--disabled\",\n  hasFront:          \"pe-list-tile--front\",\n  hasHighSubtitle:   \"pe-list-tile--high-subtitle\",\n  hasSubtitle:       \"pe-list-tile--subtitle\",\n  header:            \"pe-list-tile--header\",\n  hoverable:         \"pe-list-tile--hoverable\",\n  insetH:            \"pe-list-tile--inset-h\",\n  insetV:            \"pe-list-tile--inset-v\",\n  selectable:        \"pe-list-tile--selectable\",\n  selected:          \"pe-list-tile--selected\",\n  rounded:           \"pe-list-tile--rounded\",\n  highlight:         \"pe-list-tile--highlight\",\n  sticky:            \"pe-list-tile--sticky\",\n  navigation:        \"pe-list-tile--navigation\",\n};\n","import { filterSupportedAttributes, subscribe, unsubscribe, transitionComponent, isServer, pointerEndDownEvent, stylePropCompare, transitionStateReducer, initialTransitionState } from \"polythene-core\";\nimport classes from \"polythene-css-classes/menu\";\n\nconst DEFAULT_OFFSET_H           = 0;\nconst DEFAULT_OFFSET_V           = \"79%\";\nconst DEFAULT_TYPE               = \"floating\";\nconst MIN_WIDTH                  = 1.5;\nconst DEFAULT_SHADOW_DEPTH       = 1;\n\nconst unifyWidth = width =>\n  width < MIN_WIDTH ? MIN_WIDTH : width;\n\nconst widthClass = size =>\n  classes.width_n + size.toString().replace(\".\", \"-\");\n\nexport const _Menu = ({ h, a, useReducer, useState, useEffect, useRef, getRef, Shadow, ...props }) => {\n  const [, dispatchTransitionState] = useReducer(transitionStateReducer, initialTransitionState);\n  const [domElement, setDomElement] = useState();\n  const [, setIsVisible] = useState(!!props.permanent);\n\n  const panelElRef = useRef();\n  const contentElRef = useRef();\n\n  const update = () => {\n    positionMenu();\n    scrollContent();\n  };\n\n  const transitionOptions = ({ isShow, hideDelay = props.hideDelay }) => ({\n    dispatchTransitionState,\n    setIsVisible,\n    props: Object.assign({}, props, {\n      hideDelay\n    }),\n    isShow,\n    beforeTransition: isShow\n      ? () => update()\n      : null,\n    domElements: {\n      el: panelElRef.current,\n      showClassElement: domElement,\n    },\n    showClass: classes.visible\n  });\n\n  const isTopMenu = () => \n    props.topMenu || stylePropCompare({\n      element: domElement,\n      pseudoSelector: \":before\",\n      prop: \"content\",\n      contains: `\"${\"top_menu\"}\"`\n    });\n    \n  const positionMenu = () => {\n    if (isServer) {\n      return;\n    }\n    if (!props.target) {\n      return;\n    }\n    const panelEl = panelElRef.current;\n    const contentEl = contentElRef.current;\n    const targetEl = document.querySelector(props.target);\n    if (!targetEl) {\n      return;\n    }\n    if (!panelEl) {\n      return;\n    }\n  \n    // Don't set the position or top offset if the menu position is fixed\n    const hasStylePositionFixed = stylePropCompare({\n      element: panelEl,\n      prop: \"position\",\n      equals: \"fixed\"\n    });\n  \n    if (hasStylePositionFixed && !isTopMenu()) {\n      Object.assign(panelEl.style, {});\n      panelEl.offsetHeight; // force reflow\n      return;\n    }\n  \n    const parentRect = panelEl.parentNode.getBoundingClientRect();\n    const targetRect = targetEl.getBoundingClientRect();\n    const attrsOffsetH = props.offsetH !== undefined\n      ? props.offsetH\n      : props.offset !== undefined\n        ? props.offset // deprecated\n        : DEFAULT_OFFSET_H;\n    const attrsOffsetV = props.offsetV !== undefined\n      ? props.offsetV\n      : DEFAULT_OFFSET_V;\n    const offsetH = attrsOffsetH.toString().indexOf(\"%\") !== -1\n      ? Math.round(parseFloat(attrsOffsetH) * 0.01 * targetRect.width)\n      : Math.round(parseFloat(attrsOffsetH));\n    const offsetV = attrsOffsetV.toString().indexOf(\"%\") !== -1\n      ? Math.round(parseFloat(attrsOffsetV) * 0.01 * targetRect.height)\n      : Math.round(parseFloat(attrsOffsetV));\n    let positionOffsetV = offsetV;\n  \n    const attrsOrigin = props.origin || \"top\";\n    const origin = attrsOrigin.split(/\\W+/).reduce((acc, curr) => (\n      acc[curr] = true,\n      acc\n    ), {});\n  \n    const firstItem = contentEl.querySelectorAll(\".\" + classes.listTile)[0];\n  \n    if (props.reposition) {\n      // get the first List Tile to calculate the top position  \n      const selectedItem = contentEl.querySelector(\".\" + classes.selectedListTile);\n      if (firstItem && selectedItem) {\n        // calculate v position: menu should shift upward relative to the first item\n        const firstItemRect = firstItem.getBoundingClientRect();\n        const selectedItemRect = selectedItem.getBoundingClientRect();\n        positionOffsetV = firstItemRect.top - selectedItemRect.top;\n      }\n      // align to middle of target\n      const alignEl = selectedItem || firstItem;\n      const alignRect = alignEl.getBoundingClientRect();\n      const targetRect = targetEl.getBoundingClientRect();\n      const heightDiff = targetRect.height - alignRect.height;\n      positionOffsetV += Math.abs(heightDiff) / 2;\n    } else if (props.origin && !hasStylePositionFixed) {\n      if (origin.top) {\n        positionOffsetV += targetRect.top - parentRect.top;\n      } else if (origin.bottom) {\n        positionOffsetV += targetRect.top - parentRect.bottom;\n      }\n    }\n  \n    if (props.height) {\n      const firstItemHeight = firstItem\n        ? firstItem.clientHeight\n        : 48; // default List Tile height\n      if (props.height === \"max\") {\n        const topMargin = positionOffsetV;\n        const bottomMargin = firstItemHeight;\n        panelEl.style.height = `calc(100% - ${topMargin + bottomMargin}px)`;\n      } else {\n        const height = /^\\d+$/.test(props.height.toString())\n          ? `${props.height}px`\n          : props.height;\n        panelEl.style.height = height;\n      }\n    }\n  \n    // prevent animated changes\n    const transitionDuration = panelEl.style.transitionDuration;\n    panelEl.style.transitionDuration = \"0ms\";\n  \n    if (panelEl.parentNode && !hasStylePositionFixed) {\n      if (origin.right) {\n        panelEl.style.right = targetRect.right - parentRect.right + offsetH + \"px\";\n      } else {\n        panelEl.style.left = targetRect.left - parentRect.left + offsetH + \"px\";\n      }\n      if (origin.bottom) {\n        panelEl.style.bottom = positionOffsetV + \"px\";\n      } else {\n        panelEl.style.top = positionOffsetV + \"px\";\n      }\n      panelEl.style.transformOrigin = attrsOrigin.split(/\\W+/).join(\" \");\n    }\n  \n    panelEl.offsetHeight; // force reflow\n    panelEl.style.transitionDuration = transitionDuration;\n  };\n\n  const scrollContent = () => {\n    if (isServer) {\n      return;\n    }\n    if (!props.scrollTarget) {\n      return;\n    }\n    const scrollTargetEl = document.querySelector(props.scrollTarget);\n    if (!scrollTargetEl) {\n      return;\n    }\n    contentElRef.current.scrollTop = scrollTargetEl.offsetTop;\n  };\n  \n  const showMenu = () =>\n    transitionComponent(transitionOptions({ isShow: true }));\n  \n  const hideMenu = ({ hideDelay } = {}) =>\n    transitionComponent(transitionOptions({ isShow: false, hideDelay }));\n  \n  useEffect(\n    () => {\n      if (!domElement) {\n        return;\n      }\n\n      panelElRef.current = domElement.querySelector(`.${classes.panel}`);\n      Object.assign(panelElRef.current.style, props.style);\n      \n      contentElRef.current = domElement.querySelector(`.${classes.content}`);\n    \n      const handleEscape = e => {\n        if (e.key === \"Escape\" || e.key === \"Esc\") {\n          hideMenu({ hideDelay: 0 });\n        }\n      };\n\n      const handleDismissTap = e => {\n        if (e.target === panelElRef.current) {\n          return;\n        }\n        hideMenu();\n      };\n\n      const activateDismissTap = () => {\n        pointerEndDownEvent.forEach(evt =>\n          document.addEventListener(evt, handleDismissTap));\n      };\n  \n      const deActivateDismissTap = () => {\n        pointerEndDownEvent.forEach(evt =>\n          document.removeEventListener(evt, handleDismissTap));\n      };\n\n      if (!props.permanent) {\n        subscribe(\"resize\", update);\n        subscribe(\"keydown\", handleEscape);\n\n        setTimeout(() => {\n          activateDismissTap();\n          showMenu();\n        }, 0);\n      }\n\n      return () => {\n        if (!props.permanent) {\n          unsubscribe(\"resize\", update);\n          unsubscribe(\"keydown\", handleEscape);\n          deActivateDismissTap();\n        }\n      }\n    },\n    [domElement]\n  );\n  \n  const type = props.type || DEFAULT_TYPE;\n  const componentProps = Object.assign({},\n    filterSupportedAttributes(props, { remove: [\"style\"] }),\n    props.testId && { \"data-test-id\": props.testId },\n    getRef(dom => dom && !domElement && (\n      setDomElement(dom),\n      props.getRef && props.getRef(dom)\n    )),\n    {\n      className: [\n        classes.component,\n        props.permanent ? classes.permanent : null,\n        props.origin ? classes.origin : null,\n        props.backdrop ? classes.showBackdrop : null,\n        props.topMenu ? classes.isTopMenu : null,\n        type === \"floating\" && !props.permanent ? classes.floating : null,\n        props.width || props.size ? widthClass(unifyWidth(props.width || props.size)) : null,\n        props.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        props.tone === \"light\" ? \"pe-light-tone\" : null,\n        props.className || props[a.class],\n      ].join(\" \")\n    }\n  );\n\n  const shadowDepth = props.shadowDepth !== undefined\n    ? props.shadowDepth\n    : DEFAULT_SHADOW_DEPTH; \n\n  const componentContent = [\n    h(\"div\",\n      {\n        className: classes.backdrop,\n      }\n    ),\n    h(\"div\",\n      {\n        className: classes.panel,\n      },\n      [\n        h(Shadow, {\n          shadowDepth,\n          animated: true,\n        }),\n        h(\"div\", \n          {\n            className: classes.content,\n          },\n          props.content || props.children\n        )\n      ]\n    )\n  ];\n\n  const content = [\n    props.before,\n    ...componentContent,\n    props.after\n  ];\n\n  return h(props.element || \"div\", componentProps, content);\n};\n"],"names":["component","panel","content","placeholder","backdrop","floating","origin","permanent","showBackdrop","visible","width_auto","width_n","isTopMenu","listTile","selectedListTile","h","a","useReducer","useState","useEffect","useRef","getRef","Shadow","props","dispatchTransitionState","transitionStateReducer","initialTransitionState","domElement","setDomElement","setIsVisible","panelElRef","contentElRef","update","positionMenu","scrollContent","transitionOptions","isShow","hideDelay","_extends","beforeTransition","domElements","el","current","showClassElement","showClass","classes","isServer","target","panelEl","contentEl","targetEl","document","querySelector","hasStylePositionFixed","stylePropCompare","element","prop","equals","topMenu","pseudoSelector","contains","style","offsetHeight","parentRect","parentNode","getBoundingClientRect","targetRect","attrsOffsetH","undefined","offsetH","offset","attrsOffsetV","offsetV","toString","indexOf","Math","round","parseFloat","width","positionOffsetV","height","attrsOrigin","split","reduce","acc","curr","firstItem","querySelectorAll","reposition","selectedItem","firstItemRect","selectedItemRect","top","alignRect","heightDiff","abs","bottom","firstItemHeight","clientHeight","topMargin","bottomMargin","test","transitionDuration","right","left","transformOrigin","join","scrollTarget","scrollTargetEl","scrollTop","offsetTop","hideMenu","transitionComponent","handleEscape","e","key","handleDismissTap","subscribe","setTimeout","pointerEndDownEvent","forEach","evt","addEventListener","unsubscribe","removeEventListener","size","type","componentProps","filterSupportedAttributes","remove","testId","dom","className","replace","tone","shadowDepth","componentContent","animated","children","before","after"],"mappings":"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"}