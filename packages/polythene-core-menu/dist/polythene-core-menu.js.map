{"version":3,"file":"polythene-core-menu.js","sources":["../../polythene-css-classes/list-tile.js","../../polythene-css-classes/menu.js","../src/menu.js","../src/vars.js"],"sourcesContent":["\nexport default {\n  component:       \"pe-list-tile\",\n\n  // elements\n  content:         \"pe-list-tile__content\",\n  highSubtitle:    \"pe-list-tile__high-subtitle\",\n  primary:         \"pe-list-tile__primary\",\n  secondary:       \"pe-list-tile__secondary\",\n  subtitle:        \"pe-list-tile__subtitle\",\n  title:           \"pe-list-tile__title\",\n  contentFront:    \"pe-list-tile__content-front\",\n\n  // states\n  compact:         \"pe-list-tile--compact\",\n  compactFront:    \"pe-list-tile--compact-front\",\n  disabled:        \"pe-list-tile--disabled\",\n  hasFront:        \"pe-list-tile--front\",\n  hasHighSubtitle: \"pe-list-tile--high-subtitle\",\n  hasSubtitle:     \"pe-list-tile--subtitle\",\n  header:          \"pe-list-tile--header\",\n  hoverable:       \"pe-list-tile--hoverable\",\n  selectable:      \"pe-list-tile--selectable\",\n  selected:        \"pe-list-tile--selected\",\n  highlight:       \"pe-list-tile--highlight\",\n  sticky:          \"pe-list-tile--sticky\",\n  navigation:      \"pe-list-tile--navigation\",\n};\n","import listTileClasses from \"./list-tile\";\n\nexport default {\n  component:   \"pe-menu\",\n\n  // elements\n  content:     \"pe-menu__content\",\n  placeholder: \"pe-menu__placeholder\",\n  target:      \"pe-menu__target\",\n\n  // states\n  permanent:   \"pe-menu--permanent\",\n  fullHeight:  \"pe-menu--full-height\",\n  floating:    \"pe-menu--floating\",\n  visible:     \"pe-menu--visible\",\n  width_auto:  \"pe-menu--width-auto\",\n  width_n:     \"pe-menu--width-\",\n\n  // lookup\n  listTile:         listTileClasses.component,\n  selectedListTile: listTileClasses.selected,\n};","import { filterSupportedAttributes, subscribe, unsubscribe, transitionComponent, isServer, isTouch } from \"polythene-core\";\nimport classes from \"polythene-css-classes/menu\";\n\nexport const getElement = vnode =>\n  vnode.attrs.element || \"div\";\n\nconst DEFAULT_OFFSET_H           = 0;\nconst DEFAULT_TYPE               = \"floating\";\nconst MIN_SIZE                   = 1.5;\nconst OFFSET_V                   = -8;\nconst SHADOW_Z                   = 1;\n\nconst positionMenu = (state, attrs) => {\n  if (isServer) {\n    return;\n  }\n  const targetEl = document.querySelector(attrs.target);\n  if (!targetEl) {\n    return;\n  }\n  const offsetH = (attrs.offset !== undefined) ? attrs.offset : DEFAULT_OFFSET_H;\n  const menuEl = state.dom();\n  if (!menuEl) {\n    return;\n  }\n  const contentEl = state.dom().querySelector(\".\" + classes.content);\n  const origin = attrs.origin || \"top-left\";\n  let positionOffset = 0;\n  if (attrs.reposition) {\n    const firstItem = contentEl.querySelectorAll(\".\" + classes.listTile)[0];\n    const selectedItem = contentEl.querySelector(\".\" + classes.selectedListTile);\n    if (firstItem && selectedItem) {\n      // calculate v position: menu should shift upward relative to the first item\n      const firstItemRect = firstItem.getBoundingClientRect();\n      const selectedItemRect = selectedItem.getBoundingClientRect();\n      positionOffset = selectedItemRect.top - firstItemRect.top;\n    }\n    // align to middle of target\n    const alignEl = selectedItem || firstItem;\n    const alignRect = alignEl.getBoundingClientRect();\n    const targetRect = targetEl.getBoundingClientRect();\n    const heightDiff = alignRect.height - targetRect.height;\n    positionOffset += heightDiff / 2;\n  }\n  const targetRect = targetEl.getBoundingClientRect();\n  if (menuEl.parentNode) {\n    const parentRect = menuEl.parentNode.getBoundingClientRect();\n    const alignLeft =   () => menuEl.style.left = targetRect.left - parentRect.left + offsetH + \"px\";\n    const alignRight =  () => menuEl.style.right = targetRect.right - parentRect.right + offsetH + \"px\";\n    const alignTop =    () => menuEl.style.top = targetRect.top - parentRect.top - positionOffset + OFFSET_V + \"px\";\n    const alignBottom = () => menuEl.style.bottom = targetRect.bottom - parentRect.bottom - positionOffset + \"px\";\n    const alignFn = {\n      \"top-left\":       () => alignTop() && alignLeft(),\n      \"top-right\":      () => alignTop() && alignRight(),\n      \"bottom-left\":    () => alignBottom() && alignLeft(),\n      \"bottom-right\":   () => alignBottom() && alignRight()\n    };\n    alignFn[origin].call();\n  }\n};\n\nconst transitionOptions = (state, attrs, isShow) => ({\n  state,\n  attrs,\n  isShow,\n  beforeTransition: isShow\n    ? () => positionMenu(state, attrs)\n    : null,\n  domElements: {\n    el: state.dom()\n  },\n  showClass: classes.visible,\n});\n\nconst showMenu = (state, attrs) =>\n  transitionComponent(transitionOptions(state, attrs, true));\n\nconst hideMenu = (state, attrs) =>\n  transitionComponent(transitionOptions(state, attrs, false));\n\nconst unifySize = size =>\n  size < MIN_SIZE ? MIN_SIZE : size;\n\nconst widthClass = size =>\n  classes.width_n + size.toString().replace(\".\", \"-\");\n\nconst handleSubscriptions = (vnode, which) => {\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n\n  if (which === \"mount\") {\n    subscribe(\"resize\", state.update);\n    subscribe(\"keydown\", state.handleEscape);\n    setTimeout(() => {\n      state.activateDismissTap();\n      showMenu(state, attrs);\n    }, 0);\n  } else {\n    unsubscribe(\"resize\", state.update);\n    unsubscribe(\"keydown\", state.handleEscape);\n    state.deActivateDismissTap();\n  }\n};\n\nexport const getInitialState = (vnode, createStream) => {\n  const dom = createStream(null);\n  const visible = createStream(false);\n  const transitioning = createStream(false);\n  return {\n    dom,\n    visible,\n    transitioning,\n    activateDismissTap: undefined, // set in onMount\n    deActivateDismissTap: undefined, // set in onMount\n    handleDismissTap: undefined, // set in onMount\n    handleEscape: undefined, // set in onMount\n    update: undefined, // set in onMount\n    redrawOnUpdate: createStream.merge([transitioning])\n  };\n};\n\nexport const onMount = vnode => {\n  if (!vnode.dom) {\n    return;\n  }\n  const state = vnode.state;\n  const attrs = vnode.attrs;\n  state.dom(vnode.dom);\n\n  if (!attrs.permanent) {\n    state.handleDismissTap = e => {\n      if (e.target === state.dom()) {\n        return;\n      }\n      if (e.defaultPrevented) {\n        // clicked on .pe-menu__content\n        hideMenu(state, attrs);\n      } else {\n        hideMenu(state, Object.assign({}, attrs, {\n          hideDelay: 0\n        }));\n      }\n    };\n\n    state.update = () => {\n      positionMenu(state, attrs);\n    };\n\n    state.activateDismissTap = () => {\n      if (isTouch) {\n        document.addEventListener(\"touchstart\", state.handleDismissTap);\n      } else {\n        document.addEventListener(\"click\", state.handleDismissTap);\n      }\n    };\n\n    state.deActivateDismissTap = () => {\n      if (isTouch) {\n        document.removeEventListener(\"touchstart\", state.handleDismissTap);\n      } else {\n        document.removeEventListener(\"click\", state.handleDismissTap);\n      }\n    };\n\n    state.handleEscape = e => {\n      if (e.key === \"Escape\" || e.key === \"Esc\") {\n        hideMenu(state, Object.assign(\n          {},\n          attrs,\n          { hideDelay: 0 }\n        ));\n      }\n    };\n\n    handleSubscriptions(vnode, \"mount\");\n  }\n};\n\nexport const onUnMount = vnode => {\n  const attrs = vnode.attrs;\n  if (!attrs.permanent) {\n    handleSubscriptions(vnode, \"unmount\");\n  }\n};\n\nexport const createProps = (vnode, { keys: k }) => {\n  const attrs = vnode.attrs;\n  const type = attrs.type || DEFAULT_TYPE;\n  return Object.assign(\n    {}, \n    filterSupportedAttributes(attrs),\n    {\n      className: [\n        classes.component,\n        attrs.permanent ? classes.permanent : null,\n        attrs.fullHeight ? classes.fullHeight : null,\n        type === \"floating\" ? classes.floating : null,\n        attrs.target ? classes.target : null,\n        attrs.size ? widthClass(unifySize(attrs.size)) : null,\n        attrs.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        attrs.tone === \"light\" ? \"pe-light-tone\" : null,\n        attrs.className || attrs[k.class],\n      ].join(\" \")\n    }\n  );\n};\n\nexport const createContent = (vnode, { renderer: h, keys: k, Shadow }) => {\n  const attrs = vnode.attrs;\n  const z = attrs.z !== undefined ? attrs.z : SHADOW_Z;\n  return h(\"div\",\n    {\n      className: classes.content,\n      [k.onclick]: e => e.preventDefault(),\n      style: attrs.style\n    },\n    [\n      z > 0 && h(Shadow, {\n        z,\n        animated: true\n      }),\n      attrs.content\n        ? attrs.content\n        : vnode.children\n    ]\n  );\n};","import { vars } from \"polythene-theme\";\n\nconst rgba = (colorStr, opacity = 1) =>\n  `rgba(${colorStr}, ${opacity})`;\n\nexport default {\n  sizes:                  [1, 1.5, 2, 3, 4, 5, 6, 7],\n  min_size:               1.5,\n  max_size_small_screen:  5,\n  size_factor:            vars.grid_unit_menu,\n  border_radius:          vars.unit_block_border_radius,\n\n  animation_delay:           \"0s\",\n  animation_duration:        \".220s\",\n  animation_timing_function: \"ease-in-out\",\n  animation_hide_css:        \"opacity: 0;\",\n  animation_show_css:        \"opacity: 1;\",\n\n  color_light_background: rgba(vars.color_light_background),\n  color_dark_background:  rgba(vars.color_dark_background)\n  // text colors are set by content, usually list tiles\n};"],"names":["component","content","highSubtitle","primary","secondary","subtitle","title","contentFront","compact","compactFront","disabled","hasFront","hasHighSubtitle","hasSubtitle","header","hoverable","selectable","selected","highlight","sticky","navigation","placeholder","target","permanent","fullHeight","floating","visible","width_auto","width_n","listTile","listTileClasses","selectedListTile","getElement","vnode","attrs","element","DEFAULT_OFFSET_H","DEFAULT_TYPE","MIN_SIZE","OFFSET_V","SHADOW_Z","positionMenu","state","isServer","targetEl","document","querySelector","offsetH","offset","undefined","menuEl","dom","contentEl","classes","origin","positionOffset","reposition","firstItem","querySelectorAll","selectedItem","firstItemRect","getBoundingClientRect","selectedItemRect","top","alignEl","alignRect","targetRect","heightDiff","height","parentNode","parentRect","alignLeft","style","left","alignRight","right","alignTop","alignBottom","bottom","alignFn","call","transitionOptions","isShow","beforeTransition","domElements","el","showClass","showMenu","transitionComponent","hideMenu","unifySize","size","widthClass","toString","replace","handleSubscriptions","which","subscribe","update","handleEscape","setTimeout","activateDismissTap","unsubscribe","deActivateDismissTap","getInitialState","createStream","transitioning","handleDismissTap","redrawOnUpdate","merge","onMount","e","defaultPrevented","hideDelay","isTouch","addEventListener","removeEventListener","key","onUnMount","createProps","k","keys","type","filterSupportedAttributes","className","tone","class","join","createContent","h","renderer","Shadow","z","onclick","preventDefault","animated","children","rgba","colorStr","opacity","sizes","min_size","max_size_small_screen","size_factor","vars","grid_unit_menu","border_radius","unit_block_border_radius","animation_delay","animation_duration","animation_timing_function","animation_hide_css","animation_show_css","color_light_background","color_dark_background"],"mappings":"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"}