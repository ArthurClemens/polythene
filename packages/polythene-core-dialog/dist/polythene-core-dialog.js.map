{"version":3,"file":"polythene-core-dialog.js","sources":["../../polythene-css-classes/dialog.js","../../polythene-css-classes/menu.js","../src/index.js"],"sourcesContent":["import menuClasses from \"./menu\";\n\nexport default {\n  component:         \"pe-dialog\",\n\n  // elements\n  placeholder:       \"pe-dialog__placeholder\",\n  holder:            \"pe-dialog__holder\",\n  content:           \"pe-dialog__content\",\n  backdrop:          \"pe-dialog__backdrop\",\n  touch:             \"pe-dialog__touch\",\n\n  // states\n  fullScreen:        \"pe-dialog--full-screen\",\n  modal:             \"pe-dialog--modal\",\n  open:              \"pe-dialog--open\",    // class set to html element\n  visible:           \"pe-dialog--visible\", // class set to dialog element\n  showBackdrop:      \"pe-dialog--backdrop\",\n  transition:        \"pe-dialog--transition\",\n\n  // lookup\n  menuContent:       menuClasses.content,\n};\n","import listTileClasses from \"./list-tile\";\n\nexport default {\n  component:   \"pe-menu\",\n\n  // elements\n  panel:       \"pe-menu__panel\",\n  content:     \"pe-menu__content\",\n  placeholder: \"pe-menu__placeholder\",\n  backdrop:    \"pe-menu__backdrop\",\n\n  // states\n  floating:     \"pe-menu--floating\",\n  origin:       \"pe-menu--origin\",\n  permanent:    \"pe-menu--permanent\",\n  showBackdrop: \"pe-menu--backdrop\",\n  visible:      \"pe-menu--visible\",\n  width_auto:   \"pe-menu--width-auto\",\n  width_n:      \"pe-menu--width-\",\n  isTopMenu:    \"pe-menu--top-menu\",\n\n  // lookup\n  listTile:         listTileClasses.component,\n  selectedListTile: listTileClasses.selected,\n};","import {\n  filterSupportedAttributes,\n  subscribe,\n  unsubscribe,\n  transitionComponent,\n  stylePropCompare,\n  transitionStateReducer,\n  initialTransitionState,\n} from \"polythene-core\";\nimport classes from \"polythene-css-classes/dialog\";\n\nconst DEFAULT_SHADOW_DEPTH = 3;\n\nexport const openDialogsSelector = `.${classes.component}`;\n\nconst createPane = ({ h, Pane, props }) =>\n  h(Pane, {\n    body: props.content || props.body || props.menu || props.children,\n    element: props.element,\n    borders: props.borders,\n    className: props.className,\n    footer: props.footer,\n    footerButtons: props.footerButtons,\n    formOptions: props.formOptions,\n    fullBleed: props.fullBleed,\n    header: props.header,\n    style: props.style,\n    title: props.title,\n  });\n\nexport const _Dialog = ({\n  h,\n  a,\n  useState,\n  useEffect,\n  useRef,\n  getRef,\n  useReducer,\n  Pane,\n  Shadow,\n  openDialogsSelector,\n  ...props\n}) => {\n  const [transitionState, dispatchTransitionState] = useReducer(\n    transitionStateReducer,\n    initialTransitionState\n  );\n  const [domElement, setDomElement] = useState();\n  const backdropElRef = useRef();\n  const touchElRef = useRef();\n  const contentElRef = useRef();\n\n  const isVisible = (transitionState || initialTransitionState).isVisible;\n  const isTransitioning = (transitionState || initialTransitionState)\n    .isTransitioning;\n\n  const transitionOptions = ({\n    isShow,\n    hideDelay = props.hideDelay,\n    referrer,\n  }) => ({\n    transitionState,\n    dispatchTransitionState,\n    instanceId: props.instanceId,\n    props: Object.assign({}, props, {\n      hideDelay,\n    }),\n    isShow,\n    domElements: {\n      el: domElement,\n      contentEl: contentElRef.current,\n      backdropEl: backdropElRef.current,\n    },\n    showClass: classes.visible,\n    transitionClass: classes.transition,\n    referrer,\n  });\n\n  const showDialog = () =>\n    transitionComponent(transitionOptions({ isShow: true }));\n\n  const hideDialog = ({ hideDelay, referrer } = {}) =>\n    transitionComponent(\n      transitionOptions({ isShow: false, hideDelay, referrer })\n    );\n\n  const isModal = () =>\n    props.modal ||\n    (domElement && domElement.classList.contains(classes.modal)) ||\n    stylePropCompare({\n      element: domElement,\n      pseudoSelector: \":before\",\n      prop: \"content\",\n      contains: `\"${\"modal\"}\"`,\n    });\n\n  const isFullScreen = () =>\n    props.fullScreen ||\n    (domElement && domElement.classList.contains(classes.fullScreen)) ||\n    stylePropCompare({\n      element: domElement,\n      pseudoSelector: \":before\",\n      prop: \"content\",\n      contains: `\"${\"full_screen\"}\"`,\n    });\n\n  // DOM elements\n  useEffect(() => {\n    if (!domElement) {\n      return;\n    }\n    backdropElRef.current = domElement.querySelector(`.${classes.backdrop}`);\n    touchElRef.current = domElement.querySelector(`.${classes.touch}`);\n    contentElRef.current = domElement.querySelector(`.${classes.content}`);\n  }, [domElement]);\n\n  // Handle Escape key\n  useEffect(() => {\n    if (!domElement || props.inactive) {\n      return;\n    }\n    const handleEscape = (e) => {\n      if (props.disableEscape && (isFullScreen() || isModal())) return;\n      if (e.key === \"Escape\" || e.key === \"Esc\") {\n        // \"Esc\" for IE11\n        const openDialogs = document.querySelectorAll(openDialogsSelector);\n        if (openDialogs[openDialogs.length - 1] === domElement) {\n          hideDialog();\n          unsubscribe(\"keydown\", handleEscape);\n        }\n      }\n    };\n    subscribe(\"keydown\", handleEscape);\n\n    return () => {\n      unsubscribe(\"keydown\", handleEscape);\n    };\n  }, [domElement, props.inactive]);\n\n  // Show / hide logic\n  useEffect(() => {\n    if (!domElement || isTransitioning) {\n      return;\n    }\n    if (props.hide) {\n      if (isVisible) {\n        hideDialog();\n      }\n    } else if (props.show) {\n      if (!isVisible) {\n        showDialog();\n      }\n    }\n  }, [domElement, isTransitioning, isVisible, props.hide, props.show]);\n\n  const componentProps = Object.assign(\n    {},\n    filterSupportedAttributes(props, { remove: [\"style\"] }), // style set in content, and set by show/hide transition\n    getRef(\n      (dom) =>\n        dom && !domElement && (setDomElement(dom), props.ref && props.ref(dom))\n    ),\n    {\n      className: [\n        props.parentClassName || classes.component,\n        props.fromMultipleClassName,\n        props.fullScreen ? classes.fullScreen : null,\n        props.modal ? classes.modal : null,\n        props.backdrop ? classes.showBackdrop : null,\n        // classes.visible is set in showDialog though transition\n        props.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        props.tone === \"light\" ? \"pe-light-tone\" : null,\n        props.className || props[a.class],\n      ].join(\" \"),\n      \"data-spawn-id\": props.spawnId, // received from Multi\n      \"data-instance-id\": props.instanceId, // received from Multi\n      // click backdrop: close dialog\n      [a.onclick]: (e) => {\n        if (\n          e.target !== domElement &&\n          e.target !== backdropElRef.current &&\n          e.target !== touchElRef.current\n        ) {\n          return;\n        }\n        if (isModal()) {\n          // not allowed\n          return;\n        }\n        hideDialog();\n      },\n      role: \"dialog\",\n    }\n  );\n\n  const pane =\n    props.panesOptions && props.panesOptions.length\n      ? h(Pane, props.panesOptions[0])\n      : props.panes && props.panes.length\n      ? props.panes[0]\n      : createPane({ h, Pane, props });\n  const shadowDepth = props.shadowDepth;\n\n  const content = [\n    h(\"div\", {\n      className: classes.backdrop,\n    }),\n    h(\"div\", {\n      className: classes.touch,\n    }),\n    h(\n      \"div\",\n      {\n        className: [\n          classes.content,\n          props.menu ? classes.menuContent : null,\n        ].join(\" \"),\n      },\n      [\n        props.fullScreen\n          ? null\n          : h(Shadow, {\n              shadowDepth:\n                shadowDepth !== undefined ? shadowDepth : DEFAULT_SHADOW_DEPTH,\n              animated: true,\n            }),\n        props.before,\n        pane,\n        props.after,\n      ]\n    ),\n  ];\n  return h(\"div\", componentProps, content);\n};\n"],"names":["component","placeholder","holder","content","backdrop","touch","fullScreen","modal","open","visible","showBackdrop","transition","menuContent","openDialogsSelector","classes","h","a","useState","useEffect","useRef","getRef","useReducer","Pane","Shadow","props","transitionStateReducer","initialTransitionState","transitionState","dispatchTransitionState","domElement","setDomElement","backdropElRef","touchElRef","contentElRef","isVisible","isTransitioning","transitionOptions","isShow","hideDelay","referrer","instanceId","_extends","domElements","el","contentEl","current","backdropEl","showClass","transitionClass","hideDialog","transitionComponent","isModal","classList","contains","stylePropCompare","element","pseudoSelector","prop","querySelector","inactive","handleEscape","e","disableEscape","key","openDialogs","document","querySelectorAll","length","unsubscribe","subscribe","hide","show","componentProps","filterSupportedAttributes","remove","dom","ref","className","parentClassName","fromMultipleClassName","tone","join","spawnId","onclick","target","pane","panesOptions","panes","body","menu","children","borders","footer","footerButtons","formOptions","fullBleed","header","style","title","createPane","shadowDepth","undefined","animated","before","after"],"mappings":"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"}