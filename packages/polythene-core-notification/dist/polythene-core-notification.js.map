{"version":3,"file":"polythene-core-notification.js","sources":["../../polythene-css-classes/notification.js","../src/index.js"],"sourcesContent":["\nexport default {\n  component:      \"pe-notification\",\n\n  // elements\n  action:         \"pe-notification__action\",\n  content:        \"pe-notification__content\",\n  holder:         \"pe-notification__holder\",\n  placeholder:    \"pe-notification__placeholder\",\n  title:          \"pe-notification__title\",\n\n  // states\n  hasContainer:   \"pe-notification--container\",\n  horizontal:     \"pe-notification--horizontal\",\n  multilineTitle: \"pe-notification__title--multi-line\",\n  vertical:       \"pe-notification--vertical\",\n  visible:        \"pe-notification--visible\",\n};","import { filterSupportedAttributes, transitionComponent, isClient, isServer, transitionStateReducer, initialTransitionState } from \"polythene-core\";\nimport { Timer } from \"polythene-utilities\";\nimport classes from \"polythene-css-classes/notification\";\n\nconst DEFAULT_TIME_OUT = 3;\n\nconst setTitleStyles = titleEl => {\n  if (isServer) return;\n  const height = titleEl.getBoundingClientRect().height;\n  const lineHeight = parseInt(window.getComputedStyle(titleEl).lineHeight, 10);\n  const paddingTop = parseInt(window.getComputedStyle(titleEl).paddingTop, 10);\n  const paddingBottom = parseInt(window.getComputedStyle(titleEl).paddingBottom, 10);\n  if (height > (lineHeight + paddingTop + paddingBottom)) {\n    titleEl.classList.add(classes.multilineTitle);\n  }\n};\n\nexport const _Notification = ({ h, a, useState, useEffect, useRef, getRef, useReducer, ...props }) => {\n  const [transitionState, dispatchTransitionState] = useReducer(transitionStateReducer, initialTransitionState);\n  const [domElement, setDomElement] = useState();\n  const [isPaused, setIsPaused] = useState(false);\n  const containerElRef = useRef();\n  const titleElRef = useRef();\n  const timerRef = useRef();\n  \n  const isVisible = (transitionState || initialTransitionState).isVisible;\n  const isTransitioning = (transitionState || initialTransitionState).isTransitioning;\n  const isHiding = (transitionState || initialTransitionState).isHiding;\n\n  const transitionOptions = ({ isShow, referrer }) => ({\n    dispatchTransitionState,\n    instanceId: props.instanceId,\n    props,\n    isShow,\n    beforeTransition: stopTimer,\n    afterTransition: isShow\n      ? () => {\n        // set timer to hide in a few seconds\n        const timeout = props.timeout;\n        if (timeout === 0) {\n          // do not time out\n        } else {\n          const timeoutSeconds = timeout !== undefined\n            ? timeout\n            : DEFAULT_TIME_OUT;\n            timerRef.current.start(() => hideNotification(), timeoutSeconds);\n        }     \n      }\n      : null,\n    domElements: {\n      el: domElement,\n      containerEl: containerElRef.current\n    },\n    showClass: classes.visible,\n    referrer\n  });\n\n  const showNotification = () =>\n    transitionComponent(transitionOptions({ isShow: true }));\n\n  const hideNotification = ({ referrer } = {}) =>\n    transitionComponent(transitionOptions({ isShow: false, referrer }));\n\n  const pause = () => {\n    setIsPaused(true);\n    if (timerRef.current) {\n      timerRef.current.pause();\n    }\n  };\n  \n  const unpause = () => {\n    setIsPaused(false);\n    if (timerRef.current) {\n      timerRef.current.resume();\n    }\n  };\n  \n  const stopTimer = () => {\n    if (timerRef.current) {\n      timerRef.current.stop();\n    }\n  };\n\n  useEffect(\n    () => {\n      return () => {\n        stopTimer();\n      }\n    },\n    []\n  );\n\n  // Timer\n  useEffect(\n    () => {\n      timerRef.current = new Timer();\n    },\n    []\n  );\n\n  // DOM elements\n  useEffect(\n    () => {\n      if (!domElement) {\n        return;\n      }\n      if (isClient) {\n        // props.holderSelector is passed as option to Multiple\n        containerElRef.current = document.querySelector(props.containerSelector || props.holderSelector);\n        if (!containerElRef.current) {\n          console.error(\"No container element found\"); // eslint-disable-line no-console\n        }\n        if (props.containerSelector && containerElRef.current) {\n          containerElRef.current.classList.add(classes.hasContainer);\n        }\n      }\n\n      titleElRef.current = domElement.querySelector(`.${classes.title}`);\n      if (titleElRef.current) {\n        setTitleStyles(titleElRef.current);\n      }\n    },\n    [domElement]\n  );\n\n  // Show / hide logic\n  useEffect(\n    () => {\n      if (!domElement || isTransitioning || isHiding) {\n        return;\n      }\n      if (props.hide) {\n        if (isVisible) {\n          hideNotification();\n        }\n      } else if (props.show) {\n        if (!isVisible) {\n          showNotification();\n        }\n      }\n    },\n    [domElement, isTransitioning, isVisible, isHiding, props.hide, props.show]\n  );\n\n  // Pause logic\n  useEffect(\n    () => {\n      if (!domElement || isTransitioning || isHiding) {\n        return;\n      }\n      if (props.unpause) {\n        if (isPaused) {\n          unpause();\n        }\n      } else if (props.pause) {\n        if (!isPaused) {\n          pause();\n        }\n      }\n    },\n    [domElement, isTransitioning, isHiding, props.pause, props.unpause]\n  );\n  \n  const componentProps = Object.assign(\n    {}, \n    filterSupportedAttributes(props, { remove: [\"style\"] }), // style set in content, and set by show/hide transition\n    getRef(dom => dom && !domElement && (\n      setDomElement(dom),\n      props.ref && props.ref(dom)\n    )),\n    props.testId && { \"data-test-id\": props.testId },\n    {\n      className: [\n        classes.component,\n        props.fromMultipleClassName,\n        // classes.visible is set in showNotification though transition\n        props.tone === \"light\" ? null : \"pe-dark-tone\", // default dark tone\n        props.containerSelector ? classes.hasContainer : null,\n        props.layout === \"vertical\" ? classes.vertical : classes.horizontal,\n        props.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        props.tone === \"light\" ? \"pe-light-tone\" : null,\n        props.className || props[a.class],\n      ].join(\" \"),\n      [a.onclick]: e => e.preventDefault()\n    }\n  );\n\n  const contents = h(\"div\",\n    {\n      className: classes.content,\n      style: props.style,\n    },\n    props.content || [\n      props.title\n        ? h(\"div\",\n          { className: classes.title },\n          props.title\n        )\n        : null,\n      props.action\n        ? h(\"div\",\n          { className: classes.action },\n          props.action\n        )\n        : null\n    ]\n  );\n  const content = [\n    props.before,\n    contents,\n    props.after\n  ];\n  return h(props.element || \"div\", componentProps, content);\n};\n"],"names":["component","action","content","holder","placeholder","title","hasContainer","horizontal","multilineTitle","vertical","visible","h","a","useState","useEffect","useRef","getRef","useReducer","props","transitionStateReducer","initialTransitionState","transitionState","dispatchTransitionState","domElement","setDomElement","isPaused","setIsPaused","containerElRef","titleElRef","timerRef","isVisible","isTransitioning","isHiding","transitionOptions","isShow","referrer","instanceId","beforeTransition","stopTimer","afterTransition","timeout","timeoutSeconds","undefined","current","start","hideNotification","domElements","el","containerEl","showClass","classes","transitionComponent","stop","Timer","titleEl","isClient","document","querySelector","containerSelector","holderSelector","console","error","classList","add","isServer","getBoundingClientRect","height","parseInt","window","getComputedStyle","lineHeight","paddingTop","paddingBottom","hide","show","unpause","resume","pause","componentProps","_extends","filterSupportedAttributes","remove","dom","ref","testId","className","fromMultipleClassName","tone","layout","join","onclick","e","preventDefault","contents","style","before","after","element"],"mappings":"m5DACe,CACbA,UAAgB,kBAGhBC,OAAgB,0BAChBC,QAAgB,2BAChBC,OAAgB,0BAChBC,YAAgB,+BAChBC,MAAgB,yBAGhBC,aAAgB,6BAChBC,WAAgB,8BAChBC,eAAgB,qCAChBC,SAAgB,4BAChBC,QAAgB,4CCCW,gBAAGC,IAAAA,EAAGC,IAAAA,EAAGC,IAAAA,SAAUC,IAAAA,UAAWC,IAAAA,OAAQC,IAAAA,OAAQC,IAAAA,WAAeC,2EACrCD,EAAWE,yBAAwBC,6BAA/EC,OAAiBC,WACYT,OAA7BU,OAAYC,WACaX,GAAS,MAAlCY,OAAUC,OACXC,EAAiBZ,IACjBa,EAAab,IACbc,EAAWd,IAEXe,GAAaT,GAAmBD,0BAAwBU,UACxDC,GAAmBV,GAAmBD,0BAAwBW,gBAC9DC,GAAYX,GAAmBD,0BAAwBY,SAEvDC,EAAoB,gBAAGC,IAAAA,OAAQC,IAAAA,eAAgB,CACnDb,wBAAAA,EACAc,WAAYlB,EAAMkB,WAClBlB,MAAAA,EACAgB,OAAAA,EACAG,iBAAkBC,EAClBC,gBAAiBL,EACb,eAEMM,EAAUtB,EAAMsB,WACN,IAAZA,OAEG,KACCC,OAA6BC,IAAZF,EACnBA,EAvCW,EAyCbX,EAASc,QAAQC,OAAM,kBAAMC,MAAoBJ,KAGrD,KACJK,YAAa,CACXC,GAAIxB,EACJyB,YAAarB,EAAegB,SAE9BM,UAAWC,EAAQxC,QACnByB,SAAAA,IAMIU,EAAmB,wEAAgB,GAAbV,IAAAA,gBAC1BgB,sBAAoBlB,EAAkB,CAAEC,QAAQ,EAAOC,SAAAA,MAgBnDG,EAAY,WACZT,EAASc,SACXd,EAASc,QAAQS,QAIrBtC,GACE,kBACS,WACLwB,OAGJ,IAIFxB,GACE,WACEe,EAASc,QAAU,IAAIU,UAEzB,IAIFvC,GACE,WAhGmB,IAAAwC,EAiGZ/B,IAGDgC,aAEF5B,EAAegB,QAAUa,SAASC,cAAcvC,EAAMwC,mBAAqBxC,EAAMyC,gBAC5EhC,EAAegB,SAClBiB,QAAQC,MAAM,8BAEZ3C,EAAMwC,mBAAqB/B,EAAegB,SAC5ChB,EAAegB,QAAQmB,UAAUC,IAAIb,EAAQ5C,eAIjDsB,EAAWe,QAAUpB,EAAWkC,yBAAkBP,EAAQ7C,QACtDuB,EAAWe,UAhHEW,EAiHA1B,EAAWe,QAhH5BqB,YACWV,EAAQW,wBAAwBC,OAC5BC,SAASC,OAAOC,iBAAiBf,GAASgB,WAAY,IACtDH,SAASC,OAAOC,iBAAiBf,GAASiB,WAAY,IACnDJ,SAASC,OAAOC,iBAAiBf,GAASkB,cAAe,KAE7ElB,EAAQQ,UAAUC,IAAIb,EAAQ1C,oBA6G9B,CAACe,IAIHT,GACE,YACOS,GAAcQ,GAAmBC,IAGlCd,EAAMuD,KACJ3C,GACFe,IAEO3B,EAAMwD,OACV5C,GA9ETqB,sBAAoBlB,EAAkB,CAAEC,QAAQ,SAmFhD,CAACX,EAAYQ,EAAiBD,EAAWE,EAAUd,EAAMuD,KAAMvD,EAAMwD,OAIvE5D,GACE,YACOS,GAAcQ,GAAmBC,IAGlCd,EAAMyD,QACJlD,IAhFRC,GAAY,GACRG,EAASc,SACXd,EAASc,QAAQiC,UAiFN1D,EAAM2D,QACVpD,IA3FTC,GAAY,GACRG,EAASc,SACXd,EAASc,QAAQkC,aA8FnB,CAACtD,EAAYQ,EAAiBC,EAAUd,EAAM2D,MAAO3D,EAAMyD,oBAGvDG,EAAiBC,EACrB,GACAC,4BAA0B9D,EAAO,CAAE+D,OAAQ,CAAC,WAC5CjE,GAAO,SAAAkE,UAAOA,IAAQ3D,IACpBC,EAAc0D,GACdhE,EAAMiE,KAAOjE,EAAMiE,IAAID,OAEzBhE,EAAMkE,QAAU,gBAAkBlE,EAAMkE,YAEtCC,UAAW,CACTnC,EAAQlD,UACRkB,EAAMoE,sBAES,UAAfpE,EAAMqE,KAAmB,KAAO,eAChCrE,EAAMwC,kBAAoBR,EAAQ5C,aAAe,KAChC,aAAjBY,EAAMsE,OAAwBtC,EAAQzC,SAAWyC,EAAQ3C,WAC1C,SAAfW,EAAMqE,KAAkB,eAAiB,KAC1B,UAAfrE,EAAMqE,KAAmB,gBAAkB,KAC3CrE,EAAMmE,WAAanE,EAAMN,UACzB6E,KAAK,QACN7E,EAAE8E,UAAU,SAAAC,UAAKA,EAAEC,mHAIlBC,EAAWlF,EAAE,MACjB,CACE0E,UAAWnC,EAAQhD,QACnB4F,MAAO5E,EAAM4E,OAEf5E,EAAMhB,SAAW,CACfgB,EAAMb,MACFM,EAAE,MACF,CAAE0E,UAAWnC,EAAQ7C,OACrBa,EAAMb,OAEN,KACJa,EAAMjB,OACFU,EAAE,MACF,CAAE0E,UAAWnC,EAAQjD,QACrBiB,EAAMjB,QAEN,OAGFC,EAAU,CACdgB,EAAM6E,OACNF,EACA3E,EAAM8E,cAEDrF,EAAEO,EAAM+E,SAAW,MAAOnB,EAAgB5E"}