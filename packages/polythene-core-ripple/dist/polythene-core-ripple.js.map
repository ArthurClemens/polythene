{"version":3,"file":"polythene-core-ripple.js","sources":["../src/ripple-animation.js","../../polythene-css-classes/ripple.js","../src/index.js"],"sourcesContent":["import { isTouch, getAnimationEndEvent, isServer } from \"polythene-core\";\nimport { vars } from \"polythene-theme\";\n\nconst ANIMATION_END_EVENT =    getAnimationEndEvent();\nconst DEFAULT_START_OPACITY =  0.2;\nconst DEFAULT_END_OPACITY =    0.0;\nconst DEFAULT_START_SCALE =    0.1;\nconst DEFAULT_END_SCALE =      2.0;\nconst OPACITY_DECAY_VELOCITY = 0.35;\n\nconst addStyleToHead = (id, stylesheet) => {\n  if (isServer) return;\n  const documentRef = window.document;\n  const styleEl = documentRef.createElement(\"style\");\n  styleEl.setAttribute(\"id\", id);\n  styleEl.appendChild(documentRef.createTextNode(stylesheet));\n  documentRef.head.appendChild(styleEl);\n};\n\nconst removeStyleFromHead = id => {\n  if (isServer) return;\n  const el = document.getElementById(id);\n  if (el && el.parentNode) {\n    el.parentNode.removeChild(el);\n  }\n};\n\nexport default ({ e, id, el, props, classes }) => {\n  return new Promise(resolve => {\n    const container = document.createElement(\"div\");\n    container.setAttribute(\"class\", classes.mask);\n    el.appendChild(container);\n    const waves = document.createElement(\"div\");\n    waves.setAttribute(\"class\", classes.waves);\n    container.appendChild(waves);\n    const rect = el.getBoundingClientRect();\n    const x = (isTouch && e.touches) ? e.touches[0].pageX : e.clientX;\n    const y = (isTouch && e.touches) ? e.touches[0].pageY : e.clientY;  \n    const w = el.offsetWidth;\n    const h = el.offsetHeight;\n    const waveRadius = Math.sqrt(w * w + h * h);\n    const mx = (props.center) ? (rect.left + rect.width / 2) : x;\n    const my = (props.center) ? (rect.top + rect.height / 2) : y;\n    const rx = mx - rect.left - waveRadius / 2;\n    const ry = my - rect.top - waveRadius / 2;\n    const startOpacity = props.startOpacity !== undefined\n      ? props.startOpacity\n      : DEFAULT_START_OPACITY;\n    const opacityDecayVelocity = props.opacityDecayVelocity !== undefined\n      ? props.opacityDecayVelocity\n      : OPACITY_DECAY_VELOCITY;\n    const endOpacity = props.endOpacity || DEFAULT_END_OPACITY;\n    const startScale = props.startScale || DEFAULT_START_SCALE;\n    const endScale = props.endScale || DEFAULT_END_SCALE;\n    const duration = props.duration\n      ? props.duration\n      : 1 / opacityDecayVelocity * 0.2;\n    const color = window.getComputedStyle(el).color;\n    \n    const style = waves.style;\n    style.width = style.height = waveRadius + \"px\";\n    style.top = ry + \"px\";\n    style.left = rx + \"px\";\n    style[\"animation-duration\"] =\n      style[\"-webkit-animation-duration\"] =\n      style[\"-moz-animation-duration\"] =\n      style[\"-o-animation-duration\"] = duration + \"s\";\n    style.backgroundColor = color;\n    style.opacity = startOpacity;\n    style.animationName = id;\n    style.animationTimingFunction = props.animationTimingFunction || vars.animation_curve_default;\n\n    const rippleStyleSheet = `@keyframes ${id} {\n      0% {\n        transform:scale(${startScale});\n        opacity: ${startOpacity}\n      }\n      100% {\n        transform:scale(${endScale});\n        opacity: ${endOpacity};\n      }\n    }`;\n    addStyleToHead(id, rippleStyleSheet);\n\n    const animationDone = evt => {\n      removeStyleFromHead(id);\n      waves.removeEventListener(ANIMATION_END_EVENT, animationDone, false);\n      if (props.persistent) {\n        style.opacity = endOpacity;\n        style.transform = \"scale(\" + endScale + \")\";\n      } else {\n        waves.classList.remove(classes.wavesAnimating);\n        container.removeChild(waves);\n        el.removeChild(container);\n      }\n      resolve(evt);\n    };\n\n    waves.addEventListener(ANIMATION_END_EVENT, animationDone, false);\n    waves.classList.add(classes.wavesAnimating);\n  });\n};\n","\nexport default {\n  component:      \"pe-ripple\",\n\n  // elements\n  mask:           \"pe-ripple__mask\",\n  waves:          \"pe-ripple__waves\",\n\n  // states\n  unconstrained:  \"pe-ripple--unconstrained\",\n  wavesAnimating: \"pe-ripple__waves--animating\",\n};\n","import { pointerEndEvent, filterSupportedAttributes } from \"polythene-core\";\nimport rippleAnimation from \"./ripple-animation\";\nimport classes from \"polythene-css-classes/ripple\";\n\nexport { rippleAnimation };\n\nexport const _Ripple = ({ h, a, getRef, useRef, useState, useEffect, ...props }) => {\n  const [domElement, setDomElement] = useState();\n  const animationCountRef = useRef(0);\n  const triggerEl = props.target || (domElement ? domElement.parentElement : undefined);\n\n  const tap = e => {\n    if (props.disabled || !domElement || (!props.multi && animationCountRef.current > 0)) {\n      return;\n    }\n    if (props.start) {\n      props.start(e);\n    }\n    const id = `ripple_animation_${new Date().getTime()}`;\n    rippleAnimation({ e, id, el: domElement, props, classes })\n      .then(evt => {\n        if (props.end) {\n          props.end(evt);\n        }\n        animationCountRef.current--;\n      });\n      animationCountRef.current++;\n  };\n\n  useEffect(\n    () => {\n      if (triggerEl && triggerEl.addEventListener) {\n        pointerEndEvent.forEach(evt =>\n          triggerEl.addEventListener(evt, tap, false));\n      \n        return () => {\n          pointerEndEvent.forEach(evt =>\n            triggerEl.removeEventListener(evt, tap, false));\n        };\n      }\n    },\n    [triggerEl]\n  );\n\n  const componentProps = Object.assign({}, \n    filterSupportedAttributes(props),\n    getRef(dom => dom && !domElement && setDomElement(dom)),\n    props.testId && { \"data-test-id\": props.testId },\n    {\n      className: [\n        classes.component,\n        props.unconstrained ? classes.unconstrained : null,\n        props.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        props.tone === \"light\" ? \"pe-light-tone\" : null,\n        props.className || props[a.class],\n      ].join(\" \")\n    }\n  );\n\n  const content = [\n    props.before,\n    props.after,\n  ];\n\n  return h(props.element || \"div\",\n    componentProps,\n    content\n  );\n};\n"],"names":["ANIMATION_END_EVENT","getAnimationEndEvent","e","id","el","props","classes","Promise","resolve","container","document","createElement","setAttribute","mask","appendChild","waves","rect","getBoundingClientRect","x","isTouch","touches","pageX","clientX","y","pageY","clientY","w","offsetWidth","h","offsetHeight","waveRadius","Math","sqrt","mx","center","left","width","my","top","height","rx","ry","startOpacity","undefined","opacityDecayVelocity","endOpacity","startScale","endScale","duration","color","window","getComputedStyle","style","backgroundColor","opacity","animationName","animationTimingFunction","vars","animation_curve_default","rippleStyleSheet","stylesheet","isServer","documentRef","styleEl","createTextNode","head","addStyleToHead","addEventListener","animationDone","evt","getElementById","parentNode","removeChild","removeStyleFromHead","removeEventListener","persistent","transform","classList","remove","wavesAnimating","add","component","unconstrained","a","getRef","useRef","useState","useEffect","domElement","setDomElement","animationCountRef","triggerEl","target","parentElement","tap","disabled","multi","current","start","Date","getTime","rippleAnimation","then","end","pointerEndEvent","forEach","componentProps","_extends","filterSupportedAttributes","dom","testId","className","tone","join","content","before","after","element"],"mappings":"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"}