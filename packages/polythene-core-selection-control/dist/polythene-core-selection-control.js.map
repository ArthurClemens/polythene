{"version":3,"file":"polythene-core-selection-control.js","sources":["../../polythene-css-classes/selection-control.js","../src/ViewControl.js","../src/SelectionControl.js"],"sourcesContent":["\nexport default {\n  component: \"pe-control\",\n\n  // elements\n  formLabel: \"pe-control__form-label\",\n  input:     \"pe-control__input\",\n  label:     \"pe-control__label\",\n\n  // states\n  disabled:  \"pe-control--disabled\",\n  inactive:  \"pe-control--inactive\",\n  large:     \"pe-control--large\",\n  medium:    \"pe-control--medium\",\n  off:       \"pe-control--off\",\n  on:        \"pe-control--on\",\n  regular:   \"pe-control--regular\",\n  small:     \"pe-control--small\",\n\n  // control view elements\n  box:       \"pe-control__box\",\n  button:    \"pe-control__button\",\n\n  // control view states\n  buttonOff: \"pe-control__button--off\",\n  buttonOn:  \"pe-control__button--on\",\n};\n","import classes from \"polythene-css-classes/selection-control\";\n\nconst CONTENT = [\n  { iconType: \"iconOn\", className: classes.buttonOn },\n  { iconType: \"iconOff\", className: classes.buttonOff },\n];\n\nconst createIcon = (h, iconType, props, className) =>\n  // if props.iconOn/props.iconOff is passed, use that icon options object and ignore size\n  // otherwise create a new object\n  Object.assign(\n    {},\n    {\n      className,\n    },\n    props[iconType]\n      ? props[iconType]\n      : { svg: { content: h.trust(props.icons[iconType]) } },\n    props.icon,\n    props.size ? { size: props.size } : null\n  );\n\nexport const _ViewControl = ({ h, Icon, IconButton, aria, ...props }) => {\n  const element = props.element || `.${classes.box}`;\n  const content = h(\n    IconButton,\n    Object.assign(\n      {},\n      {\n        element: \"div\",\n        className: classes.button,\n        style: props.style,\n        content: CONTENT.map((o) =>\n          h(Icon, createIcon(h, o.iconType, props, o.className))\n        ),\n        ripple: { center: true },\n        disabled: props.disabled,\n        events: props.events,\n        inactive: props.inactive,\n        [a.tabindex]: \"0\",\n        aria,\n      },\n      props.iconButton // for example for hover behaviour\n    )\n  );\n  return h(element, null, content);\n};\n","import {\n  filterSupportedAttributes,\n  classForSize,\n  createUid,\n} from \"polythene-core\";\nimport classes from \"polythene-css-classes/selection-control\";\n\nexport const _SelectionControl = ({\n  h,\n  a,\n  useState,\n  useRef,\n  useEffect,\n  ViewControl,\n  ...props\n}) => {\n  // remove unused props\n  delete props.key;\n\n  const defaultChecked =\n    props.defaultChecked !== undefined\n      ? props.defaultChecked\n      : props.checked || false;\n  const [previousIsChecked, setIsChecked] = useState(defaultChecked);\n  const [isSelectable, setIsSelectable] = useState(props.selectable);\n\n  const isChecked =\n    props.checked !== undefined ? props.checked : previousIsChecked;\n\n  const inactive = props.disabled || !isSelectable;\n\n  // define isSelectable\n  // This variable is set in the next tick to allow button interaction (e.g. ripples) to show\n  // before the button is set to inactive state\n  useEffect(() => {\n    const selectable =\n      props.selectable !== undefined ? props.selectable(isChecked) : false;\n    if (selectable !== isSelectable) {\n      setIsSelectable(selectable);\n    }\n  }, [props.selectable, isChecked]);\n\n  const notifyChange = (e, isChecked) => {\n    if (props.onChange) {\n      props.onChange({\n        event: e,\n        checked: isChecked,\n        value: props.value,\n      });\n    }\n  };\n\n  const onChange = (e) => {\n    let isChecked = e.currentTarget.checked;\n    if (props.type === \"radio\") {\n      // do not set directly\n    } else {\n      setIsChecked(isChecked);\n    }\n    notifyChange(e, isChecked);\n  };\n\n  const toggle = (e) => {\n    const newChecked = !isChecked;\n    setIsChecked(newChecked);\n    notifyChange(e, newChecked);\n  };\n\n  // Id to match the label to the control\n  const uidRef = useRef(createUid());\n\n  const aria = Object.assign(\n    {},\n    props.aria,\n    props.label\n      ? {\n          \"aria-labelledby\": uidRef.current,\n        }\n      : undefined\n  );\n  const isAriaButton = aria.role === \"button\";\n\n  const viewControlClickHandler = (e) => {\n    e.preventDefault();\n    toggle(e);\n    if (props.events && props.events[a.onclick]) {\n      props.events[a.onclick](e);\n    }\n  };\n  const viewControlKeyDownHandler = props.events\n    ? props.events[a.onkeydown]\n      ? props.events[a.onkeydown]\n      : (e) => {\n          if (\n            e.key === \"Space\" ||\n            e.keyCode === 32 ||\n            (isAriaButton && (e.key === \"Enter\" || e.keyCode === 13))\n          ) {\n            e.preventDefault();\n            toggle(e);\n            if (viewControlClickHandler) {\n              viewControlClickHandler(e);\n            }\n          }\n        }\n    : undefined;\n\n  const componentProps = Object.assign(\n    {},\n    filterSupportedAttributes(props, { remove: [\"style\"] }), // Set style on view control\n    props.testId && { \"data-test-id\": props.testId },\n    {\n      className: [\n        classes.component,\n        props.instanceClass, // for instance pe-checkbox-control\n        isChecked ? classes.on : classes.off,\n        props.disabled ? classes.disabled : null,\n        inactive ? classes.inactive : null,\n        classForSize(classes, props.size),\n        props.tone === \"dark\" ? \"pe-dark-tone\" : null,\n        props.tone === \"light\" ? \"pe-light-tone\" : null,\n        props.className || props[a.class],\n      ].join(\" \"),\n    }\n  );\n\n  const content = h(\n    \"label\",\n    Object.assign(\n      {},\n      {\n        className: classes.formLabel,\n        [a.onclick]: viewControlClickHandler,\n      }\n    ),\n    [\n      props.before,\n      h(\n        ViewControl,\n        Object.assign({}, props, {\n          inactive,\n          checked: isChecked,\n          events: {\n            // Only use key down event; click events are handled by input element\n            [a.onkeydown]: viewControlKeyDownHandler,\n          },\n          aria,\n        })\n      ),\n      props.label\n        ? h(`.${classes.label}`, { id: uidRef.current }, props.label)\n        : null,\n      h(\n        \"input\",\n        Object.assign(\n          {},\n          props.events,\n          {\n            name: props.name,\n            type: props.type,\n            value: props.value,\n            checked: isChecked,\n          },\n          props.disabled || inactive\n            ? { [a.readonly]: \"readonly\" }\n            : {\n                [a.onchange]: onChange,\n              }\n        )\n      ),\n      props.after,\n    ]\n  );\n  return h(props.element || \"div\", componentProps, content);\n};\n"],"names":["component","formLabel","input","label","disabled","inactive","large","medium","off","on","regular","small","box","button","buttonOff","buttonOn","CONTENT","iconType","className","classes","h","a","useState","useRef","useEffect","ViewControl","props","key","undefined","defaultChecked","checked","previousIsChecked","setIsChecked","selectable","isSelectable","setIsSelectable","isChecked","notifyChange","e","onChange","event","value","toggle","newChecked","uidRef","createUid","aria","_extends","current","isAriaButton","role","viewControlClickHandler","preventDefault","events","onclick","viewControlKeyDownHandler","onkeydown","keyCode","componentProps","filterSupportedAttributes","remove","testId","instanceClass","classForSize","size","tone","join","content","before","id","name","type","readonly","onchange","currentTarget","after","element","Icon","IconButton","style","map","o","svg","trust","icons","icon","createIcon","ripple","center","tabindex","iconButton"],"mappings":"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"}