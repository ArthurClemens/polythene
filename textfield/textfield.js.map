{"version":3,"sources":["textfield.es6"],"names":["startEventType","isClient","window","PointerEvent","DocumentTouch","document","CSS_CLASSES","block","inputArea","input","label","counter","help","focusHelp","error","errorPlaceholder","stateFocused","stateDisabled","stateReadonly","stateInvalid","stateDirty","hasFloatingLabel","isDense","isRequired","hideRequiredChar","hasFullWidth","hasCounter","hideSpinner","hideClear","hideValidation","validateCustom","opts","validate","ctrl","value","invalid","state","valid","message","validateCounter","length","validateHTML","inputEl","checkValidity","getValidStatus","touched","isInvalid","validateResetOnClear","status","validateAtStart","previousInvalid","console","log","setTimeout","redraw","checkDirty","isDirty","toString","updateState","notifyState","getState","focus","dirty","el","ignoreEvent","ignoreEvents","indexOf","name","createView","tag","type","multiline","min","max","minlength","required","pattern","disabled","readonly","inactive","onBlur","e","target","classList","remove","class","floatingLabel","dense","fullWidth","hideRequiredMark","join","id","config","inited","context","vdom","inputTag","Object","assign","onclick","onfocus","add","oninput","validateOnInput","onkeydown","which","blur","addEventListener","onunload","removeEventListener","events","maxlength","autofocus","tabindex","rows","showError","validates","props","before","content","after","component","controller","prop","v","hasFocus","view"],"mappings":"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","file":"textfield.js","sourcesContent":["import 'polythene/common/object.assign';\nimport m from 'mithril';\nimport 'polythene/textfield/theme/theme';\nimport isomorphic from 'polythene/common/isomorphic';\n\nlet startEventType = 'mousedown';\nif(isomorphic.isClient()) {\n\tstartEventType = window.PointerEvent ? 'pointerdown' : (('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch) ? 'touchstart' : 'mousedown';\n}\n\nconst CSS_CLASSES = {\n    block: 'pe-textfield',\n    inputArea: 'pe-textfield__input-area',\n    input: 'pe-textfield__input',\n    label: 'pe-textfield__label',\n    counter: 'pe-textfield__counter',\n    help: 'pe-textfield__help',\n    focusHelp: 'pe-textfield__help-focus',\n    error: 'pe-textfield__error',\n    errorPlaceholder: 'pe-textfield__error-placeholder',\n    stateFocused: 'pe-textfield--focused',\n    stateDisabled: 'pe-textfield--disabled',\n    stateReadonly: 'pe-textfield--readonly',\n    stateInvalid: 'pe-textfield--invalid',\n    stateDirty: 'pe-textfield--dirty',\n    hasFloatingLabel: 'pe-textfield--floating-label',\n    isDense: 'pe-textfield--dense',\n    isRequired: 'pe-textfield--required',\n    hideRequiredChar: 'pe-textfield--no-char',\n    hasFullWidth: 'pe-textfield--full-width',\n    hasCounter: 'pe-textfield--counter',\n    hideSpinner: 'pe-textfield--hide-spinner',\n    hideClear: 'pe-textfield--hide-clear',\n    hideValidation: 'pe-textfield--hide-validation'\n};\n\nconst validateCustom = (ctrl, opts) => {\n    const state = opts.validate(ctrl.value);\n    return {\n        invalid: (state && !state.valid),\n        message: (state && state.error)\n    };\n};\n\nconst validateCounter = (ctrl, opts) => {\n    return {\n        invalid: (ctrl.value.length > opts.counter),\n        message: opts.error\n    };\n};\n\nconst validateHTML = (ctrl, opts) => {\n    return {\n        invalid: !ctrl.inputEl().checkValidity(),\n        message: opts.error\n    };\n};\n\nconst getValidStatus = (ctrl, opts) => {\n    let status = {\n        invalid: false,\n        message: undefined\n    };\n\n    // validateResetOnClear: reset validation when field is cleared\n    if (ctrl.touched && ctrl.isInvalid && ctrl.value.length === 0 && opts.validateResetOnClear) {\n        ctrl.touched = false;\n        ctrl.isInvalid = false;\n        ctrl.error = undefined;\n    }\n\n    if (!status.invalid && opts.counter) {\n        status = validateCounter(ctrl, opts);\n    }\n    if (!status.invalid && ctrl.inputEl() && ctrl.inputEl().checkValidity) {\n        status = validateHTML(ctrl, opts);\n    }\n    if (!status.invalid && opts.validate) {\n        status = validateCustom(ctrl, opts);\n    }\n    return status;\n};\n\nconst checkValidity = (ctrl, opts) => {\n    // default\n    const status = (!ctrl.touched && !opts.validateAtStart)\n        ? {\n            invalid: false,\n            message: undefined\n        }\n        : getValidStatus(ctrl, opts);\n    const previousInvalid = ctrl.isInvalid;\n    ctrl.error = status.message;\n    ctrl.isInvalid = status.invalid;\n    if (status.invalid !== previousInvalid) {\n\t\tconsole.log('REDRAW 2');\n        setTimeout(m.redraw, 0);\n    }\n\n    if (!status.invalid) {\n        ctrl.error = undefined;\n    }\n};\n\n// dirty = contains text\nconst checkDirty = (ctrl) => {\n    ctrl.isDirty = (ctrl.value && ctrl.value.toString().length > 0);\n};\n\nconst updateState = (ctrl, opts) => {\n    checkValidity(ctrl, opts);\n    checkDirty(ctrl);\n};\n\nconst notifyState = (ctrl, opts) => {\n    if (opts.getState) {\n        // get status directly without updating controller\n        const status = getValidStatus(ctrl, opts);\n        opts.getState({\n            focus: ctrl.focus(),\n            dirty: ctrl.isDirty,\n            value: ctrl.value,\n            el: ctrl.inputEl(),\n            invalid: status.invalid,\n            error: status.error\n        });\n    }\n};\n\nconst ignoreEvent = (opts, name) => (opts.ignoreEvents && opts.ignoreEvents.indexOf(name) !== -1);\n\nconst createView = (ctrl, opts = {}) => {\n    // Early state update to prevent a flash (which would happen if the update is done in config)\n    updateState(ctrl, opts);\n\n    const isInvalid = ctrl.isInvalid;\n    const tag = opts.tag || 'div';\n    const type = (!opts.type || opts.type === 'submit' || opts.type === 'search') ? 'text' : opts.type;\n    const inputTag = opts.multiline ? 'textarea' : 'input';\n    const showError = isInvalid && ctrl.error;\n    const validates = opts.validate || opts.min || opts.max || opts.minlength || opts.required || opts.pattern;\n    const inactive = opts.disabled || opts.readonly;\n\n    if (opts.focus && !ctrl.focus() && !inactive) {\n        ctrl.focus(true);\n        if (ctrl.inputEl()) {\n            ctrl.inputEl().focus();\n        }\n    }\n\n    // Only update from outside if the field is not being edited\n    if (typeof opts.value === 'function' && ctrl.inputEl() && !ctrl.focus() && !inactive) {\n        const value = opts.value();\n        ctrl.value = value;\n        ctrl.touched = true;\n        updateState(ctrl, opts);\n        notifyState(ctrl, opts);\n        ctrl.inputEl().value = value;\n    }\n\n    const onBlur = (e) => {\n        ctrl.focus(false);\n        ctrl.touched = true;\n        ctrl.value = e.target.value;\n        updateState(ctrl, opts);\n        notifyState(ctrl, opts);\n        // same principle as onfocus\n        ctrl.el.classList.remove(CSS_CLASSES.stateFocused);\n    };\n\n    const props = {\n        class: [\n            CSS_CLASSES.block,\n            (isInvalid ? CSS_CLASSES.stateInvalid : ''),\n            (ctrl.focus() ? CSS_CLASSES.stateFocused : ''),\n            (opts.floatingLabel ? CSS_CLASSES.hasFloatingLabel : ''),\n            (opts.disabled ? CSS_CLASSES.stateDisabled : ''),\n            (opts.readonly ? CSS_CLASSES.stateReadonly : ''),\n            (ctrl.isDirty ? CSS_CLASSES.stateDirty : ''),\n            (opts.dense ? CSS_CLASSES.isDense : ''),\n            (opts.required ? CSS_CLASSES.isRequired : ''),\n            (opts.fullWidth ? CSS_CLASSES.hasFullWidth : ''),\n            (opts.counter ? CSS_CLASSES.hasCounter : ''),\n            (opts.hideSpinner !== false ? CSS_CLASSES.hideSpinner : ''),\n            (opts.hideClear !== false ? CSS_CLASSES.hideClear : ''),\n            (opts.hideValidation ? CSS_CLASSES.hideValidation : ''),\n            (opts.hideRequiredMark ? CSS_CLASSES.hideRequiredChar : ''),\n            opts.class\n        ].join(' '),\n        id: opts.id || '',\n        config: (el, inited, context, vdom) => {\n            if (inited) {\n                return;\n            }\n            if (opts.config) {\n                opts.config(el, inited, context, vdom);\n            }\n            ctrl.el = el;\n            if (!inactive) {\n                updateState(ctrl, opts);\n            }\n        }\n    };\n\n\n    const content = [\n        m('div', {\n            class: CSS_CLASSES.inputArea\n        }, [\n            opts.label ? m('label', {\n                class: CSS_CLASSES.label,\n                // In IE10 the label catches click events on the field\n                // the function causes the input to get focus\n\n                ['on' + startEventType]: () => {\n                    if (!inactive) {\n                        setTimeout(() => {\n                            ctrl.inputEl().focus();\n                        }, 0);\n                    }\n                }\n            }, opts.label) : null,\n            m(inputTag, Object.assign(\n                {},\n                {\n                    class: CSS_CLASSES.input,\n                    type,\n                    name: opts.name || '',\n                    disabled: opts.disabled\n                },\n\n                (!ignoreEvent(opts, 'onclick'))\n                    ? {\n                        onclick: () => {\n                            if (inactive) {\n                                return;\n                            }\n                            // in case the browser does not give the field focus,\n                            // for instance when the user tapped to the current field off screen\n                            ctrl.focus(true);\n                            notifyState(ctrl, opts);\n                        }\n                    }\n                    : null,\n\n                (!ignoreEvent(opts, 'onfocus'))\n                    ? {\n                        onfocus: () => {\n                            if (inactive) {\n                                return;\n                            }\n                            ctrl.focus(true);\n                            // set CSS class manually in case field gets focus but is off screen\n                            // and no redraw is triggered\n                            // at the next redraw ctrl.focus() will be read and the focus class be set\n                            // in the props.class statement\n                            if (ctrl.el) {\n                                ctrl.el.classList.add(CSS_CLASSES.stateFocused);\n                            }\n                            notifyState(ctrl, opts);\n                        }\n                    }\n                    : null,\n\n                // onblur defined in config\n\n                (!ignoreEvent(opts, 'oninput'))\n                    ? {\n                        oninput: (e) => {\n                            // default input event\n                            // may be overwritten by opts.events\n                            ctrl.value = e.target.value;\n                            // Don't set ctrl.touched to true to prevent error messages popping up while typing\n                            if (opts.validateOnInput) {\n                                ctrl.touched = true;\n                            }\n                            updateState(ctrl, opts);\n                            notifyState(ctrl, opts);\n                            if (opts.oninput) {\n                                opts.oninput(ctrl.value, e);\n                            }\n                        }\n                    }\n                    : null,\n\n                (!ignoreEvent(opts, 'onkeydown'))\n                    ? {\n                        onkeydown: (e) => {\n                            if (e.which === 13) {\n                                // ENTER\n                                ctrl.touched = true;\n                                updateState(ctrl, opts);\n                                notifyState(ctrl, opts);\n                            } else if (e.which === 27) {\n                                // ESCAPE\n                                ctrl.inputEl().blur(e);\n                            } else if (e.which === 9) {\n                                // TAB\n                                // Update after the blur event when TAB is used to leave the field and no other field will get focus.\n                                // Safari only needs 1 tick, but Chrome needs more than 150ms to create a distinctive new redraw event.\n                                // But we also may have buttons that change place (search field), a large timeout works better in general.\n                                setTimeout(() => {\n\t\t\t\t\t\t\t\t\tconsole.log('REDRAW 1');\n                                    m.redraw();\n                                    setTimeout(m.redraw, 250);\n                                }, 1);\n                            }\n                        }\n                    }\n                    : null,\n\n                {\n                    config: (el, inited, context) => {\n                        if (inited) {\n                            return;\n                        }\n                        ctrl.inputEl(el);\n                        el.value = ctrl.value;\n                        notifyState(ctrl, opts);\n                        if (!inactive) {\n                            if (!ignoreEvent(opts, 'onblur')) {\n                                // use event delegation for the blur event\n                                // so that click events bubble up\n                                // http://www.quirksmode.org/blog/archives/2008/04/delegating_the.html\n                                el.addEventListener('blur', onBlur, true);\n                                context.onunload = function() {\n                                    el.removeEventListener('blur', onBlur, true);\n                                };\n                            }\n                        }\n                    }\n                },\n                opts.events ? opts.events : null, // NOTE: may overwrite oninput\n                (opts.readonly !== undefined) ? {readonly: true} : null,\n                (opts.pattern !== undefined) ? {pattern: opts.pattern} : null,\n                (opts.maxlength !== undefined) ? {maxlength: opts.maxlength} : null,\n                (opts.minlength !== undefined) ? {minlength: opts.minlength} : null,\n                (opts.max !== undefined) ? {max: opts.max} : null,\n                (opts.min !== undefined) ? {min: opts.min} : null,\n                (opts.autofocus !== undefined) ? {autofocus: opts.autofocus} : null,\n                (opts.required !== undefined) ? {required: opts.required} : null,\n                (opts.tabindex !== undefined) ? {tabindex: opts.tabindex} : null,\n                (opts.rows !== undefined) ? {rows: opts.rows} : null\n            ))\n        ]),\n        opts.counter ? m('div', {class: CSS_CLASSES.counter}, ctrl.value.length + ' / ' + opts.counter) : null,\n        (opts.help && !showError) ? m('div', {\n            class: [CSS_CLASSES.help, opts.focusHelp ? CSS_CLASSES.focusHelp : ''].join(' ')\n        }, opts.help) : null,\n        showError\n            ? m('div', {class: CSS_CLASSES.error}, ctrl.error)\n            : (validates && !opts.help)\n                ? m('div', {class: CSS_CLASSES.errorPlaceholder})\n                : null\n    ];\n    return m(tag, props, [opts.before, content, opts.after]);\n};\n\nconst component = {\n    controller: (opts = {}) => {\n        let value,\n            isInvalid = false,\n            touched = false, // true when any change is made\n            error = opts.error || '',\n            el,\n            inputEl = m.prop(),\n            hasFocus = opts.focus || false;\n\n        if (typeof opts.value === 'function') {\n            const v = opts.value();\n            value = (v !== undefined) ? v : '';\n        } else {\n            value = (opts.value !== undefined) ? opts.value : '';\n        }\n        if (value !== '') {\n            touched = true;\n        }\n\n        const focus = (state) => {\n            // read\n            if (state === undefined) {\n                return hasFocus;\n            }\n            // write\n            hasFocus = state;\n        };\n\n        return {\n            value,\n            error,\n            el,\n            inputEl,\n            focus,\n            isInvalid,\n            touched\n        };\n    },\n    view: (ctrl, opts = {}) => {\n        return createView(ctrl, opts);\n    }\n};\n\nexport default component;\n"]}