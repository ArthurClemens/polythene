{"version":3,"sources":["textfield.es6"],"names":["require","_mithril","_isomorphic","startEventType","_isomorphic2","default","isClient","window","PointerEvent","DocumentTouch","document","CSS_CLASSES","block","inputArea","input","label","counter","help","focusHelp","error","errorPlaceholder","stateFocused","stateDisabled","stateReadonly","stateInvalid","stateDirty","hasFloatingLabel","isDense","isRequired","hideRequiredChar","hasFullWidth","hasCounter","hideSpinner","hideClear","hideValidation","validateCustom","ctrl","opts","state","validate","value","invalid","valid","message","validateCounter","length","validateHTML","inputEl","checkValidity","getValidStatus","status","undefined","touched","isInvalid","validateResetOnClear","validateAtStart","previousInvalid","setTimeout","_mithril2","redraw","checkDirty","isDirty","toString","updateState","notifyState","getState","focus","dirty","el","ignoreEvent","name","ignoreEvents","indexOf","createView","arguments","tag","type","inputTag","multiline","showError","validates","min","max","minlength","required","pattern","inactive","disabled","readonly","onBlur","e","target","classList","remove","props","class","floatingLabel","dense","fullWidth","hideRequiredMark","join","id","config","inited","context","vdom","content","_defineProperty","Object","assign","onclick","onfocus","add","oninput","validateOnInput","onkeydown","which","blur","addEventListener","onunload","removeEventListener","events","maxlength","autofocus","tabindex","rows","before","after","component","controller","prop","hasFocus","v","view"],"mappings":"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","file":"textfield.js","sourcesContent":["import 'polythene/common/object.assign';\nimport m from 'mithril';\nimport 'polythene/textfield/theme/theme';\nimport isomorphic from 'polythene/common/isomorphic';\n\nlet startEventType = 'mousedown';\nif(isomorphic.isClient()) {\n\tstartEventType = window.PointerEvent ? 'pointerdown' : (('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch) ? 'touchstart' : 'mousedown';\n}\n\nconst CSS_CLASSES = {\n    block: 'pe-textfield',\n    inputArea: 'pe-textfield__input-area',\n    input: 'pe-textfield__input',\n    label: 'pe-textfield__label',\n    counter: 'pe-textfield__counter',\n    help: 'pe-textfield__help',\n    focusHelp: 'pe-textfield__help-focus',\n    error: 'pe-textfield__error',\n    errorPlaceholder: 'pe-textfield__error-placeholder',\n    stateFocused: 'pe-textfield--focused',\n    stateDisabled: 'pe-textfield--disabled',\n    stateReadonly: 'pe-textfield--readonly',\n    stateInvalid: 'pe-textfield--invalid',\n    stateDirty: 'pe-textfield--dirty',\n    hasFloatingLabel: 'pe-textfield--floating-label',\n    isDense: 'pe-textfield--dense',\n    isRequired: 'pe-textfield--required',\n    hideRequiredChar: 'pe-textfield--no-char',\n    hasFullWidth: 'pe-textfield--full-width',\n    hasCounter: 'pe-textfield--counter',\n    hideSpinner: 'pe-textfield--hide-spinner',\n    hideClear: 'pe-textfield--hide-clear',\n    hideValidation: 'pe-textfield--hide-validation'\n};\n\nconst validateCustom = (ctrl, opts) => {\n    const state = opts.validate(ctrl.value);\n    return {\n        invalid: (state && !state.valid),\n        message: (state && state.error)\n    };\n};\n\nconst validateCounter = (ctrl, opts) => {\n    return {\n        invalid: (ctrl.value.length > opts.counter),\n        message: opts.error\n    };\n};\n\nconst validateHTML = (ctrl, opts) => {\n    return {\n        invalid: !ctrl.inputEl().checkValidity(),\n        message: opts.error\n    };\n};\n\nconst getValidStatus = (ctrl, opts) => {\n    let status = {\n        invalid: false,\n        message: undefined\n    };\n\n    // validateResetOnClear: reset validation when field is cleared\n    if (ctrl.touched && ctrl.isInvalid && ctrl.value.length === 0 && opts.validateResetOnClear) {\n        ctrl.touched = false;\n        ctrl.isInvalid = false;\n        ctrl.error = undefined;\n    }\n\n    if (!status.invalid && opts.counter) {\n        status = validateCounter(ctrl, opts);\n    }\n    if (!status.invalid && ctrl.inputEl() && ctrl.inputEl().checkValidity) {\n        status = validateHTML(ctrl, opts);\n    }\n    if (!status.invalid && opts.validate) {\n        status = validateCustom(ctrl, opts);\n    }\n    return status;\n};\n\nconst checkValidity = (ctrl, opts) => {\n    // default\n    const status = (!ctrl.touched && !opts.validateAtStart)\n        ? {\n            invalid: false,\n            message: undefined\n        }\n        : getValidStatus(ctrl, opts);\n    const previousInvalid = ctrl.isInvalid;\n    ctrl.error = status.message;\n    ctrl.isInvalid = status.invalid;\n    if (status.invalid !== previousInvalid) {\n        setTimeout(m.redraw, 0);\n    }\n\n    if (!status.invalid) {\n        ctrl.error = undefined;\n    }\n};\n\n// dirty = contains text\nconst checkDirty = (ctrl) => {\n    ctrl.isDirty = (ctrl.value.toString().length > 0);\n};\n\nconst updateState = (ctrl, opts) => {\n    checkValidity(ctrl, opts);\n    checkDirty(ctrl);\n};\n\nconst notifyState = (ctrl, opts) => {\n    if (opts.getState) {\n        // get status directly without updating controller\n        const status = getValidStatus(ctrl, opts);\n        opts.getState({\n            focus: ctrl.focus(),\n            dirty: ctrl.isDirty,\n            value: ctrl.value,\n            el: ctrl.inputEl(),\n            invalid: status.invalid,\n            error: status.error\n        });\n    }\n};\n\nconst ignoreEvent = (opts, name) => (opts.ignoreEvents && opts.ignoreEvents.indexOf(name) !== -1);\n\nconst createView = (ctrl, opts = {}) => {\n    // Early state update to prevent a flash (which would happen if the update is done in config)\n    updateState(ctrl, opts);\n\n    const isInvalid = ctrl.isInvalid;\n    const tag = opts.tag || 'div';\n    const type = (!opts.type || opts.type === 'submit' || opts.type === 'search') ? 'text' : opts.type;\n    const inputTag = opts.multiline ? 'textarea' : 'input';\n    const showError = isInvalid && ctrl.error;\n    const validates = opts.validate || opts.min || opts.max || opts.minlength || opts.required || opts.pattern;\n    const inactive = opts.disabled || opts.readonly;\n\n    if (opts.focus && !ctrl.focus() && !inactive) {\n        ctrl.focus(true);\n        if (ctrl.inputEl()) {\n            ctrl.inputEl().focus();\n        }\n    }\n\n    // Only update from outside if the field is not being edited\n    if (typeof opts.value === 'function' && ctrl.inputEl() && !ctrl.focus() && !inactive) {\n        const value = opts.value();\n        ctrl.value = value;\n        ctrl.touched = true;\n        updateState(ctrl, opts);\n        notifyState(ctrl, opts);\n        ctrl.inputEl().value = value;\n    }\n\n    const onBlur = (e) => {\n        ctrl.focus(false);\n        ctrl.touched = true;\n        ctrl.value = e.target.value;\n        updateState(ctrl, opts);\n        notifyState(ctrl, opts);\n        // same principle as onfocus\n        ctrl.el.classList.remove(CSS_CLASSES.stateFocused);\n    };\n\n    const props = {\n        class: [\n            CSS_CLASSES.block,\n            (isInvalid ? CSS_CLASSES.stateInvalid : ''),\n            (ctrl.focus() ? CSS_CLASSES.stateFocused : ''),\n            (opts.floatingLabel ? CSS_CLASSES.hasFloatingLabel : ''),\n            (opts.disabled ? CSS_CLASSES.stateDisabled : ''),\n            (opts.readonly ? CSS_CLASSES.stateReadonly : ''),\n            (ctrl.isDirty ? CSS_CLASSES.stateDirty : ''),\n            (opts.dense ? CSS_CLASSES.isDense : ''),\n            (opts.required ? CSS_CLASSES.isRequired : ''),\n            (opts.fullWidth ? CSS_CLASSES.hasFullWidth : ''),\n            (opts.counter ? CSS_CLASSES.hasCounter : ''),\n            (opts.hideSpinner !== false ? CSS_CLASSES.hideSpinner : ''),\n            (opts.hideClear !== false ? CSS_CLASSES.hideClear : ''),\n            (opts.hideValidation ? CSS_CLASSES.hideValidation : ''),\n            (opts.hideRequiredMark ? CSS_CLASSES.hideRequiredChar : ''),\n            opts.class\n        ].join(' '),\n        id: opts.id || '',\n        config: (el, inited, context, vdom) => {\n            if (inited) {\n                return;\n            }\n            if (opts.config) {\n                opts.config(el, inited, context, vdom);\n            }\n            ctrl.el = el;\n            if (!inactive) {\n                updateState(ctrl, opts);\n            }\n        }\n    };\n\n\n    const content = [\n        m('div', {\n            class: CSS_CLASSES.inputArea\n        }, [\n            opts.label ? m('label', {\n                class: CSS_CLASSES.label,\n                // In IE10 the label catches click events on the field\n                // the function causes the input to get focus\n\n                ['on' + startEventType]: () => {\n                    if (!inactive) {\n                        setTimeout(() => {\n                            ctrl.inputEl().focus();\n                        }, 0);\n                    }\n                }\n            }, opts.label) : null,\n            m(inputTag, Object.assign(\n                {},\n                {\n                    class: CSS_CLASSES.input,\n                    type,\n                    name: opts.name || '',\n                    disabled: opts.disabled\n                },\n\n                (!ignoreEvent(opts, 'onclick'))\n                    ? {\n                        onclick: () => {\n                            if (inactive) {\n                                return;\n                            }\n                            // in case the browser does not give the field focus,\n                            // for instance when the user tapped to the current field off screen\n                            ctrl.focus(true);\n                            notifyState(ctrl, opts);\n                        }\n                    }\n                    : null,\n\n                (!ignoreEvent(opts, 'onfocus'))\n                    ? {\n                        onfocus: () => {\n                            if (inactive) {\n                                return;\n                            }\n                            ctrl.focus(true);\n                            // set CSS class manually in case field gets focus but is off screen\n                            // and no redraw is triggered\n                            // at the next redraw ctrl.focus() will be read and the focus class be set\n                            // in the props.class statement\n                            if (ctrl.el) {\n                                ctrl.el.classList.add(CSS_CLASSES.stateFocused);\n                            }\n                            notifyState(ctrl, opts);\n                        }\n                    }\n                    : null,\n\n                // onblur defined in config\n\n                (!ignoreEvent(opts, 'oninput'))\n                    ? {\n                        oninput: (e) => {\n                            // default input event\n                            // may be overwritten by opts.events\n                            ctrl.value = e.target.value;\n                            // Don't set ctrl.touched to true to prevent error messages popping up while typing\n                            if (opts.validateOnInput) {\n                                ctrl.touched = true;\n                            }\n                            updateState(ctrl, opts);\n                            notifyState(ctrl, opts);\n                            if (opts.oninput) {\n                                opts.oninput(ctrl.value, e);\n                            }\n                        }\n                    }\n                    : null,\n\n                (!ignoreEvent(opts, 'onkeydown'))\n                    ? {\n                        onkeydown: (e) => {\n                            if (e.which === 13) {\n                                // ENTER\n                                ctrl.touched = true;\n                                updateState(ctrl, opts);\n                                notifyState(ctrl, opts);\n                            } else if (e.which === 27) {\n                                // ESCAPE\n                                ctrl.inputEl().blur(e);\n                            } else if (e.which === 9) {\n                                // TAB\n                                // Update after the blur event when TAB is used to leave the field and no other field will get focus.\n                                // Safari only needs 1 tick, but Chrome needs more than 150ms to create a distinctive new redraw event.\n                                // But we also may have buttons that change place (search field), a large timeout works better in general.\n                                setTimeout(() => {\n                                    m.redraw();\n                                    setTimeout(m.redraw, 250);\n                                }, 1);\n                            }\n                        }\n                    }\n                    : null,\n\n                {\n                    config: (el, inited, context) => {\n                        if (inited) {\n                            return;\n                        }\n                        ctrl.inputEl(el);\n                        el.value = ctrl.value;\n                        notifyState(ctrl, opts);\n                        if (!inactive) {\n                            if (!ignoreEvent(opts, 'onblur')) {\n                                // use event delegation for the blur event\n                                // so that click events bubble up\n                                // http://www.quirksmode.org/blog/archives/2008/04/delegating_the.html\n                                el.addEventListener('blur', onBlur, true);\n                                context.onunload = function() {\n                                    el.removeEventListener('blur', onBlur, true);\n                                };\n                            }\n                        }\n                    }\n                },\n                opts.events ? opts.events : null, // NOTE: may overwrite oninput\n                (opts.readonly !== undefined) ? {readonly: true} : null,\n                (opts.pattern !== undefined) ? {pattern: opts.pattern} : null,\n                (opts.maxlength !== undefined) ? {maxlength: opts.maxlength} : null,\n                (opts.minlength !== undefined) ? {minlength: opts.minlength} : null,\n                (opts.max !== undefined) ? {max: opts.max} : null,\n                (opts.min !== undefined) ? {min: opts.min} : null,\n                (opts.autofocus !== undefined) ? {autofocus: opts.autofocus} : null,\n                (opts.required !== undefined) ? {required: opts.required} : null,\n                (opts.tabindex !== undefined) ? {tabindex: opts.tabindex} : null,\n                (opts.rows !== undefined) ? {rows: opts.rows} : null\n            ))\n        ]),\n        opts.counter ? m('div', {class: CSS_CLASSES.counter}, ctrl.value.length + ' / ' + opts.counter) : null,\n        (opts.help && !showError) ? m('div', {\n            class: [CSS_CLASSES.help, opts.focusHelp ? CSS_CLASSES.focusHelp : ''].join(' ')\n        }, opts.help) : null,\n        showError\n            ? m('div', {class: CSS_CLASSES.error}, ctrl.error)\n            : (validates && !opts.help)\n                ? m('div', {class: CSS_CLASSES.errorPlaceholder})\n                : null\n    ];\n    return m(tag, props, [opts.before, content, opts.after]);\n};\n\nconst component = {\n    controller: (opts = {}) => {\n        let value,\n            isInvalid = false,\n            touched = false, // true when any change is made\n            error = opts.error || '',\n            el,\n            inputEl = m.prop(),\n            hasFocus = opts.focus || false;\n\n        if (typeof opts.value === 'function') {\n            const v = opts.value();\n            value = (v !== undefined) ? v : '';\n        } else {\n            value = (opts.value !== undefined) ? opts.value : '';\n        }\n        if (value !== '') {\n            touched = true;\n        }\n\n        const focus = (state) => {\n            // read\n            if (state === undefined) {\n                return hasFocus;\n            }\n            // write\n            hasFocus = state;\n        };\n\n        return {\n            value,\n            error,\n            el,\n            inputEl,\n            focus,\n            isInvalid,\n            touched\n        };\n    },\n    view: (ctrl, opts = {}) => {\n        return createView(ctrl, opts);\n    }\n};\n\nexport default component;\n"]}