"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(exports,"__esModule",{value:!0}),require("polythene/common/object.assign");var _mithril=require("mithril"),_mithril2=_interopRequireDefault(_mithril);require("polythene/textfield/theme/theme");var startEventType="mousedown";"undefined"!=typeof window&&(startEventType=window.PointerEvent?"pointerdown":"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch?"touchstart":"mousedown");var CSS_CLASSES={block:"pe-textfield",inputArea:"pe-textfield__input-area",input:"pe-textfield__input",label:"pe-textfield__label",counter:"pe-textfield__counter",help:"pe-textfield__help",focusHelp:"pe-textfield__help-focus",error:"pe-textfield__error",errorPlaceholder:"pe-textfield__error-placeholder",stateFocused:"pe-textfield--focused",stateDisabled:"pe-textfield--disabled",stateReadonly:"pe-textfield--readonly",stateInvalid:"pe-textfield--invalid",stateDirty:"pe-textfield--dirty",hasFloatingLabel:"pe-textfield--floating-label",isDense:"pe-textfield--dense",isRequired:"pe-textfield--required",hideRequiredChar:"pe-textfield--no-char",hasFullWidth:"pe-textfield--full-width",hasCounter:"pe-textfield--counter",hideSpinner:"pe-textfield--hide-spinner",hideClear:"pe-textfield--hide-clear",hideValidation:"pe-textfield--hide-validation"},validateCustom=function(ctrl,opts){var state=opts.validate(ctrl.value);return{invalid:state&&!state.valid,message:state&&state.error}},validateCounter=function(ctrl,opts){return{invalid:ctrl.value.length>opts.counter,message:opts.error}},validateHTML=function(ctrl,opts){return{invalid:!ctrl.inputEl().checkValidity(),message:opts.error}},getValidStatus=function(ctrl,opts){var status={invalid:!1,message:void 0};return ctrl.touched&&ctrl.isInvalid&&0===ctrl.value.length&&opts.validateResetOnClear&&(ctrl.touched=!1,ctrl.isInvalid=!1,ctrl.error=void 0),!status.invalid&&opts.counter&&(status=validateCounter(ctrl,opts)),!status.invalid&&ctrl.inputEl()&&ctrl.inputEl().checkValidity&&(status=validateHTML(ctrl,opts)),!status.invalid&&opts.validate&&(status=validateCustom(ctrl,opts)),status},checkValidity=function(ctrl,opts){var status=ctrl.touched||opts.validateAtStart?getValidStatus(ctrl,opts):{invalid:!1,message:void 0},previousInvalid=ctrl.isInvalid;ctrl.error=status.message,ctrl.isInvalid=status.invalid,status.invalid!==previousInvalid&&setTimeout(_mithril2.default.redraw,0),status.invalid||(ctrl.error=void 0)},checkDirty=function(ctrl){ctrl.isDirty=ctrl.value.toString().length>0},updateState=function(ctrl,opts){checkValidity(ctrl,opts),checkDirty(ctrl)},notifyState=function(ctrl,opts){if(opts.getState){var status=getValidStatus(ctrl,opts);opts.getState({focus:ctrl.focus(),dirty:ctrl.isDirty,value:ctrl.value,el:ctrl.inputEl(),invalid:status.invalid,error:status.error})}},ignoreEvent=function(opts,name){return opts.ignoreEvents&&opts.ignoreEvents.indexOf(name)!==-1},createView=function(ctrl){var opts=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};updateState(ctrl,opts);var isInvalid=ctrl.isInvalid,tag=opts.tag||"div",type=opts.type&&"submit"!==opts.type&&"search"!==opts.type?opts.type:"text",inputTag=opts.multiline?"textarea":"input",showError=isInvalid&&ctrl.error,validates=opts.validate||opts.min||opts.max||opts.minlength||opts.required||opts.pattern,inactive=opts.disabled||opts.readonly;if(!opts.focus||ctrl.focus()||inactive||(ctrl.focus(!0),ctrl.inputEl()&&ctrl.inputEl().focus()),"function"==typeof opts.value&&ctrl.inputEl()&&!ctrl.focus()&&!inactive){var value=opts.value();ctrl.value=value,ctrl.touched=!0,updateState(ctrl,opts),notifyState(ctrl,opts),ctrl.inputEl().value=value}var onBlur=function(e){ctrl.focus(!1),ctrl.touched=!0,ctrl.value=e.target.value,updateState(ctrl,opts),notifyState(ctrl,opts),ctrl.el.classList.remove(CSS_CLASSES.stateFocused)},props={class:[CSS_CLASSES.block,isInvalid?CSS_CLASSES.stateInvalid:"",ctrl.focus()?CSS_CLASSES.stateFocused:"",opts.floatingLabel?CSS_CLASSES.hasFloatingLabel:"",opts.disabled?CSS_CLASSES.stateDisabled:"",opts.readonly?CSS_CLASSES.stateReadonly:"",ctrl.isDirty?CSS_CLASSES.stateDirty:"",opts.dense?CSS_CLASSES.isDense:"",opts.required?CSS_CLASSES.isRequired:"",opts.fullWidth?CSS_CLASSES.hasFullWidth:"",opts.counter?CSS_CLASSES.hasCounter:"",opts.hideSpinner!==!1?CSS_CLASSES.hideSpinner:"",opts.hideClear!==!1?CSS_CLASSES.hideClear:"",opts.hideValidation?CSS_CLASSES.hideValidation:"",opts.hideRequiredMark?CSS_CLASSES.hideRequiredChar:"",opts.class].join(" "),id:opts.id||"",config:function(el,inited,context,vdom){inited||(opts.config&&opts.config(el,inited,context,vdom),ctrl.el=el,inactive||updateState(ctrl,opts))}},content=[(0,_mithril2.default)("div",{class:CSS_CLASSES.inputArea},[opts.label?(0,_mithril2.default)("label",_defineProperty({class:CSS_CLASSES.label},"on"+startEventType,function(){inactive||setTimeout(function(){ctrl.inputEl().focus()},0)}),opts.label):null,(0,_mithril2.default)(inputTag,Object.assign({},{class:CSS_CLASSES.input,type:type,name:opts.name||"",disabled:opts.disabled},ignoreEvent(opts,"onclick")?null:{onclick:function(){inactive||(ctrl.focus(!0),notifyState(ctrl,opts))}},ignoreEvent(opts,"onfocus")?null:{onfocus:function(){inactive||(ctrl.focus(!0),ctrl.el&&ctrl.el.classList.add(CSS_CLASSES.stateFocused),notifyState(ctrl,opts))}},ignoreEvent(opts,"oninput")?null:{oninput:function(e){ctrl.value=e.target.value,opts.validateOnInput&&(ctrl.touched=!0),updateState(ctrl,opts),notifyState(ctrl,opts),opts.oninput&&opts.oninput(ctrl.value,e)}},ignoreEvent(opts,"onkeydown")?null:{onkeydown:function(e){13===e.which?(ctrl.touched=!0,updateState(ctrl,opts),notifyState(ctrl,opts)):27===e.which?ctrl.inputEl().blur(e):9===e.which&&setTimeout(function(){_mithril2.default.redraw(),setTimeout(_mithril2.default.redraw,250)},1)}},{config:function(el,inited,context){inited||(ctrl.inputEl(el),el.value=ctrl.value,notifyState(ctrl,opts),inactive||ignoreEvent(opts,"onblur")||(el.addEventListener("blur",onBlur,!0),context.onunload=function(){el.removeEventListener("blur",onBlur,!0)}))}},opts.events?opts.events:null,void 0!==opts.readonly?{readonly:!0}:null,void 0!==opts.pattern?{pattern:opts.pattern}:null,void 0!==opts.maxlength?{maxlength:opts.maxlength}:null,void 0!==opts.minlength?{minlength:opts.minlength}:null,void 0!==opts.max?{max:opts.max}:null,void 0!==opts.min?{min:opts.min}:null,void 0!==opts.autofocus?{autofocus:opts.autofocus}:null,void 0!==opts.required?{required:opts.required}:null,void 0!==opts.tabindex?{tabindex:opts.tabindex}:null,void 0!==opts.rows?{rows:opts.rows}:null))]),opts.counter?(0,_mithril2.default)("div",{class:CSS_CLASSES.counter},ctrl.value.length+" / "+opts.counter):null,opts.help&&!showError?(0,_mithril2.default)("div",{class:[CSS_CLASSES.help,opts.focusHelp?CSS_CLASSES.focusHelp:""].join(" ")},opts.help):null,showError?(0,_mithril2.default)("div",{class:CSS_CLASSES.error},ctrl.error):validates&&!opts.help?(0,_mithril2.default)("div",{class:CSS_CLASSES.errorPlaceholder}):null];return(0,_mithril2.default)(tag,props,[opts.before,content,opts.after])},component={controller:function(){var opts=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},value=void 0,isInvalid=!1,touched=!1,error=opts.error||"",el=void 0,inputEl=_mithril2.default.prop(),hasFocus=opts.focus||!1;if("function"==typeof opts.value){var v=opts.value();value=void 0!==v?v:""}else value=void 0!==opts.value?opts.value:"";""!==value&&(touched=!0);var focus=function(state){return void 0===state?hasFocus:void(hasFocus=state)};return{value:value,error:error,el:el,inputEl:inputEl,focus:focus,isInvalid:isInvalid,touched:touched}},view:function(ctrl){var opts=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return createView(ctrl,opts)}};exports.default=component,module.exports=exports.default;
//# sourceMappingURL=textfield.js.map